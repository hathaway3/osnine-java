         nam   Stylo
         ttl   program module

 use defsfile

         mod   eom,name,Prgrm+Objct,ReEnt,start,size
u0000    rmb   1
u0001    rmb   1
u0002    rmb   1
u0003    rmb   1
u0004    rmb   1
u0005    rmb   1
u0006    rmb   1
u0007    rmb   1
u0008    rmb   1
u0009    rmb   1
u000A    rmb   1
u000B    rmb   1
u000C    rmb   1
u000D    rmb   1
TTYSTATE    rmb   1
u000F    rmb   1
u0010    rmb   1
u0011    rmb   1
u0012    rmb   1
u0013    rmb   1
u0014    rmb   1
u0015    rmb   1
u0016    rmb   1
u0017    rmb   1
u0018    rmb   1
u0019    rmb   1
u001A    rmb   1
u001B    rmb   1
u001C    rmb   1
u001D    rmb   1
u001E    rmb   1
u001F    rmb   1
u0020    rmb   1
u0021    rmb   1
u0022    rmb   2
u0024    rmb   1
u0025    rmb   1
u0026    rmb   1
u0027    rmb   1
u0028    rmb   1
u0029    rmb   1
u002A    rmb   1
u002B    rmb   1
u002C    rmb   1
u002D    rmb   1
u002E    rmb   1
u002F    rmb   1
u0030    rmb   1
u0031    rmb   1
u0032    rmb   1
u0033    rmb   1
u0034    rmb   1
u0035    rmb   1
u0036    rmb   1
u0037    rmb   1
u0038    rmb   1
u0039    rmb   1
u003A    rmb   2
u003C    rmb   2
u003E    rmb   1
u003F    rmb   1
u0040    rmb   1
u0041    rmb   1
u0042    rmb   1
u0043    rmb   1
u0044    rmb   1
u0045    rmb   1
u0046    rmb   1
u0047    rmb   1
u0048    rmb   1
u0049    rmb   1
u004A    rmb   1
u004B    rmb   1
u004C    rmb   1
u004D    rmb   1
u004E    rmb   1
u004F    rmb   1
u0050    rmb   1
u0051    rmb   1
u0052    rmb   1
u0053    rmb   1
u0054    rmb   1
u0055    rmb   1
u0056    rmb   1
u0057    rmb   1
u0058    rmb   1
u0059    rmb   2
u005B    rmb   1
u005C    rmb   1
u005D    rmb   1
u005E    rmb   1
u005F    rmb   1
u0060    rmb   1
u0061    rmb   1
u0062    rmb   1
u0063    rmb   1
u0064    rmb   1
u0065    rmb   2
u0067    rmb   1
u0068    rmb   1
u0069    rmb   2
u006B    rmb   2
u006D    rmb   2
u006F    rmb   1
u0070    rmb   1
u0071    rmb   1
u0072    rmb   1
u0073    rmb   1
u0074    rmb   1
u0075    rmb   2
u0077    rmb   2
u0079    rmb   1
u007A    rmb   2
u007C    rmb   1
u007D    rmb   1
u007E    rmb   1
u007F    rmb   1
u0080    rmb   1
u0081    rmb   2
u0083    rmb   2
u0085    rmb   1
u0086    rmb   1
u0087    rmb   2
u0089    rmb   1
u008A    rmb   1
u008B    rmb   1
u008C    rmb   1
u008D    rmb   1
u008E    rmb   1
u008F    rmb   2
u0091    rmb   2
u0093    rmb   1
u0094    rmb   1
u0095    rmb   1
u0096    rmb   1
u0097    rmb   1
u0098    rmb   1
u0099    rmb   2
u009B    rmb   2
u009D    rmb   1
u009E    rmb   1
u009F    rmb   1
u00A0    rmb   2
u00A2    rmb   1
u00A3    rmb   1
u00A4    rmb   1
u00A5    rmb   1
u00A6    rmb   1
u00A7    rmb   1
u00A8    rmb   1
u00A9    rmb   1
u00AA    rmb   1
u00AB    rmb   1
u00AC    rmb   1
u00AD    rmb   1
u00AE    rmb   1
u00AF    rmb   1
u00B0    rmb   2
u00B2    rmb   1
u00B3    rmb   1
u00B4    rmb   2
u00B6    rmb   2
u00B8    rmb   2
u00BA    rmb   2
u00BC    rmb   2
u00BE    rmb   2
u00C0    rmb   2
u00C2    rmb   2
u00C4    rmb   1
u00C5    rmb   1
u00C6    rmb   1
u00C7    rmb   1
u00C8    rmb   2
u00CA    rmb   1
u00CB    rmb   1
u00CC    rmb   1
u00CD    rmb   2
u00CF    rmb   1
u00D0    rmb   1
u00D1    rmb   1
u00D2    rmb   2
u00D4    rmb   1
u00D5    rmb   1
u00D6    rmb   1
u00D7    rmb   1
u00D8    rmb   1
u00D9    rmb   1
u00DA    rmb   1
u00DB    rmb   1
u00DC    rmb   1
u00DD    rmb   1
u00DE    rmb   1
u00DF    rmb   1
u00E0    rmb   1
u00E1    rmb   1
u00E2    rmb   1
u00E3    rmb   1
u00E4    rmb   1
u00E5    rmb   1
u00E6    rmb   1
u00E7    rmb   1
u00E8    rmb   1
u00E9    rmb   1
u00EA    rmb   1
u00EB    rmb   1
u00EC    rmb   1
u00ED    rmb   1
u00EE    rmb   1
u00EF    rmb   2
u00F1    rmb   1
u00F2    rmb   1
u00F3    rmb   1
u00F4    rmb   1
u00F5    rmb   1
u00F6    rmb   2
u00F8    rmb   1
u00F9    rmb   1
u00FA    rmb   1
u00FB    rmb   1
u00FC    rmb   1
u00FD    rmb   771
u0400    rmb   11820
u322C    rmb   6156
size     equ   .

L000D    fcb   2 Terminal type
         fcb   $0B
L000F    fcb   $08   MAXPAGES
         fcb   $0B
L0011    fcb   $00
L0012    fcb   $01
L0013    fcb   $00
         fcb   $00
         fcb   $00
         fcb   $00

         fdb   $0501 TXTBEG
         fdb   $0F3A
         fdb   $4F62
         fdb   $0FE3
         fdb   $1073

         fdb   $10D7
         fdb   $0000
         fdb   $0000
         fdb   $0000

         fcb   $00
         fcb   $00
         fcb   $00
         fcb   $00
         fcb   $00
         fcb   $00
         fcb   $00
         fcb   $00
         fcb   $0D
         fcc " STYLOGRAPH "
         fcb   $0D

         fcc "COPYRIGHT 1982"
         fcb   $0D
         fcc "GREAT PLAINS COMPUTER CO.,INC."
         fcb   $0D
name     equ   *
         fcs   /Stylo/

L0072    tfr   u,d
         tfr   s,y
         rts
L0077    pshs  y,x,b,a
         leax  $08,s
         stx   <u0004
         stx   <u0006
         leax  >IRQHNDLR,pcr
         ldu   #$0000
         os9   F$Icpt
         ldx   <u0089
         leay  >$0100,x
         leax  >$0C1E,y
         stx   <TTYSTATE
         leax  >$0C3E,y
         stx   <u0010
         leax  >$0C5E,y
         stx   <u0012
         leax  >$0CB3,y
         stx   <u0014
         bsr   L00F6
         leax  >$0CEE,y
         stx   <u0016
         bsr   L00F6
         leax  >$0D29,y
         stx   <u0018
         bsr   L00F6
         leax  >$0D64,y
         stx   <u001A
         bsr   L00F6
         leax  >$1169,y
         stx   <u001C
         bsr   L00F6
         clra
         clrb
         ldx   <TTYSTATE
         os9   I$GetStt
         ldy   <u0010
         ldd   #$0020
         lbsr  L3F31
         ldx   <u0010
         clr   $04,x
         clr   $07,x
         lda   #$FF
         sta   $0C,x
         sta   $0F,x
         clra
         clrb
         os9   I$SetStt
         ldx   <u0089
         leax  >$0BCE,x
         stx   <u00F4
         stx   <u00F6
         puls  pc,y,x,b,a

L00F6    leau  $05,x
         stu   ,x
         stu   $02,x
         clr   $04,x
         rts

WrA2BUF    pshs  y,x,b,a
         ldx   <u00F4
         anda  #$7F
         sta   ,x+
         stx   <u00F4
         leax  <-$50,x
         cmpx  <u00F6
         bcs   L0125
         bra   L0114

L0112    pshs  y,x,b,a
L0114    ldd   <u00F4
         subd  <u00F6
         beq   L0125
         tfr   d,y
         ldx   <u00F6
         stx   <u00F4
         lda   #$01
         os9   I$Write
L0125    puls  pc,y,x,b,a
L0127    rts
L0128    bra   L0112
         rts

* Read one character from stdin
L012B    bsr   L0112
         pshs  y,x,a
         tfr   s,x
         ldy   #$0001
         lda   #$00
         os9   I$Read
         puls  y,x,a
         anda  #$7F
         rts

* Interrupt handler
IRQHNDLR    rti

L0140    pshs  y,x,a
         tfr   s,x
         ldy   #$0001
         lda   <u0000
         os9   I$Write
         puls  pc,y,x,a

L014F    pshs  x,b,a
         lda   #$02
         ldb   #$03
         os9   I$Create
         bcs   L0160
         sta   <u0000
         andcc #$FC
         puls  pc,x,b,a

L0160    stb   <u0003
         orcc  #$01
         andcc #$FD
         puls  pc,x,b,a

L0168    pshs  a
         lda   <u0000
         os9   I$Close
         puls  pc,a

L0171    bsr   L017A
         beq   L0179
         bsr   L012B   Read keyboard
         bra   L0171
L0179    rts

L017A    pshs  b,a
         lda   #$00
         ldb   #$01
         os9   I$GetStt
         bcs   L0189
         andcc #$FB
         puls  pc,b,a
L0189    orcc  #$04
         puls  pc,b,a

L018D    pshs  y,x,b,a
         ldy   <u0004
L0192    lda   ,y+
         cmpa  #$0D
         beq   L01A6
         cmpa  #$20
         beq   L0192
         cmpa  #$2C
         beq   L0192
         cmpa  #$2D
         beq   L01CE
         bra   L01AC
L01A6    orcc  #$01
         andcc #$FD
         puls  pc,y,x,b,a

L01AC    leay  -$01,y
         ldb   #$36
L01B0    lda   ,y+
         cmpa  #$0D
         beq   L01C3
         cmpa  #$20
         beq   L01C3
         cmpa  #$2C
         beq   L01C3
         sta   ,x+
         decb
         bne   L01B0
L01C3    clr   ,x
         leay  -$01,y
         sty   <u0004
         andcc #$FE
         puls  pc,y,x,b,a
L01CE    lda   ,y+
         cmpa  #$0D
         beq   L01A6
         cmpa  #$20
         beq   L0192
         cmpa  #$2C
         beq   L0192
         bra   L01CE
L01DE    pshs  b,a
         ldx   <u0006
L01E2    lda   ,x+
         cmpa  #$2D
         beq   L01F0
         cmpa  #$0D
         bne   L01E2
         orcc  #$01
         puls  pc,b,a
L01F0    stx   <u0006
         andcc #$FE
         puls  pc,b,a
L01F6    pshs  u,x,b,a
         lda   #$02
         ldb   #$03
         os9   I$Create
         ldx   <u001A
L0201    bcs   L0213
         sta   $04,x
         leau  $05,x
         stu   ,x
         leau  >u0400,u
         stu   $02,x
         andcc #$FC
         puls  pc,u,x,b,a
L0213    stb   <u0003
         cmpb  #$DA
         bne   L021D
         orcc  #$03
         puls  pc,u,x,b,a
L021D    orcc  #$01
         andcc #$FD
         puls  pc,u,x,b,a

L0223    pshs  u,x,b,a
         lda   #$02
         ldb   #$03
         os9   I$Create
         ldx   <u001C
         bra   L0201

* Create path from stydir
L0230    pshs  y,x,b,a
         leax  >STYDIR,pcr
         ldy   <u0012
L0239    lda   ,x+
         beq   L0241
         sta   ,y+
         bra   L0239
L0241    ldx   $02,s
         lda   #$2F
         sta   ,y+
L0247    lda   ,x+
         sta   ,y+
         bne   L0247
         puls  y,x,b,a
         ldx   <u0012
         pshs  u,x,a
         lda   #$01
         os9   I$Open
         ldx   <u0018
         bra   L0265
L025C    pshs  u,x,a
         lda   #$01
         os9   I$Open
         ldx   <u0014
L0265    bcs   L0271
         sta   $04,x
         leau  $05,x
         stu   ,x
         stu   $02,x
         puls  pc,u,x,a
L0271    cmpb  #$D8
         beq   L027D
         stb   <u0003
         orcc  #$01
         andcc #$FD
         puls  pc,u,x,a
L027D    stb   <u0003
         orcc  #$03
         puls  pc,u,x,a
L0283    pshs  u,x,a
         lda   #$01
         os9   I$Open
         ldx   <u0016
         bra   L0265
L028E    pshs  x,a
         ldx   <u0014
         bra   L02AD
L0294    pshs  x,a
         ldx   <u0016
         bra   L02AD
L029A    pshs  x,a
         ldx   <u0018
         bra   L02AD
L02A0    pshs  x,a
         ldx   <u001A
         bra   L02AA
L02A6    pshs  x,a
         ldx   <u001C
L02AA    lbsr  L047F
L02AD    lda   $04,x
         beq   L02B6
         clr   $04,x
         os9   I$Close
L02B6    puls  pc,x,a
L02B8    pshs  y,x,b,a
         ldy   <u0012
L02BD    lda   ,x+
         beq   L02C5
         sta   ,y+
         bra   L02BD
L02C5    leax  >L0F7A,pcr
L02C9    lda   ,x+
         sta   ,y+
         bne   L02C9
         ldx   <u0012
         os9   I$Delete
         stb   <u0003
         puls  pc,y,x,b,a
L02D8    pshs  x
         ldx   <u001A
L02DC    lbsr  L046C
         puls  pc,x
L02E1    pshs  x
         ldx   <u001C
         bra   L02DC
L02E7    pshs  b,a
         ldb   <u0003
         lda   #$01
         os9   F$PErr
         puls  pc,b,a
L02F2    pshs  x,b
         ldx   <u0014
L02F6    lbsr  L04A4
         puls  pc,x,b
L02FB    pshs  x,b
         ldx   <u0016
         bra   L02F6
L0301    pshs  x,b
         ldx   <u0018
         bra   L02F6
         pshs  x,b
         ldx   <u0018
         lbsr  L04B5
         puls  pc,x,b
L0310    pshs  u,y,x,b,a
         ldy   <u0012
         stx   <u000C
L0317    lda   ,x+
         sta   ,y+
         bne   L0317
         leay  -$01,y
         leax  >L0F7A,pcr
L0323    lda   ,x+
         sta   ,y+
         bne   L0323
         lda   #$01
         ldx   <u0012
         os9   I$Open
         bcs   L0339
         os9   I$Close
         orcc  #$03
         puls  pc,u,y,x,b,a
L0339    cmpb  #$D8
         beq   L035D
L033D    stb   <u0003
         cmpb  #$CF
         beq   L034D
         cmpb  #$ED
         beq   L034D
L0347    orcc  #$01
         andcc #$FD
         puls  pc,u,y,x,b,a
L034D    ldx   >L0581,pcr
         lbsr  L3351
         ldx   >L0583,pcr
         lbsr  L3356
         bra   L0347
L035D    tst   <u005F
         beq   L0379
         ldx   <u000A
         bne   L0374
         ldx   <u0014
         lda   $04,x
         ldb   #$05
         os9   I$GetStt
         bcs   L033D
         stx   <u0008
         stu   <u000A
L0374    lbsr  L028E
         bcs   L033D
L0379    ldx   <u000C
         ldy   <u0012
         lda   #$20
         sta   ,y+
L0382    lda   ,x+
         sta   ,y+
         bne   L0382
         lda   #$20
         sta   -$01,y
L038C    lda   ,-x
         cmpa  #$2F
         beq   L0398
         cmpx  <u000C
         bne   L038C
         bra   L039A
L0398    leax  $01,x
L039A    lda   ,x+
         beq   L03A2
         sta   ,y+
         bra   L039A
L03A2    leax  >L0F7A,pcr
L03A6    lda   ,x+
         sta   ,y+
         bne   L03A6
         lda   #$0D
         sta   -$01,y
         leax  >RENAME,pcr
         tfr   y,d
         subd  <u0012
         incb
         tfr   d,y
         ldu   <u0012
         ldd   #$0000
         os9   F$Fork
         lbcs  L033D
         os9   F$Wait
         tstb
         lbne  L033D
         tst   <u005F
         beq   L0404
         ldx   <u000C
         ldy   <u0012
L03D8    lda   ,x+
         sta   ,y+
         bne   L03D8
         leay  -$01,y
         leax  >L0F7A,pcr
L03E4    lda   ,x+
         sta   ,y+
         bne   L03E4
         ldx   <u0012
         lda   #$01
         os9   I$Open
         lbcs  L033D
         ldx   <u0014
         sta   $04,x
         ldx   <u0008
         ldu   <u000A
         os9   I$Seek
         lbcs  L033D
L0404    andcc #$FE
         puls  pc,u,y,x,b,a
L0408    pshs  u,y,x,b,a
         pshs  x
         ldx   <TTYSTATE
         ldd   #$0000
         os9   I$SetStt
         puls  x
         tfr   x,u
         ldd   #$0000
L041B    tst   d,u
         beq   L0424
         addd  #$0001
         bra   L041B
L0424    tfr   d,y
         leay  $01,y
         leax  d,u
         lda   #$0D
         sta   ,x
         ldd   #$0000
         leax  >SHELL,pcr
         os9   F$Fork
         bcs   L0450
         os9   F$Wait
         tstb
         bne   L0450
         andcc #$FE
L0442    pshs  cc
         ldx   <u0010
         ldd   #$0000
         os9   I$SetStt
         puls  cc
         puls  pc,u,y,x,b,a
L0450    stb   <u0003
         orcc  #$01
         bra   L0442
L0456    lbsr  L0112
         lbsr  L02A0
         lbsr  L02A6
         ldd   #$0000
         ldx   <TTYSTATE
         os9   I$SetStt
         clrb
         os9   F$Exit
         rts
L046C    pshs  u
         ldu   ,x
         sta   ,u+
         stu   ,x
         cmpu  $02,x
         beq   L047D
         andcc #$FE
         puls  pc,u
L047D    puls  u
L047F    pshs  y,x,b,a
         tst   $04,x
         beq   L04A2
         tfr   x,y
         leax  $05,y
         pshs  x
         ldd   ,y
         stx   ,y
         subd  ,s++
         beq   L04A2
         pshs  b,a
         lda   $04,y
         puls  y
         os9   I$Write
         bcs   L04A0
         puls  pc,y,x,b,a
L04A0    stb   <u0003
L04A2    puls  pc,y,x,b,a
L04A4    pshs  u
L04A6    ldu   ,x
         cmpu  $02,x
         beq   L04B7
         lda   ,u+
         stu   ,x
         andcc #$FE
         puls  pc,u
L04B5    pshs  u
L04B7    pshs  y,x
         tfr   x,y
         lda   $04,y
         leax  $05,y
         stx   ,y
         ldy   #$0036
         os9   I$Read
         sty   <u0006
         puls  y,x
         bcs   L04D9
         ldd   <u0006
         leau  $05,x
         leau  d,u
         stu   $02,x
         bra   L04A6
L04D9    cmpb  #$D3
         bne   L04E1
         orcc  #$03
         puls  pc,u
L04E1    orcc  #$01
         andcc #$FD
         stb   <u0003
         puls  pc,u
L04E9    ldx   <u0018
         lda   $04,x
         ldx   #$0000
         os9   I$Seek
         rts
L04F4    ldb   #$0E
         os9   I$GetStt
         rts
         lda   #$00
         ldx   <u0038
         bsr   L04F4
         rts

*EQUATE FOR STYFIX
TXTBEG EQU *

*ESCAPE CHARACTER CONSTANTS
ESCTBL EQU *

CURUC    fcb   $49 I L0501
         fcb   $4C L
L0503    fcb   $2C ,
         fcb   $4A J
         fcb   $55 U
         fcb   $4D M
         fcb   $59 Y
         fcb   $40 @
         fcb   $46 F
         fcb   $52 R
         fcb   $3B ;
         fcb   $57 W
         fcb   $5A Z
         fcb   $53 S
         fcb   $2F /
         fcb   $44 D
         fcb   $4F O
         fcb   $2E .
L0513    fcb   $4B K
L0514    fcb   $50 P
         fcb   $7D
         fcb   $14 
         fcb   $2D -
 FCC '7' SCROLL LEFT
 FCC '9' SCROLL RIGHT
 FCC '1' OVERWRITE 1
 FCC '^' INSERT 1

*CHARACTER MOD CHARACTERS (ALSO CONTROL)
L051C    fcb   $15
L051D    fcb $0F
L051E   fcb $02
L051F    fcb $19
L0520    fcb   $0B
L0521    fcb   $11
         fcb   $20
BSC    fcb   $08 L0523
       fcb $0C,$0A,$09,$60
L0528    fcb   $18
L0529   fcb $04
L052A   fcb $17,$06
L052C   fcb $0E
L052D   fcb $16
L052E   fcb $10,$07,$12,$1E,$01,$05
L0534    fcb   $1B
L0535    fcb   $14
L0536    fcb   $15
L0537   fcb $2D
L0538 fcb $7C
L0539   fcb $2C
L053A  fcb $7D
L053B   fcb $23,$7C
L053D    fcb   $3E
L053E    fcb   $3C
YCHR    fcb   $59 Y L053F
NCHR    fcb   $4E N L0540
SCHR FCC 'S' STOP
L0542    fcb   $41 A
L0543    fcb $53
L0544    fcb $54
L0545    fcb   $42 B
L0546    fcb   $43 C
L0547    fcb   $4E N
L0548    fcb   $45 E
L0549    fcb $57
L054A    fcb $58
L054B    fcb $59
L054C    fcb $5A
L054D    fcb $54
L054E    fcb $50
L054F    fcb $4D
L0550    fcb $7D
L0551    fcb $7B
L0552    fcb $00
L0553    fcb $00
L0554    fcb $00
L0555    fcb $00
L0556  fcb $00
L0557    fcb   $42 B
L0558    fcb $0C
L0559 fcb $06
L055A    fcb $04,$00
L055C    fcb $00
L055D  fcb 00
L055E    fcb $00
L055F fcb $05
         fcb $F7
L0561 fcb $06,$6B
L0563    fcb $06,$95
         fcb $06,$9E
L0567    fcb $06,$C7
L0569    fcb $06,$62
L056B    fcb $06,$72
         fcb $06,$7D
L056F    fcb $06,$89
L0571    fcb $06,$8E
L0573    fcb $06,$D9
L0575    fcb $06,$DE
L0577    fcb $06,$F5
L0579    fcb $07,$00
L057B    fcb $07,$0E
L057D    fcb $07,$2C
L057F    fcb $07,$48
L0581    fcb $07,$54
L0583    fcb $07,$79
L0585    fcb $07,$AE
L0587    fcb $07,$C0
L0589    fcb $07,$DC
L058B    fcb $07,$FD
L058D    fcb $08,$0D
L058F    fcb $08,$37
         fcb $08,$4C
L0593    fcb $08,$C7
L0595    fcb $08,$D6
L0597    fcb $09,$C5
L0599    fcb $09,$DA
L059B    fcb $09,$E9
L059D    fcb $0A,$07
L059F    fcb $0A,$19
L05A1    fcb $0A,$47
L05A3    fcb $0A,$68
L05A5    fcb $0A,$73
L05A7    fcb $0A,$80
L05A9    fcb $0A,$9B
L05AB    fcb $0A,$B2
L05AD    fcb $0A,$C4
L05AF    fcb $0A,$E0
L05B1    fcb $0B,$12
L05B3    fcb $0B,$2B
L05B5    fcb $0B,$3C
L05B7    fcb $0B
L05B8    fcb   $4E
L05B9    fcb $08,$FC
L05BB    fcb $09,$1B
L05BD    fcb $09,$39
L05BF    fcb $09,$56
L05C1    fcb $09,$60
L05C3    fcb $09,$6B
L05C5    fcb $09,$89
L05C7    fcb $09,$9B
L05C9    fcb $09,$A9
L05CB    fcb $0B,$69
L05CD    fcb $0B,$76
L05CF    fcb $0B,$97
L05D1    fcb   $0B,$A9
L05D3    fcb $0B,$B6
L05D5    fcb $0B,$C3
L05D7    fcb   $0B,$D8
L05D9    fcb $0B,$E4
L05DB    fcb $0B,$F3
L05DD   fcb $0D,$F7
L05DF    fcb $0E,$29
L05E1    fcb $0E,$BA
         fcb $0E,$C2
         fcb $0E,$CA
         fcb $0E,$D2
         fcb $0E,$DA
         fcb $0E,$E2
         fcb $0E,$EA
L05EF    fcb $0E,$F3
L05F1    fcb $08,$5B
         fcb $08,$94

TMODE fdb $0EFD
*FORMAT COMMAND TABLE
XFMTTBL EQU *  $05F7
 FCC 'CE'
 FCB 0
 FCC 'LL'
 FCB 0
 FCC 'RJ'
 FCB 0
 FCC 'TF'
 FCB 0
 FCC '*'
 FCB 0
 FCC 'PL'
 FCB 0
 FCC 'RU'
 FCB 0
 FCC 'NJ'
 FCB 0
 FCC 'LM'
 FCB 0
 FCC 'SP'
 FCB 0
 FCC 'SS'
 FCB 0
 FCC 'HD'
 FCB 0
 FCC 'FT'
 FCB 0
 FCC 'JU'
 FCB 0
 FCC 'PN'
 FCB 0
 FCC 'PG'
 FCB 0
 FCC 'SI'
 FCB 0
 FCC 'IN'
 FCB 0
 FCC 'VT'
 FCB 0
 FCC 'CS'
 FCB 0
 FCC 'VS'
 FCB 0
 FCC 'PS'
 FCB 0
 FCC 'NPS'
 FCB 0
 FCC 'PC'
 FCB 0
 FCC 'MMC'
 FCB 0
 FCC 'PADC'
 FCB 0
 FCC 'NL'
 FCB 0
 FCC 'PP'
 FCB 0
 FCC 'PPSI'
 FCB 0
 FCC 'PPSP'
 FCB 0
 FCC 'PPNL'
 FCB 0
 FCC 'BFS'
 FCB 0
 FCB 0 END OF TABLE


L0662    fcc   "STYPSTAT"
         fcb   $00

XERRTBL  fcc   "STYERR"
         fcb   $00
L062C    fcc   "---NONE---"
         fcb   $00
L0637    fcc   "STATUS:    "
         fcb   $00
L0643    fcc   "OPEN"
         fcb   $00
L0648    fcc   "CLOSED"
         fcb   $00
XBELS1   fcc   "NO ERROR"
         fcb   $00
* L069E 
* $0658
XBAVM1   fcc   "CANNOT MOVE TO LAST PAGE, TOO MANY PAGES"
 FCB 0
XPAGS1 FCC "*********** PAGE="
 FCB 0
XPGBS1 FCC 'PAGE'
 FCB 0
XSAVM1 FCC 'Save under file name "'
 FCB 0
XSAVMB FCC '" (Y*/N)? '
 FCB 0
XSAVM2 FCC 'NO TEXT SAVED'
 FCB 0
XSAVM3 FCC 'PART OR ALL OF TEXT NOT SAVED'
 FCB 0
XSAVM4 FCC 'Delete backup file (Y*/N)? '
 FCB 0
XSAVM5 FCC 'File name? '
 FCB 0
L0754 FCC 'NOT ENOUGH MEMORY - FILE NOT SAVED!!'
 FCB 0
L0779 fcc "               PLEASE SAVE UNDER A UNIQUE FILE NAME."
 FCB 0
XSVMS1 FCC 'Marker not found.'
 FCB 0
XDSTM1 FCC 'WARNING! FILE TOO LARGE - '
         fcb   $0D
         fcb   $0A
XDSTM2 FCC 'ENTIRE FILE MAY NOT BE LOADED!!!'
 FCB 0
XDSTM3 FCC 'FILE NOT LOADED'
 FCB 0
* L080D
XDSTM5 FCB $D,$A
 FCC 'ILLEGAL PRINTER, TERMINAL, OR FILE NAME'
 FCB 0
XDSTM6 FCC 'INPUT FILE NOT FOUND-'
XDSTM7 FCC 'NO TEXT LOADED'
 FCB 0
*NOTE: Typo in original code: NUMBBER
L085B fcc "BAD TERM_STY/PRINT_STY OR TERMINAL/PRINTER NUMBBER!!!!"
         fcb   $0D
         fcb   $0A
         fcb   $00
L0894    fcc "CANT FIND PRINTER FILE."
         fcb   $0D
         fcb   $0A
         fcc  "ENTER CORRECT PATHNAME:"
         fcb   $0D
         fcb   $0A
         fcb   $00
XOSPS1   fcc  "DOS command:  "
         fcb   $00
XOSPS2 FCB 7
 FCC 'Command not allowed with files open.'
 FCB 0
XPSQS1 FCC 'Hit any key to restart printer'
 FCB 0
XNEWM1 FCC 'No dump.  Cursor on top page.'
 FCB 0
XNEWM3 fcc "Dump text in memory (Y*/N)? "
 FCB 0
XNEWM4 fcc 'Dump to "'
 FCB 0
XNEWM5 fcc '" (Y*/N)? '
 FCB 0
XNEWM6 FCC 'Fill from input file (Y*/N)? '
 FCB 0
XNEWM7 FCC 'No room for fill.'
 FCB 0
XNEWM8 FCC 'DISK ERROR!!!'
 FCB 0
XNEWM9 FCC 'No fill.  Input file empty.'
 FCB 0
XEXTM1 FCC 'Is the text secure? '
 FCB 0
XEXTM2 FCC 'Are you sure? '
 FCB 0
XERMM1 FCC 'Erase entire file in memory? '
 FCB 0

XPSWS1 FCC 'STYPS'
 FCB 0,0,0,0,0,0,0,0,0,0,0,0,0
XPSWS2 FCC 'ERROR - PROPORTIONAL SPACING TABLE NOT LOADED'
 FCB 0
XPSWS3 FCC 'Set proportional spacing table "'
 FCB 0
XPSWS4 FCC '" (Y*/N)? '
 FCB 0
XPSWS5 FCC 'Table name? '
 FCB 0

XPRNS1 FCC 'Different printer (Y/N*)? '
 FCB 0
XPRNS2 FCC 'PRINT DRIVER NOT FOUND'
 FCB 0
XPRNS3 FCC '   Printer name? '
 FCB 0
XPRNS4 FCC 'Stop for new pages (Y/N*)? '
 FCB 0
XOTXS1 FCC "Hit SPACE to pause or continue, RETURN to abort. "
 FCB 0
XOTXS2 FCC 'Print all pages (Y*/N)? '
 FCB 0
XOTXS3 FCC '   First page = '
 FCB 0
XOTXS4 FCC '     Last page = '
 FCB 0
XSPLS1 FCC 'Spooled output file name? '
 FCB 0
XFNDS1 FCC '*** FIND    '
 FCB 0
XFNDS2 FCC '*** STOP (RET) OR CONTINUE (SP)?'
 FCB 0
XFNDS3 FCC ' UPPER/LOWER CASE'
 FCB 0
XRPLS1 FCC '*** REPLACE '
 FCB 0
XRPLS2 FCC '*** WITH    '
 FCB 0
XRPLS3 FCC '*** REPLACE (Y-N-A)?'
 FCB 0
XBDLS1 FCC '*** DELETE '
 FCB 0
XBDLS2 FCC '  CHARACTERS? '
 FCB 0

* L0BF3
XSUPS1 equ *
 fcc   "EDIT -------- return to ESCAPE mode to edit text"
 FCB 0
 FCC   'PRINT ------- print the text'
 FCB 0
 FCC   "SAVE/RETURN - save the text and return to DOS"
 FCB 0
 fcc   "SAVE -------- save the text"
 FCB 0
 FCC   'SAVE TO MARK- save text from cursor to marker'
 FCB 0
 fcc   "RETURN ------ return to disk operating system"
 FCB 0
 fcc   "LOAD -------- insert file at cursor position"
 FCB 0
 fcc   "ERASE ------- erase text without saving it"
 FCB 0
 fcc   "PASS -------- pass command to operating system"
 FCB 0
 fcc   "SPOOL ------- output text to disk to print later"
 FCB 0
 fcc   "WHEEL ------- specify proportional spacing wheel"
 FCB 0
 fcc   "NEW --------- new text from input file"
 FCB 0

* L0DF7
XBANNER FCC "STYLOGRAPH WORD PROCESSING SYSTEM V3.1.2 (c) 1984"
 FCB 0

XHLPS1 FCC 'RETURN'
 FCB 0
 FCC 'ESCAPE Commands'
 FCB 0
 fcc 'CONTROL Commands'
 FCB 0
 FCC 'FORMAT Commands (vertical)'
 FCB 0
 fcc 'FORMAT Commands (horizontal)'
 FCB 0
 FCC 'FORMAT Commands (misc.)'
 FCB 0
 fcc 'Displayed character mods'
 FCB 0
XHLPS2 FCC "STYHLP1"
 FCB 0
XHLPS3 FCC "STYHLP2"
 FCB 0
XHLPS4 FCC "STYHLP3"
 FCB 0
XHLPS5 FCC "STYHLP4"
 FCB 0
XHLPS6 FCC "STYHLP5"
 FCB 0
XHLPS7 FCC "STYHLP6"
 FCB 0

L0EEA FCC "TERM_STY"
 FCB 0
L0EF3 FCC "PRINT_STY"
 FCB 0

XTMODE   fcc   "TMODE  -PAUSE"
         fcb   $0D
 FCB 0

*SAVE A FEW BYTES FOR POSSIBLE LARGER TEXT OVERLAY
         fcc   "^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^"
TXTEND equ *
XSTYP1  fcc "                            /P"

         fcb   $00

STYDIR   FCC "                       /D0/STY"
         fcb   $00

L0F78         fdb $0F3A

L0F7A     FCC "_BAK"

         fcb   $00

RENAME FCC 'rename'
 FCB $0D
SHELL FCC 'shell'
 FCB $0D

L0F8C  lda   <u0043    Load active model number
    cmpa  #$04  Number of types
    bhi   L0F95
         tsta
         bne   L0F98
L0F95    orcc  #$01
         rts

L0F98    deca
         ldb   #$13
         mul
         leax  >L0FED,pcr
         leax  d,x
         clrb
         ldy   <u0044
L0FA6    incb
         lda   b,x
         bne   L0FB0
         ldu   #$0000
         bra   L0FBB

L0FB0    leau  >TRMSEQ,pcr
L0FB4    tst   ,u+
L0FB6    bpl   L0FB4
         deca
         bne   L0FB4
L0FBB    decb
         lslb
         stu   b,y
         asrb
         incb
         cmpb  #$12
         bcs   L0FA6
         leau  >L0FDD,pcr
         lda   ,x
         sta   <u0046
         anda  #$07
         lsla
         ldd   a,u
         std   <u0047
         lda   ,x
         anda  #$20
         sta   <u0049
         andcc #$FE
         rts

L0FDD equ *
         fcb   23,78  D2479
         fcb   23,49  D2450
         fcb   15,32  D1633

TRMBEG equ *       Address $0FE3
         fdb   L1039
         fdb   L12A0
         fdb   L12A0
         fdb   L12A0
         fdb   L12A0

*TERMINAL SPECIFICATION CONSTANTS
D2479 EQU 0  24 ROW BY 79 COLUMNS
D2450 EQU 1  24 X 50
D1633 EQU 2  16 X 33

* L0FED
L0FED   fcb $71,$01,$00,$00,$00,$00,$04,$05,$06,$07,$08,$09
        fcb $00,$00,$00,$00,$00,$00,$00
        fcb $D0,$0C,$0D,$0E,$0F,$10,$01,$11,$12,$00,$00,$00
        fcb $13,$14,$00,$00,$00,$00,$00
        fcb $31,$16,$00,$00,$00,$00,$04,$17,$18,$19,$00,$00
        fcb $1A,$1B,$00,$1D,$1E,$00,$00
        fcb $50,$01,$00,$00,$00,$00,$04,$1F,$20,$00,$00,$00
        fcb $21,$22,$00,$00,$00,$00,$00

L1039    pshs  u,y,x,b,a
         ldd   >TMODE,pcr
         leax  >0,pcr
         leax  d,x
         stx   <u0063
         ldy   <u0012
L104A    lda   ,x+
         sta   ,y+
         bne   L104A
         lda   #$0D
         sta   ,y
         ldy   #$0100
         ldd   #$0001
         ldx   <u0012
         ldu   <u0012
         os9   F$Fork
         bcs   L106C
         os9   F$Wait
         bcs   L106C
L1069    puls  u,y,x,b,a
         rts

L106C    lda   #$03
         lbsr  L2B46
         bra   L1069



*------------ TERMINAL SEQUENCES ---------------
*THESE ARE THE SEQUENCES THAT ARE NORMALLY SENT TO THE
*TERMINAL FOR THE VARIOUS FUNCTIONS.
*THEY ARE IN "SERIAL" ORDER AND ARE POINTED TO
*BY THE BYTES IN THE TERMINAL SEQUENCE POINTERS
*DEFINED PREVIOUSLY.
*THE SEQUENCES ALWAYS END WITH THE "N" BIT SET.

N EQU $80
M EQU $FF


* Location L1073
TRMSEQ equ *

*0  - NO FUNCTION, DO NOT MODIFY THIS BYTE
         fcb   N
*1
         fcb   $02+N
         fcb   $1B
         fcb   $56
         fcb   $1B
         fcb $57,$AA,$1B,$D6,$8C,$83,$01,$1B,$46
         fcb   $02
         fcb $00,$A3,$01,$1B,$C5,$0C,$1B,$58,$30,$1B,$56,$1B,$57,$AA
         fcb $1B,$F1,$1B,$52,$20,$1B,$53,$A3,$1B,$52,$23,$1B,$53,$A0
         fcb $94,$1B,$2E,$82,$1B,$2E,$80,$1B,$2E,$81,$1B,$2E,$82
         fcb $0D,$85,$14,$18,$00,$8A,$86,$86,$80,$1B,$C1,$0D
         fcb  $1B,$C2,$1B,$41,$00,$17,$8A,$0B,$1B,$C4,$1B,$C7
         fcb $1B,$C6,$00,$FF,$1B,$C8,$1B,$C9
         fcb $1B,$C1,$02,$00,$18,$8A,$1B,$53,$A0,$1B,$53,$A1

TRMEND   equ *

* L10D7
OUTREPT    pshs  b
         ldb   <u0041
         cmpb  <u0048
         puls  b
         bhi   L10E6
         inc   <u0041
         lbra  WrA2BUF

L10E6    rts

L10E7    lbsr  L1982
L10EA    pshs  b
         andb  #$01
         beq   L10F7
         ldb   #$1C
         lbsr  L116E
         beq   L10FD
L10F7    ldb   ,s
         andb  #$FE
         beq   L1102
L10FD    ldb   #$18
         lbsr  L116E
L1102    ldb   <u0041
         cmpb  <u0048
         bhi   L110D
         inc   <u0041
         lbsr  WrA2BUF
L110D    ldb   ,s
         andb  #$01
         beq   L111A
         ldb   #$1E
         lbsr  L116E
         beq   L1120
L111A    ldb   ,s
         andb  #$FE
         beq   L1125
L1120    ldb   #$16
         lbsr  L116E
L1125    puls  pc,b

* L1127
GOROWCOL    std   <u0040
         pshs  x
         ldb   #$00
         bsr   L116E
         bcs   L1155
         ldx   <u0044
         ldb   <u0046
         bitb  #$80
         beq   L1157
         lda   <u0040
         bitb  #$40
         beq   L1141
         adda  #$20
L1141    lbsr  WrA2BUF
         lda   <u0041
         ldx   <u0044
         ldb   <u0046
         bitb  #$40
         beq   L1150
L114E    adda  #$20
L1150    lbsr  WrA2BUF
         ldd   <u0040
L1155    puls  pc,x
L1157    lda   <u0041
         bitb  #$40
         beq   L115F
         adda  #$20
L115F    lbsr  WrA2BUF
         lda   <u0040
         ldx   <u0044
         ldb   <u0046
         bitb  #$40
         beq   L1150
         bra   L114E
L116E    pshs  x,b,a
         ldx   <u0044
         ldx   b,x
         beq   L118B
         lda   $01,x
         cmpa  #$FF
         beq   L118D
L117C    lda   ,x+
         pshs  a
         lbsr  WrA2BUF
         lda   ,s+
         bpl   L117C
         andcc #$FE
L1189    andcc #$FB
L118B    puls  pc,x,b,a

* Call macro in TRMBEG table
L118D    ldb   ,x
         lslb
         leax  >TRMBEG,pcr
         ldd   b,x
         leax  >0,pcr
         leax  d,x
         ldd   <u0040
         pshs  u
         leau  >WrA2BUF,pcr
         jsr   ,x
         puls  u
         orcc  #$01
         bra   L1189
L11AC    pshs  b
         ldb   #$04
         bsr   L116E
         puls  pc,b
L11B4    pshs  b
         ldb   #$02
         bsr   L116E
         puls  pc,b
L11BC    pshs  x,b
         clr   <u0040
         clr   <u0041
         ldb   #$0A
         bsr   L116E
         lbsr  L0112
         ldx   #$1F40
L11CC    leax  -$01,x
         bne   L11CC
         puls  pc,x,b
L11D2    pshs  b,a
         ldb   #$0E
         bsr   L116E
         ldd   <u0040
         deca
         lbsr  GOROWCOL
         puls  pc,b,a
L11E0    pshs  b,a
         ldb   #$10
         bsr   L116E
         beq   L11EE
         ldd   <u0040
         inca
         lbsr  GOROWCOL
L11EE    puls  pc,b,a
L11F0    pshs  x,b
         clr   <u0040
         clr   <u0041
         ldb   #$12
         lbsr  L116E
         lbsr  L0112
         ldx   #$2710
L1201    leax  -$01,x
         bne   L1201
         puls  pc,x,b
L1207    pshs  b
         ldb   #$14
         lbsr  L116E
         puls  pc,b
         pshs  b
         ldb   #$1A
         lbsr  L116E
         puls  pc,b
         pshs  b
         ldb   #$20
         lbsr  L116E
         puls  pc,b
         pshs  b
         ldb   #$1E
         lbsr  L116E
         puls  pc,b
         pshs  b
         ldb   #$1C
         lbsr  L116E
         puls  pc,b
L1234    pshs  b
         ldb   #$08
         lbsr  L116E
         puls  pc,b
L123D    pshs  b
         ldb   #$06
         lbsr  L116E
         puls  pc,b
L1246    pshs  x,b,a
         ldd   <u0040
         pshs  b,a
         ldd   $02,s
         clrb
         lbsr  GOROWCOL
         ldb   #$0C
         lbsr  L116E
         beq   L1260
L1259    puls  b,a
         lbsr  GOROWCOL
         puls  pc,x,b,a
L1260    ldb   <u0048
         lda   #$20
L1264    lbsr  WrA2BUF
         decb
         bpl   L1264
         bra   L1259
L126C    clrb
         lbsr  L0301
         bcs   L12A1
         sta   <u0067
L1274    lbsr  L0301
         bcs   L12A1
         pshs  x
         tsta
         bpl   L1285
         cmpa  #$80
         bne   L1285
         ldx   #$0000
L1285    lslb
         stx   b,y
         asrb
         puls  x
         incb
         sta   ,x+
         bmi   L1299
L1290    lbsr  L0301
         bcs   L12A1
         sta   ,x+
         bpl   L1290
L1299    cmpb  <u0067
         bcs   L1274
         lbsr  L029A
L12A0         rts

L12A1    ldx   >L05F1,pcr "Bad sty file"
         lbsr  L02E7
         lbra  L0456
L12AB    ldd   >L05EF,pcr
         leax  >0,pcr
         leax  d,x
         lbsr  L0230
         lbcs  L12A1
         lda   <u004A
         ldb   #$FF
         mul
         addd  #$01B8
         exg   d,u
         lbsr  L04E9
         ldx   <u004B
         leax  <$3A,x
         ldy   <u004B
         lbsr  L0301
         lbcs  L12A1
         sta   <u004D
         lbsr  L0301
         lbcs  L12A1
         sta   <u004E
         lbsr  L0301
         lbcs  L12A1
         sta   <u004F
         lbsr  L0301
         lbcs  L12A1
         sta   <u0050
         lbsr  L0301
         lbcs  L12A1
         sta   <u0051
         lbsr  L0301
         lbcs  L12A1
         sta   <u0052
         lbsr  L0301
         lbcs  L12A1
         sta   <u0053
         lbsr  L0301
         lbcs  L12A1
         sta   <u0054
         lbsr  L0301
         lbcs  L12A1
         sta   <u0055
         lbsr  L0301
         lbcs  L12A1
         sta   <u0056
         lbsr  L0301
         lbcs  L12A1
         sta   <u0057
         lbsr  L0301
         lbcs  L12A1
         sta   <u0058
         lbra  L126C
L1340    pshs  b
         ldb   #$04
L1344    lbsr  L1574
         puls  pc,b
L1349    pshs  b
         ldb   #$06
         bra   L1344
L134F    pshs  b
         ldb   #$08
         bra   L1344
L1355    pshs  b
         ldb   #$1E
         bra   L1344
L135B    tst   <u00E2
         beq   L1366
         clr   <u00DE
         clr   <u00E0
         lbsr  L14E3
L1366    lda   #$0D
         bsr   L137D
         tst   <u00FC
         bne   L1372
         lda   #$0A
         bsr   L137D
L1372    clra
         ldb   <u00FD
L1375    beq   L137C
         bsr   L137D
         decb
         bra   L1375
L137C    rts
L137D    pshs  u
         ldu   <u0059
         jsr   ,u
         puls  pc,u
L1385    pshs  b
         cmpa  <u003F
         beq   L13C4
         sta   <u003F
         ldb   #$20
         cmpa  <u0053
         beq   L13BF
         ldb   #$22
         cmpa  <u0054
         beq   L13BF
         ldb   #$24
         cmpa  <u0055
         beq   L13BF
L139F    ldb   <u004E
         beq   L13C4
         lbsr  L2C70
         puls  b
L13A8    pshs  b
         cmpa  <u003F
         beq   L13C4
         sta   <u003F
         ldb   #$02
         lbsr  L1574
         bcs   L13C4
         adda  <u0052
         bsr   L137D
         andcc #$FE
         bra   L13C4
L13BF    lbsr  L1574
         bcs   L139F
L13C4    puls  pc,b
L13C6    pshs  b
         cmpa  <u003E
         beq   L1405
         sta   <u003E
         ldb   #$26
         cmpa  <u0056
         beq   L1400
         ldb   #$28
         cmpa  <u0057
         beq   L1400
         ldb   #$2A
         cmpa  <u0058
         beq   L1400
L13E0    ldb   <u004F
         beq   L1405
         lbsr  L2C70
         puls  b
         pshs  b
         cmpa  <u003E
         beq   L1405
         sta   <u003E
         ldb   #$00
         lbsr  L1574
         bcs   L1405
         adda  <u0051
         bsr   L137D
         andcc #$FE
         bra   L1405
L1400    lbsr  L1574
         bcs   L13E0
L1405    puls  pc,b
L1407    lda   #$20
         sta   <u0068
         lda   #$0A
         lbsr  L153B
         rts
L1411    lda   #$10
         sta   <u0068
         lda   #$0E
         lbsr  L153B
         rts
L141B    lda   #$04
         sta   <u0068
         lda   #$16
         lbsr  L153B
         bcc   L144A
         lda   #$02
         bita  <u004D
         beq   L144A
         pshs  x,a
         ldx   <u004B
         lda   #$06
         ldx   a,x
         puls  x,a
         beq   L144A
         lbsr  L1340
         bcs   L144A
         lda   #$5F
         lbsr  L137D
         lda   #$08
         lbsr  L137D
         lbsr  L1349
L144A    rts
L144B    lda   #$01
         sta   <u0068
         lda   #$12
         lbsr  L153B
         bcc   L1478
         lda   #$02
         bita  <u004D
         beq   L1478
         tst   <u0030,u
         bne   L1468
         lda   #$5F
         lbsr  L137D
         bra   L1473
L1468    ldx   <u0038
         leax  >$00BE,x
         lda   $01,x
         lbsr  L137D
L1473    lda   #$08
         lbsr  L137D
L1478    rts
L1479    pshs  b
         lda   #$02
         sta   <u0068
         lda   #$1A
         lbsr  L153B
         bcc   L14D6
         lda   #$02
         bita  <u004D
         bne   L1490
         lda   <u00DE
         bra   L14BD
L1490    ldx   <u004B
         lda   #$02
         ldx   a,x
         beq   L14C4
         lda   #$01
         lbsr  L13A8
         bcs   L14C4
         ldb   <u002F,u
         asrb
L14A3    lda   <u00DE
         lbsr  L137D
         lbsr  L137D
         lda   #$08
         lbsr  L137D
         lbsr  L137D
         decb
         bne   L14A3
         lda   <u00DF
         lbsr  L13A8
         lda   #$20
L14BD    lbsr  L137D
L14C0    orcc  #$01
         puls  pc,b
L14C4    ldb   <u002F,u
L14C7    lda   <u00DE
         lbsr  L137D
         decb
         beq   L14C0
         lda   #$08
         lbsr  L137D
         bra   L14C7
L14D6    puls  pc,b
L14D8    lda   #$02
         bita  <u004D
         rts
         lda   #$08
         lbsr  L137D
         rts
L14E3    lda   <u00DE
         cmpa  <u0032,u
         bne   L14F3
         tst   <u0032,u
         beq   L14F3
         lda   #$20
         sta   <u00DE
L14F3    tst   <u0030,u
         beq   L14FB
         lbsr  L19C7
L14FB    clr   <u00E8
         lda   <u00DF
         cmpa  <u0050
         bls   L1509
         suba  <u0050
         sta   <u00E8
         lda   <u0050
L1509    lbsr  L13A8
         ldb   <u00E0
         lbsr  L1407
         lbsr  L1411
         lbsr  L141B
         lbsr  L144B
         lbsr  L1479
         bcc   L1521
         bra   L1528
L1521    lda   <u00DE
         lbsr  L137D
         bra   L1528
L1528    tst   <u00E8
         bne   L152F
         andcc #$FE
         rts
L152F    clr   <u00E0
         lda   #$20
         sta   <u00DE
         lda   <u00E8
L1537    sta   <u00DF
         bra   L14FB
L153B    bitb  <u0068
         beq   L1559
         pshs  a
         lda   <u0068
         bita  <u00EB
         puls  a
         bne   L1571
         exg   a,b
         bsr   L1574
         exg   a,b
         bcs   L1573
         lda   <u00EB
         ora   <u0068
         sta   <u00EB
         bra   L1571
L1559    pshs  a
         lda   <u0068
         bita  <u00EB
         puls  a
         beq   L1571
         inca
         inca
         exg   a,b
         bsr   L1574
         exg   a,b
         lda   <u00EB
         eora  <u0068
         sta   <u00EB
L1571    andcc #$FE
L1573    rts
L1574    pshs  x,b,a
         orcc  #$01
         ldx   <u004B
         ldx   b,x
         beq   L159B
         lda   $01,x
         cmpa  #$FF
         bne   L1586
         jmp   $03,x
L1586    lda   ,x
         anda  #$7F
         beq   L159B
L158C    lda   ,x+
         pshs  a
         anda  #$7F
         lbsr  L137D
         lda   ,s+
         bpl   L158C
         andcc #$FE
L159B    puls  pc,x,b,a

start    lbsr  L0072
         tfr   a,dp
         tfr   d,u
         tfr   d,x
         clra
L15A7    clr   ,u+
         adda  #$01
         bcc   L15A7
         stx   <u0089
         leay  $01,y
         sty   <u006D
         sty   <u0072
         ldx   <u0089
         leay  >$0100,x
         leax  >$02C0,y
         stx   <u0022
         leax  >$02F8,y
         stx   <u0024
         leax  >$0330,y
         stx   <u0026
         leax  >$0368,y
         stx   <u0028
         leax  >$04A0,y
         stx   <u002A
         leax  >$05FE,y
         stx   <u002C
         leax  >$075C,y
         stx   <u002E
         leax  >$075C,y
         stx   <u0030
         leax  >$0772,y
         stx   <u0032
         leax  >$07A9,y
         stx   <u0034
         leax  ,y
         stx   <u001E
         leax  >$015E,y
         stx   <u0020
         leax  >$0BC8,y
         stx   <u0036
         leax  >$03A0,y
         stx   <u0038
         leax  >$015F,y
         stx   <u0044
         leax  >$0187,y
         stx   <u004B
         leax  >$09D4,y
         stx   <u003C
         leax  >$07E0,y
         stx   <u003A
         leax  >$156E,y
         stx   <u008B
         leax  ,x
         stx   <u0081
         lbsr  L0077
         lds   <u0020
         lda   #$00
         sta   <u004A
         lda   >L000D,pcr
         sta   <u0043
         lda   >L000F,pcr
         sta   <u0071
         lbsr  L3472
         lbsr  L0F8C
         lbsr  L11F0
         lbsr  L12AB
         lda   >L0012,pcr
         sta   <u00FC
         lda   >L0013,pcr
         sta   <u00FD
         ldx   <u0081
         lda   <u0071
         ldb   #$38
         mul
         leax  d,x
         stx   <u006B
         stx   <u007C
         ldd   #$FFFF
         std   <u008D
         sta   <u007E
         inc   <u0079
         ldx   <u002C
         stx   <u0093
         lda   <u0047
         inca
         sta   <u006F
         ldx   <u0038
         clra
         ldb   #$0A
L1683    stb   ,x+
         sta   ,x+
         inca
         bpl   L1683
         ldx   <u0030
         ldb   #$16
         lda   #$08
L1690    sta   ,x+
         decb
         beq   L1699
         adda  #$08
         bra   L1690
L1699    clr   <u00FB
         lda   #$00
         sta   <u00FA
         ldy   <u0081
         ldb   #$38
L16A4    clr   ,y+
         decb
         bne   L16A4
         ldy   <u0081
         ldd   <u006B
         std   $04,y
         ldx   #$0000
         stx   ,y
         ldb   <u0048
         leax  b,x
         stx   $02,y
         ldb   >L0552,pcr
         stb   <$17,y
         stb   <$18,y
         ldb   >L0553,pcr
         bne   L16CD
         ldb   <u0048
L16CD    stb   <$1C,y
         ldb   >L0556,pcr
         stb   <$26,y
         ldb   >L0557,pcr
         stb   <$2B,y
         incb
         stb   <$1B,y
         ldb   >L0554,pcr
         stb   <$24,y
         ldb   >L0555,pcr
         bne   L16F1
         ldb   <u0048
L16F1    stb   <$20,y
         com   $08,y
         ldb   >L0558,pcr
         stb   <$2D,y
         ldb   >L0559,pcr
         stb   <$2E,y
         ldb   >L055A,pcr
         stb   <$2F,y
         ldb   #$01
         ldb   >L055C,pcr
         stb   <$32,y
         ldb   >L055D,pcr
         stb   <$33,y
         ldb   >L055E,pcr
         stb   <$31,y
         stb   <$12,y
         tfr   y,x
         ldy   <u0024
         ldd   #$0038
         lbsr  L3F31
         ldu   <u0024
         ldx   <u006D
         leax  -$01,x
         stx   u0006,u
         stx   u0004,u
         lda   #$F0
         sta   ,x
         lbsr  L1D78
         lbra  L4F26
L1744    lbsr  L017A
         beq   L1755
L1749    lbsr  L012B
         anda  #$7F
         tst   <u00AD
         beq   L1754
         bsr   L1760
L1754    rts
L1755    bsr   L176B
         bcs   L1744
         lbsr  L2BB7
         bcs   L1744
         bra   L1749
L1760    cmpa  #$61
         bcs   L176A
         cmpa  #$7A
         bhi   L176A
         suba  #$20
L176A    rts
L176B    pshs  u,y,x,b,a
         tst   <u00A0
         bne   L17B0
         tst   <u0095
         bne   L1779
         andcc #$FE
         bra   L17AE
L1779    ldu   <u0028
         ldx   <u0091
         ldd   ,u
         std   ,x
         ldd   u0004,u
         std   $02,x
         lda   u0008,u
         sta   $04,x
         leax  $05,x
         stx   <u0091
         ldx   <u002C
         cmpx  <u0091
         beq   L17AA
L1793    lbsr  L1D78
         tst   TTYSTATE,u
         beq   L17AA
         tst   u0008,u
         beq   L17A6
         lda   [,u]
         cmpa  >L0539,pcr
         beq   L1793
L17A6    orcc  #$01
         bra   L17AE
L17AA    clr   <u0095
         orcc  #$01
L17AE    puls  pc,u,y,x,b,a
L17B0    clr   <u00A0
         lda   #$01
         sta   <u0095
         ldd   <u008F
         cmpd  <u0061
         beq   L17DC
         subd  #$0001
         std   <u008D
         subd  <u0061
         lda   #$38
         mul
         ldx   <u0081
         leax  d,x
         ldy   <u0028
         ldd   #$0038
         lbsr  L3F31
         ldx   <u002A
         stx   <u0091
         orcc  #$01
         bra   L17AE
L17DC    clr   <u0095
         ldd   #$FFFF
         std   <u008D
         andcc #$FE
         bra   L17AE
L17E7    lbsr  L11BC
         lbsr  L1207
         lbra  L0456
L17F0    sta   <u00D7
         tst   <u005C
         lbne  L192A
         tst   <u00A6
         bne   L1802
         lda   #$FF
         sta   <u00D8
         clr   <u00DA
L1802    cmpu  <u0024
         bne   L1832
         lda   <u00D7
         beq   L1832
         cmpa  #$A0
         beq   L1832
         tst   <u00D9
         bne   L181A
         cmpy  u0006,u
         bne   L1832
         bra   L182E
L181A    lda   <u00A6
         cmpa  <u0080
         bhi   L1825
         sty   u0006,u
         bra   L182E
L1825    lda   <u00D8
         cmpa  #$FF
         bne   L1832
         sty   u0006,u
L182E    lda   <u00A6
         sta   <u00D8
L1832    lda   <u00D7
         beq   L187D
         cmpa  #$F0
         beq   L187D
         lda   <u00A6
         cmpa  <u00A5
         bcs   L187D
         tst   <u0041
         bne   L1859
         tst   <u00A5
         beq   L1859
         lda   #$01
         sta   <u00DA
         tst   <u0083
         beq   L1859
         lda   >L053E,pcr
         lbsr  OUTREPT
         bra   L187D
L1859    lda   <u00A6
         suba  <u00A5
         cmpa  <u0048
         bcs   L1876
         bhi   L187D
         tst   <u0083
         beq   L186E
         lda   >L053D,pcr
         lbsr  OUTREPT
L186E    lda   <u00DA
         ora   #$50
         sta   <u00DA
         bra   L187D
L1876    tst   <u0083
         beq   L187D
         lbsr  L1B26
L187D    lda   <u00D7
         beq   L1888
         cmpa  #$F0
         beq   L1888
         inc   <u00A6
         rts
L1888    lda   <u00A6
         suba  <u00A5
         bcs   L18AF
         cmpa  <u0048
         bhi   L18D2
         beq   L18B3
         lda   #$20
         tst   <u0041
         bne   L18A8
         tst   <u00A5
         beq   L18A8
         lda   #$01
         andb  <u00DA
         stb   <u00DA
         lda   >L053E,pcr
L18A8    tst   <u0083
         beq   L18AF
         lbsr  OUTREPT
L18AF    inc   <u00A6
         bra   L1888
L18B3    tst   <u00DA
         bmi   L18D2
         tst   <u0083
         beq   L18D2
         tst   <u00D7
         beq   L18CD
         tst   u0008,u
         beq   L18C7
         lda   #$2D
         bra   L18CF
L18C7    lda   >L0538,pcr
         bra   L18CF
L18CD    lda   #$20
L18CF    lbsr  OUTREPT
L18D2    cmpu  <u0024
         bne   L1929
         clr   <u00A4
         ldd   u0006,u
         cmpd  ,u
         bcs   L1929
         cmpd  u0002,u
         bcc   L1929
         lda   <u00D7
         cmpa  #$F0
         bne   L18F4
         cmpy  u0006,u
         bne   L18F4
         ldb   <u0048
         bra   L1924
L18F4    ldb   <u00D8
         subb  <u00A5
         bcs   L191B
         cmpb  <u0048
         bhi   L1920
         tst   <u00DA
         beq   L1924
         tstb
         bne   L190F
         lda   <u00DA
         bita  #$01
         beq   L1924
         inc   <u00A4
         bra   L1924
L190F    cmpb  <u0048
         bne   L1924
         tst   <u00DA
         bpl   L1924
         inc   <u00A4
         bra   L1924
L191B    inc   <u00A4
         clrb
         bra   L1924
L1920    inc   <u00A4
         ldb   <u0048
L1924    lda   <u0040
         lbsr  GOROWCOL
L1929    rts
L192A    tsta
         beq   L1981
         cmpa  #$F0
         beq   L1981
         cmpa  #$A0
         beq   L1955
         lda   ,y
         cmpa  <u0031,u
         lbeq  L1A08
         tsta
         bpl   L1955
         cmpa  #$F1
         bne   L194F
         leax  $01,y
         cmpx  u0002,u
         bne   L1981
         lda   #$2D
         bra   L1955
L194F    bsr   L1982
         lda   $01,y
         bra   L1957
L1955    clr   <u00E0
L1957    cmpa  >L053B,pcr
         bne   L1960
         lbsr  L1B66
L1960    anda  #$7F
         sta   <u00DE
         tst   <u00E5
         beq   L1972
         dec   <u00E5
         bne   L1972
         tst   <u00E4
         beq   L1972
         dec   <u00E4
L1972    lda   <u002D,u
         ldb   <u004E
         lbsr  L2C70
         adda  <u00E4
         sta   <u00DF
         lbra  L14E3
L1981    rts
L1982    ldb   ,y
         andb  #$7F
         cmpb  #$5F
         beq   L19BF
         cmpb  #$7E
         beq   L19C3
         decb
         stb   <u0067
         bitb  #$08
         lbne  L19BC
         andb  #$70
         cmpb  #$30
         bne   L19A3
         ldb   #$0F
         andb  <u0067
         bra   L19B9
L19A3    cmpb  #$40
         bne   L19AF
         ldb   #$0F
         andb  <u0067
         addb  #$10
         bra   L19B9
L19AF    cmpb  #$60
         bne   L19BC
         ldb   #$0F
         andb  <u0067
         addb  #$20
L19B9    stb   <u00E0
         rts
L19BC    clrb
         bra   L19B9
L19BF    ldb   #$01
         bra   L19B9
L19C3    ldb   #$02
         bra   L19B9
L19C7    pshs  x,b,a
         lda   <u00DE
         beq   L19E2
         anda  #$7F
         ldx   <u0038
         lsla
         tfr   a,b
         abx
         ldb   ,x
         lda   <u00E2
         stb   <u00E2
         adda  <u00E2
         asra
         adda  <u00E4
         sta   <u00DF
L19E2    ldb   <u00E1
         ldx   <u0038
         lslb
         abx
         lda   $01,x
         ldb   <u00DE
         sta   <u00DE
         stb   <u00E1
         ldb   <u00E0
         lda   <u00E3
         stb   <u00E3
         sta   <u00E0
         tst   <u00E1
         beq   L19FE
L19FC    puls  pc,x,b,a
L19FE    lda   #$20
         sta   <u00E1
         clr   <u00E2
         clr   <u00E3
         bra   L19FC
L1A08    pshs  x
         sty   <u0065
         leax  $01,y
L1A0F    lda   ,x+
         cmpa  #$F0
         beq   L1A25
         tsta
         bmi   L1A21
         cmpa  <u0031,u
         beq   L1A25
         cmpx  u0002,u
         bcs   L1A0F
L1A21    tfr   x,y
         puls  pc,x
L1A25    ldx   <u0065
L1A27    leax  $01,x
L1A29    lda   ,x
         cmpa  <u0031,u
         beq   L1A21
         cmpa  #$F0
         beq   L1A21
         cmpa  #$20
         beq   L1A27
         cmpa  #$2C
         beq   L1A27
         lbsr  L1760
         cmpa  >L0543,pcr
         beq   L1A83
         cmpa  >L0544,pcr
         beq   L1AAA
         cmpa  >L0545,pcr
         lbeq  L1AE4
         cmpa  >L0549,pcr
         lbeq  L1AFF
         cmpa  >L054A,pcr
         lbeq  L1B0B
         cmpa  >L054B,pcr
         lbeq  L1B14
         cmpa  >L054C,pcr
         lbeq  L1B1D
         lbsr  L4AF1
         bcs   L1A21
         pshs  x
         lbsr  L137D
         puls  x
         leax  -$01,x
         bra   L1A29
L1A83    lda   $01,x
         cmpa  #$20
         beq   L1A94
         cmpa  #$2C
         beq   L1A94
         cmpa  <u0031,u
         lbne  L1A21
L1A94    pshs  x
         lda   #$03
         lbsr  L1246
         ldx   >L05B9,pcr
         lbsr  L3356
         lbsr  L1744
         puls  x
         lbra  L1A27
L1AAA    leax  $01,x
         lbsr  L43D0
         lbcs  L1A21
         pshs  x
         pshs  b
         clr   <u00E0
         clr   <u00DF
         lda   #$20
         sta   <u00DE
         lbsr  L14E3
         lda   #$0D
         lbsr  L137D
         ldy   <u001E
         lda   #$20
         sta   ,y
L1ACE    tst   ,s
         beq   L1ADB
         lda   #$20
         lbsr  L192A
         dec   ,s
         bra   L1ACE
L1ADB    puls  b
         puls  x
         leax  -$01,x
         lbra  L1A29
L1AE4    lda   $01,x
         cmpa  #$20
         beq   L1AF5
         cmpa  #$2C
         beq   L1AF5
         cmpa  <u0031,u
         lbne  L1A21
L1AF5    pshs  x
         lbsr  L14D8
         puls  x
         lbra  L1A27
L1AFF    pshs  b
         ldb   #$2C
         lbsr  L1574
L1B06    puls  b
         lbra  L1A27
L1B0B    pshs  b
         ldb   #$2E
         lbsr  L1574
         bra   L1B06
L1B14    pshs  b
         ldb   #$30
         lbsr  L1574
         bra   L1B06
L1B1D    pshs  b
         ldb   #$32
         lbsr  L1574
         bra   L1B06
L1B26    lda   <u00D7
         cmpa  #$A0
         beq   L1B63
         lda   ,y
         bpl   L1B5B
         cmpa  #$F0
         bne   L1B3A
         lda   >L0538,pcr
         bra   L1B5B
L1B3A    cmpa  #$F1
         bne   L1B42
         lda   #$2D
         bra   L1B5B
L1B42    tst   <u007F
         beq   L1B4E
         cmpa  #$B2
         bne   L1B58
         lda   #$5F
         bra   L1B58
L1B4E    lda   $01,y
         cmpa  >L053B,pcr
         bne   L1B58
         bsr   L1B66
L1B58    lbra  L10E7
L1B5B    cmpa  >L053B,pcr
         bne   L1B63
         bsr   L1B66
L1B63    lbra  OUTREPT
L1B66    tst   u0008,u
         bne   L1B6B
         rts
L1B6B    pshs  x,b
         tst   <u00B3
         beq   L1B82
         ldb   <u00B2
         incb
         ldx   <u0036
         lda   b,x
         beq   L1B7E
         stb   <u00B2
         puls  pc,x,b
L1B7E    lda   #$20
         puls  pc,x,b
L1B82    ldd   <u0011,u
         lbsr  L26C4
         ldx   <u0036
         clrb
L1B8B    lda   b,x
         cmpa  #$20
         bne   L1B94
         incb
         bra   L1B8B
L1B94    stb   <u00B2
         inc   <u00B3
         puls  pc,x,b
L1B9A    ldx   ,u
         lbeq  L1C37
         clr   <u0034,u
         lda   #$05
         sta   <u00F1
         lbsr  L314F
         tst   <u0030,u
         lbne  L1C94
         incb
L1BB2    decb
         beq   L1BFA
         cmpx  <u0072
         beq   L1C2F
         lda   ,x+
         bmi   L1C38
         cmpa  <u0031,u
         bne   L1BB2
         incb
         clr   <u00E9
L1BC5    inc   <u00E9
         cmpa  #$F0
         beq   L1BE6
         tstb
         lda   ,x+
         bmi   L1C2F
         lbsr  L1760
         cmpa  >L0545,pcr
         beq   L1C4D
         cmpa  >L0544,pcr
         lbeq  L1C73
         cmpa  <u0031,u
         bne   L1BC5
L1BE6    lda   <u0034,u
         adda  <u00E9
         sta   <u0034,u
         bra   L1BB2
         lda   <u0034,u
         adda  <u00E9
         sta   <u0034,u
         bra   L1C2F
L1BFA    stx   u0002,u
         tst   u0008,u
         bne   L1C02
         stx   u0004,u
L1C02    lda   ,x
         cmpa  #$20
         bne   L1C10
         leax  $01,x
         dec   <u00F1
         beq   L1C2F
         bra   L1C02
L1C10    cmpa  #$F0
         beq   L1C2D
L1C14    lda   ,-x
         cmpa  #$20
         beq   L1C2D
         cmpa  #$F1
         beq   L1C2D
         cmpa  #$2D
         beq   L1C2D
         cmpa  <u0031,u
         beq   L1C40
         cmpx  ,u
         bne   L1C14
         bra   L1C37
L1C2D    leax  $01,x
L1C2F    stx   u0002,u
         tst   u0008,u
         bne   L1C37
         stx   u0004,u
L1C37    rts
L1C38    cmpa  #$F0
         beq   L1C2F
         incb
         lbra  L1BB2
L1C40    lda   ,-x
         cmpa  <u0031,u
         beq   L1C14
         cmpx  ,u
         bhi   L1C40
         bra   L1C37
L1C4D    lda   -$02,x
         cmpa  #$20
         beq   L1C5E
         cmpa  #$2C
         beq   L1C5E
         cmpa  <u0031,u
         lbne  L1BC5
L1C5E    lda   ,x
         cmpa  #$20
         beq   L1C6F
         cmpa  #$2C
         beq   L1C6F
         cmpa  <u0031,u
         lbne  L1BC5
L1C6F    incb
         lbra  L1BC5
L1C73    pshs  x,b,a
         lbsr  L43D0
         bcs   L1C8F
         stb   <u0068
         ldb   <u00A2
         subb  <u0068
         bcs   L1C8F
         stb   <u0068
         cmpb  #$06
         bcs   L1C8F
         puls  x,b,a
         ldb   <u0068
         lbra  L1BC5
L1C8F    puls  x,b,a
         lbra  L1BC5
L1C94    ldy   <u0038
         lda   <u002D,u
         ldb   <u004E
         lbsr  L2C70
         ldb   <u00A2
         mul
         std   <u0069
L1CA4    cmpx  <u0072
         lbeq  L1D28
         ldb   ,x+
         lbmi  L1D31
         cmpb  <u0031,u
         beq   L1CC8
         lslb
         clra
         ldb   d,y
         stb   <u00E2
         clra
         pshs  b,a
         ldd   <u0069
         subd  ,s++
         std   <u0069
         bcc   L1CA4
         bra   L1CF6
L1CC8    clr   <u00E9
L1CCA    inc   <u00E9
         cmpa  #$F0
         beq   L1CE2
         tsta
         lda   ,x+
         bmi   L1D28
         cmpa  >L0545,pcr
         lbeq  L1D4E
         cmpa  <u0031,u
         bne   L1CCA
L1CE2    lda   <u0034,u
         adda  <u00E9
         sta   <u0034,u
         bra   L1CA4
         lda   <u0034,u
         adda  <u00E9
         sta   <$34,y
         bra   L1D28
L1CF6    leax  -$01,x
         stx   u0002,u
         tst   u0008,u
         bne   L1D00
         stx   u0004,u
L1D00    lda   ,x
         cmpa  #$20
         bne   L1D0E
         leax  $01,x
         dec   <u00F1
         beq   L1D28
         bra   L1D00
L1D0E    cmpa  #$F0
         beq   L1D26
L1D12    lda   ,-x
         cmpa  #$20
         beq   L1D26
         cmpa  #$F1
         beq   L1D26
         cmpa  #$2D
         beq   L1D26
         cmpx  ,u
         bne   L1D12
         bra   L1D30
L1D26    leax  $01,x
L1D28    stx   u0002,u
         tst   u0008,u
         bne   L1D30
         stx   u0004,u
L1D30    rts
L1D31    cmpb  #$F0
         beq   L1D28
         cmpa  #$F1
         lbne  L1CA4
         ldb   #$5A
         clra
         ldb   d,y
         clra
         pshs  b,a
         ldd   <u0069
         subd  ,s++
         lbcs  L1CF6
         lbra  L1CA4
L1D4E    lda   -$02,x
         cmpa  #$20
         beq   L1D5F
         cmpa  #$2C
         beq   L1D5F
         cmpa  <u0031,u
         lbne  L1CCA
L1D5F    lda   ,x
         cmpa  #$20
         beq   L1D70
         cmpa  #$2C
         beq   L1D70
         cmpa  <u0031,u
         lbne  L1CCA
L1D70    ldb   <u00E2
         clra
         addd  <u0069
         lbra  L1CCA
L1D78    tst   u0008,u
         beq   L1D84
         lda   [,u]
         cmpa  >L0539,pcr
         beq   L1DF4
L1D84    ldx   u0002,u
         cmpx  <u0072
         bcs   L1D8F
         lda   #$0A
         orcc  #$01
         rts
L1D8F    cmpu  <u0024
         bne   L1DF4
         ldd   u000F,u
         subd  <u0061
         addb  #$02
         cmpb  <u0071
         bcs   L1DB4
         lda   <u0024,u
         inca
         adda  <u002C,u
         cmpa  <u001B,u
         bcc   L1DAF
         cmpa  <u002B,u
         bcs   L1DB4
L1DAF    lda   #$0B
         orcc  #$01
         rts
L1DB4    tst   u0008,u
         bne   L1DCB
         ldy   <u007C
         sty   <u00BA
         ldx   ,u
L1DC0    lda   ,x+
         sta   ,y+
         cmpx  u0004,u
         bne   L1DC0
         sty   <u007C
L1DCB    ldx   <u002E
         stx   <u0063
         ldx   <u0093
         cmpx  <u0063
         beq   L1DF4
         tst   u0008,u
         bne   L1DE4
         ldd   <u00BA
         std   ,x
         sty   $02,x
         clr   $04,x
         bra   L1DF0
L1DE4    ldd   ,u
         std   ,x
         ldd   <u007C
         std   $02,x
         lda   #$01
         sta   $04,x
L1DF0    leax  $05,x
         stx   <u0093
L1DF4    lbsr  L1EDA
         lda   <u002C,u
         cmpa  <u002B,u
         bhi   L1E60
         cmpa  <u001B,u
         bcc   L1E4B
         cmpa  <u0019,u
         bls   L1E29
         clr   u0008,u
         ldx   u0004,u
L1E0D    stx   ,u
         lbsr  L1B9A
         tst   u0008,u
         beq   L1E26
         ldd   [,u]
         cmpa  >L0539,pcr
         bne   L1E26
         cmpb  >L0539,pcr
         lbne  L1D78
L1E26    andcc #$FE
         rts
L1E29    lda   #$01
         sta   u0008,u
         lda   TTYSTATE,u
         cmpa  #$01
         bne   L1E3F
         ldx   #$0000
         cmpx  ,u
         bne   L1E3F
         ldx   <u0015,u
         bra   L1E41
L1E3F    ldx   u0002,u
L1E41    cmpx  <u007C
         bne   L1E0D
         ldx   <u0024
         ldx   ,x
         bra   L1E0D
L1E4B    lda   #$01
         sta   u0008,u
         ldx   u0004,u
         cmpx  u0002,u
         bne   L1E3F
         lda   <u001B,u
         sta   <u002C,u
         ldx   <u0013,u
         bra   L1E41
L1E60    lda   <u001E,u
         sta   <u0019,u
         lda   <u001F,u
         sta   <u001A,u
         lbsr  L4185
         clr   TTYSTATE,u
         clr   u000D,u
         clr   <u002C,u
         ldx   <u0011,u
         leax  $01,x
         stx   <u0011,u
         ldx   u000F,u
         leax  $01,x
         stx   u000F,u
         lda   #$01
         sta   u0008,u
         ldx   #$0000
         stx   ,u
         stx   u0002,u
         lda   #$01
         sta   u0008,u
         cmpu  <u0024
         beq   L1E9B
         andcc #$FE
         rts
L1E9B    ldy   <u002A
         ldx   <u002C
         ldd   #$015E
         lbsr  L3F31
         ldd   <u0093
         subd  #$015E
         std   <u0091
         ldd   <u008F
         std   <u008D
         addd  #$0001
         std   <u008F
         ldx   <u002C
         stx   <u0093
         clr   <u0095
         ldd   u000F,u
         subd  <u0061
         lda   #$38
         mul
         ldx   <u0081
         leay  d,x
         ldx   <u0024
         ldd   #$0038
         pshs  y
         lbsr  L3F31
         puls  x
         ldd   <u007C
         std   $04,x
         andcc #$FE
         rts
L1EDA    tst   u0008,u
         beq   L1EE8
         lda   [,u]
         cmpa  >L0539,pcr
         lbeq  L1FB5
L1EE8    ldx   u0009,u
         leax  $01,x
         stx   u0009,u
         inc   u000D,u
         lda   <u001D,u
         bne   L1F3E
         lda   [,u]
         cmpa  >L0539,pcr
         lbeq  L1FB5
         ldx   u000B,u
         leax  $01,x
         stx   u000B,u
         inc   TTYSTATE,u
         tst   u0008,u
         bne   L1F2A
         lda   <u0024,u
         inca
         adda  <u002C,u
         sta   <u002C,u
         clr   <u0029,u
         tst   <u0025,u
         beq   L1F20
         dec   <u0025,u
L1F20    tst   <u0027,u
         beq   L1F28
         dec   <u0027,u
L1F28    bra   L1F3D
L1F2A    inc   <u002C,u
         tst   <u0021,u
         beq   L1F35
         dec   <u0021,u
L1F35    tst   <u0022,u
         beq   L1F3D
         dec   <u0022,u
L1F3D    rts
L1F3E    ldd   [,u]
         cmpa  >L0539,pcr
         bne   L1F9E
         cmpb  >L0539,pcr
         bne   L1F9E
         lda   <u001D,u
         cmpa  #$01
         bne   L1F69
         lda   <u002B,u
         suba  <u001A,u
         bcs   L1FB9
         suba  <u001E,u
         bcs   L1FB9
         cmpa  #$03
         bls   L1FB9
         clr   <u001D,u
         bra   L1F3D
L1F69    clr   <u001D,u
         lda   <u002B,u
         suba  <u0019,u
         bcs   L1FB9
         suba  <u001F,u
         bcs   L1FB9
         cmpa  #$03
         bls   L1FB9
         lda   <u001A,u
         ldb   <u001B,u
         pshs  b,a
         lda   <u001F,u
         sta   <u001A,u
         lbsr  L4185
         lda   <u001B,u
         cmpa  TTYSTATE,u
         puls  b,a
         bhi   L1F3D
         stb   <u001B,u
         sta   <u001A,u
         rts
L1F9E    lda   [,u]
         cmpa  >L0539,pcr
         beq   L1FB5
         lda   <u001D,u
         cmpa  #$01
         bne   L1FB1
         inc   <u001E,u
         rts
L1FB1    inc   <u001F,u
         rts
L1FB5    lbsr  L3F44
         rts
L1FB9    clrb
         stb   <u0019,u
         comb
         stb   <u001B,u
         clr   <u001E,u
         clr   <u001F,u
         clr   <u001D,u
         cmpu  <u0024
         lbne  L1F3D
         lda   #$10
         lbsr  L2B46
         rts
L1FD7    lbsr  L1234
         clr   <u00CC
L1FDC    ldu   <u0024
L1FDE    lbsr  L3018
L1FE1    lda   <u0041
         cmpa  <u0048
         bcc   L1FDC
         ldd   u000F,u
         subd  <u0061
         addb  #$02
         cmpb  <u0071
         bcs   L200A
         lda   <u0024,u
         inca
         adda  <u002C,u
         cmpa  <u001B,u
         bcc   L2002
         cmpa  <u002B,u
         bcs   L200A
L2002    lda   #$0B
         lbsr  L2B46
         lbra  L2120
L200A    lbsr  L1744
         cmpa  >L0521,pcr
         bne   L2017
         clr   <u00CC
         bra   L1FE1
L2017    cmpa  #$1F
         lbls  L20F0
         cmpa  #$7F
         lbhi  L20F0
L2023    sta   <u0086
         tst   <u00CC
         lbne  L20A6
L202B    lbsr  L2B0E
         bcs   L1FE1
         lda   <u0086
         cmpa  #$20
         lbeq  L20B8
         cmpa  #$2D
         lbeq  L20B8
         cmpa  #$F0
         lbeq  L2059
L2044    lbsr  L23D0
         bcs   L1FDE
         ldy   u0006,u
         tst   <u00CC
         beq   L2052
         leay  -$01,y
L2052    leay  -$01,y
         lbsr  L1B26
         bra   L1FE1
L2059    lda   <u00FB
         cmpa  #$00
         beq   L20B8
         lda   <u00FA
         cmpa  #$00
         beq   L20B8
         lbsr  L23D0
         lda   <u00FA
         suba  <u002A,u
         sta   <u0029,u
         lbsr  L3018
         ldy   u0006,u
         lbsr  L1744
         cmpa  #$0D
         beq   L2096
         pshs  a
         lda   <u0029,u
         clr   <u0029,u
L2085    pshs  a
         lda   #$20
         lbsr  L2B0E
         puls  a
         deca
         bne   L2085
         puls  a
         lbra  L2017
L2096    lda   #$07
         lbsr  WrA2BUF
         clr   <u00FA
         clr   <u0029,u
         lbsr  L23D0
         lbra  L1FDE
L20A6    cmpa  #$F0
         lbeq  L202B
         pshs  a
         lda   <u00CC
         lbsr  L2B0E
         puls  a
         lbra  L202B
L20B8    lda   u000D,u
         cmpa  #$01
         lbeq  L2044
         ldx   <u007C
         lda   -$01,x
         cmpa  #$F0
         lbeq  L2044
         ldx   u0006,u
         leax  -$01,x
         stx   <u0063
         ldx   ,u
         bra   L20E2
L20D4    lda   ,x+
         cmpa  #$20
         lbeq  L2044
         cmpa  #$2D
         lbeq  L2044
L20E2    cmpx  <u0063
         bne   L20D4
         lbsr  L225C
         lbcs  L1FDE
         lbra  L2044
L20F0    cmpa  >BSC,pcr
         lbeq  L218F
         cmpa  #$0D
         beq   L211B
         cmpa  >L0534,pcr
         beq   L2120
         cmpa  >L0535,pcr
         beq   L2148
         lbsr  L397B
         tstb
         beq   L2111
         lbra  L1FE1
L2111    lbsr  L2711
         lbcc  L1FE1
         lbra  L1FDE
L211B    lda   #$F0
         lbra  L2023
L2120    andcc #$FE
         lbsr  L123D
         lda   [,u]
         cmpa  >L0539,pcr
         beq   L2135
         tst   <u001D,u
         beq   L2135
         lbra  L2435
L2135    tst   <u007E
         bne   L213E
         inc   <u007E
         lbra  L2439
L213E    lda   <u0079
         inca
         sta   <u006F
         sta   <u0077
         lbra  L2435
L2148    ldx   <u007C
         lda   -$01,x
         cmpa  #$F0
         beq   L215F
         ldx   u0009,u
         cmpx  #$0001
         beq   L215F
L2157    lda   #$1D
         lbsr  L2B46
         lbra  L1FE1
L215F    lbsr  L2ADB
         bcs   L2157
         sta   <u00AF
         tst   <u001D,u
         bne   L2170
         lda   <u001C,u
         bra   L2173
L2170    lda   <u0020,u
L2173    cmpa  <u00AF
         bcs   L2157
         lda   <u00AF
         suba  <u00A7
         bls   L2189
L217D    pshs  a
         lda   #$20
         lbsr  L2B0E
         puls  a
         deca
         bne   L217D
L2189    lbsr  L23D0
         lbra  L1FDE
L218F    ldx   u0006,u
         lbsr  L0171
         cmpx  ,u
         beq   L21E5
         lda   ,-x
         cmpa  #$F1
         bne   L21A8
L219E    lda   ,-x
         cmpx  ,u
         beq   L21B2
         cmpa  #$F1
         beq   L219E
L21A8    cmpx  ,u
         beq   L21B2
         lda   -$01,x
         bpl   L21B2
         leax  -$01,x
L21B2    ldy   u0006,u
         tfr   x,d
         subd  ,u
         lbsr  L3F1E
         sty   ,u
L21BF    lbsr  L225C
         lbcs  L1FDE
         lbsr  L23D0
         lbcs  L1FDE
         ldd   <u0040
         decb
         lbsr  GOROWCOL
         lda   >L0537,pcr
         ldb   #$02
         lbsr  L10EA
         ldd   <u0040
         decb
         lbsr  GOROWCOL
         lbra  L1FE1
L21E5    tst   <u007E
         beq   L21ED
         ldx   u0009,u
         bra   L21EF
L21ED    ldx   u000B,u
L21EF    leax  -$01,x
         cmpx  #$FFFF
         bne   L2200
         ldu   <u0024
         lda   #$07
         lbsr  L2B46
         lbra  L1FDC
L2200    lbsr  L2522
         tst   <u007E
         bne   L221C
         ldy   <u0024
         ldd   $09,y
         subd  $0B,y
         addd  u000B,u
         subd  u0009,u
         beq   L221C
         lda   #$11
         lbsr  L2B46
         lbra  L1FDC
L221C    tst   u0008,u
         beq   L2224
         ldu   <u0022
         bra   L21E5
L2224    lda   [,u]
         cmpa  #$F0
         beq   L223A
         ldx   <u007C
         leax  -$01,x
         lda   -$01,x
         bpl   L2234
         leax  -$01,x
L2234    stx   <u007C
         ldu   <u0024
         bra   L21BF
L223A    ldy   <u0024
         ldd   ,y
         std   ,u
         ldd   $02,y
         std   u0002,u
         std   u0004,u
         ldd   $09,y
         std   <u00BC
         ldx   <u007C
         leax  -$01,x
         stx   <u00B8
         leax  >L1FDC,pcr
         pshs  x
         leas  -$04,s
         lbra  L22E2
L225C    pshs  u,y
         ldy   <u0024
         ldx   $09,y
         stx   <u00BC
L2265    cmpx  #$0000
         beq   L22D7
         leax  -$01,x
         beq   L22D7
         lda   <u007E
         pshs  a
         lda   #$01
         sta   <u007E
         sta   <u00D1
         lbsr  L2522
         puls  a
         sta   <u007E
         tst   u0008,u
         beq   L2297
         ldx   <u0081
         ldy   <u0022
         ldd   $0F,y
         subd  <u0061
         lda   #$38
         beq   L22D7
         mul
         leax  d,x
         ldx   $09,x
         bra   L2265
L2297    ldx   <u007C
         ldy   <u0024
         ldy   ,y
         bra   L22A5
L22A1    lda   ,-x
         sta   ,-y
L22A5    cmpx  ,u
         bne   L22A1
         sty   ,u
         stx   <u00B8
         ldd   u0004,u
         pshs  b,a
         lbsr  L1B9A
         puls  b,a
         ldx   u0002,u
         ldy   <u0024
         cmpx  ,y
         bne   L22DB
         cmpd  <u007C
         lbne  L234A
         ldx   <u00B8
         ldy   ,u
         bra   L22D2
L22CE    lda   ,y+
         sta   ,x+
L22D2    cmpy  u0004,u
         bne   L22CE
L22D7    andcc #$FE
L22D9    puls  pc,u,y
L22DB    ldy   <u0024
         cmpx  $06,y
         bls   L234A
L22E2    ldd   u000F,u
         ldy   <u0024
         cmpd  $0F,y
         beq   L2302
         ldy   <u002C
         ldx   <u002A
         ldd   #$015E
         lbsr  L3F31
         ldd   <u008D
         std   <u008F
         ldd   #$FFFF
         sta   <u00A0
         std   <u008D
L2302    ldb   u000D,u
         lda   #$05
         mul
         ldx   <u002C
         cmpd  #$015E
         bls   L2313
         ldx   <u002E
         bra   L2315
L2313    leax  d,x
L2315    stx   <u0093
         ldy   <u0024
         ldx   $06,y
         pshs  x
         ldx   <u0022
         ldb   #$38
         clra
         lbsr  L3F31
         puls  x
         ldy   <u0024
         stx   $06,y
         ldx   <u00B8
         stx   <u007C
         ldd   <u00BC
         subd  u0009,u
         pshs  b,a
         ldb   <u0040
         clra
         subd  ,s++
         bcc   L233F
         clrb
L233F    stb   <u0079
         incb
         stb   <u006F
         stb   <u0077
         orcc  #$01
         bra   L22D9
L234A    ldx   <u00B8
         ldy   ,u
         bra   L2355
L2351    lda   ,y+
         sta   ,x+
L2355    cmpy  u0004,u
         bne   L2351
         stx   <u00BE
         stx   <u007C
         ldx   <u0024
         sty   ,x
         ldd   u000F,u
         cmpd  <u008D
         bne   L2399
         ldx   <u002C
         stx   <u0063
         lda   #$05
         ldb   u000D,u
         mul
         ldx   <u002A
         leax  d,x
         bra   L237F
L2379    ldd   <u007C
         std   $02,x
         leax  $05,x
L237F    cmpx  <u0063
         bcs   L2379
         ldy   <u0024
         ldd   $0F,y
         subd  <u0061
         lda   #$38
         mul
         ldx   <u0081
         leax  d,x
         ldd   <u007C
         std   $04,x
         ldx   <u002C
         bra   L23AA
L2399    ldx   <u002C
         lda   #$05
         ldb   u000D,u
         mul
         leax  d,x
         bra   L23AA
L23A4    ldd   <u007C
         std   $02,x
         leax  $05,x
L23AA    cmpx  <u0093
         bcs   L23A4
         ldd   <u00BC
         subd  u0009,u
         pshs  b,a
         ldb   <u0040
         clra
         subd  ,s++
         bcs   L23CB
         tfr   b,a
         ldb   #$01
         stb   <u0083
         lbsr  L2C7D
         lda   <u0079
         inca
         sta   <u006F
         sta   <u0077
L23CB    orcc  #$01
         lbra  L22D9
L23D0    ldd   u0002,u
         pshs  b,a
         lbsr  L1B9A
         puls  b,a
         clr   <u0067
         cmpd  u0002,u
         beq   L23E2
         inc   <u0067
L23E2    ldd   u0006,u
         cmpd  u0002,u
         bcc   L23FA
         tst   <u0067
         bne   L23F0
         andcc #$FE
         rts
L23F0    lda   <u0079
         inca
         sta   <u0077
         sta   <u006F
         orcc  #$01
         rts
L23FA    tst   <u007E
         bne   L240B
         lda   [,u]
         cmpa  >L0539,pcr
         beq   L2424
         tst   <u001D,u
         bne   L2424
L240B    lda   <u0040
         ldb   #$01
         stb   <u0083
         clr   <u00D9
         lbsr  L2C7D
         cmpa  <u0047
         bne   L241D
         lbsr  L11D2
L241D    lda   <u0040
         inca
         clrb
         lbsr  GOROWCOL
L2424    lbsr  L1D78
         tst   u0008,u
         bne   L23FA
         lda   <u0040
         sta   <u0079
         bra   L23F0
         nop
         pshs  y
         fcb   $55 U
L2435    bsr   L243D
         bra   L246F
L2439    bsr   L243D
         bra   L245F
L243D    clr   <u0083
         ldu   <u0024
         lbsr  L225C
         bsr   L23D0
         ldx   u0006,u
         cmpx  ,u
         bcs   L2451
         cmpx  u0002,u
         bcc   L2451
         rts
L2451    lda   #$01
         sta   <u00D9
         clr   <u0083
         clr   <u0080
         lda   <u0079
         lbsr  L2C7D
         rts
L245F    ldu   <u0024
         lbsr  L2C0D
         lda   <u0079
         sta   <u0040
         inca
         sta   <u006F
         sta   <u0077
         clr   <u00A3
L246F    ldu   <u0024
         ldx   u0006,u
         cmpx  ,u
         bcs   L247B
         cmpx  u0002,u
         bcs   L247F
L247B    ldx   ,u
         stx   u0006,u
L247F    lda   #$01
         sta   <u0083
         clr   <u00D9
         lda   <u0079
         lbsr  L2C7D
L248A    ldu   <u0024
         lda   <u0040
         sta   <u0079
         lds   <u0020
         lbsr  L1744
         lbsr  L0171
L2499    lbsr  L2711
         bcs   L246F
         lbsr  L1760
         ldu   <u0024
         leax  >CURUC,pcr
         leay  >L24D3,pcr
         bsr   L24B8
         bcc   L24B6
L24AF    lda   #$03
         lbsr  L2B46
         bra   L248A
L24B6    jmp   ,x
L24B8    cmpa  ,x+
         beq   L24C5
         leay  $02,y
         tst   ,y
         bne   L24B8
         orcc  #$01
         rts

L24C5    pshs  a
         leax  >0,pcr
         ldd   ,y
         leax  d,x
         andcc #$FE
         puls  pc,a

* Jump addresses here
L24D3    fcb $44,$BB,$45,$B6,$45,$4B,$45,$F8,$46,$5C,$46,$82
 fcb $44,$25,$44,$7D,$3B,$68,$3B,$F8,$1F,$D7,$3A,$79
 fcb $3B,$08,$39,$FE,$31,$91,$3A,$BC,$47,$52,$46,$E1
 fcb $46,$31,$47,$F1,$3B,$5B,$47,$D8,$24,$33,$48,$CF
 fcb $48,$E4,$48,$F1,$49,$FC,$39,$45,$39,$45,$39,$45
 fcb $39,$45,$39,$45,$39,$D7,$45,$B6,$45,$F8,$44,$BB
 fcb $45,$4B,$45,$B6,$44,$7D
 fcb 0

L2522     stx   <u007A
         ldu   <u0022
L2526    ldy   <u0024
         ldd   $0F,y
         subd  <u0061
         lda   #$38
         mul
         ldy   <u0081
         leay  d,y
L2535    ldd   <u007A
         tst   <u007E
         beq   L2540
         cmpd  $09,y
         bra   L2543
L2540    cmpd  $0B,y
L2543    bcc   L254A
         leay  <-$38,y
         bra   L2535
L254A    tfr   y,x
         ldy   <u0022
         ldd   #$0038
         lbsr  L3F31
         ldd   u000F,u
         cmpd  <u008D
         beq   L2595
         cmpd  <u008F
         beq   L25A4
L2561    lbsr  L1B9A
L2564    ldd   <u007C
         cmpd  u0004,u
         bcc   L2573
         std   u0004,u
         tst   u0008,u
         bne   L2573
         std   u0002,u
L2573    bsr   L2587
         beq   L25C3
         tst   <u00D1
         beq   L2582
         ldd   u0004,u
         cmpd  <u007C
         bcc   L25C3
L2582    lbsr  L1D78
         bra   L2564
L2587    ldd   <u007A
         tst   <u007E
         beq   L2591
         cmpd  u0009,u
         rts
L2591    cmpd  u000B,u
         rts
L2595    lbsr  L176B
         bcs   L2595
         ldy   <u002A
         sty   <u00B4
         ldx   <u002C
         bra   L25AC
L25A4    ldy   <u002C
         sty   <u00B4
         ldx   <u002E
L25AC    stx   <u00B6
L25AE    bsr   L2587
         bne   L25C6
         tst   <u007E
         bne   L25C3
         tst   <u001D,u
         bne   L25C6
         lda   [,u]
         cmpa  >L0539,pcr
         beq   L25C6
L25C3    clr   <u00D1
         rts
L25C6    tst   <u00D1
         beq   L25D1
         ldd   u0004,u
         cmpd  <u007C
         bcc   L25C3
L25D1    ldy   <u00B4
         leay  $05,y
         sty   <u00B4
         cmpy  <u00B6
         beq   L2561
         tst   $04,y
         beq   L25EA
         lbsr  L1B9A
         lbsr  L1D78
         bra   L25AE
L25EA    lbsr  L1EDA
         ldy   <u00B4
         ldx   ,y
         stx   ,u
         ldd   $02,y
         std   u0004,u
         lda   $04,y
         sta   u0008,u
         bra   L25AE
L25FE    pshs  u
         ldu   <u0022
         ldy   <u0024
         ldd   $0F,y
         subd  u000F,u
         beq   L2675
         cmpd  #$0001
         beq   L265A
         ldd   u000F,u
         subd  <u0061
         lda   #$38
         mul
         ldx   <u0081
         leax  d,x
         ldy   <u0028
         ldd   #$0038
         lbsr  L3F31
         ldx   <u002C
         stx   <u0093
         ldx   u000F,u
         stx   <u008F
         ldu   <u0028
         bra   L264C
L2631    ldx   <u0093
         ldd   ,u
         std   ,x
         ldd   u0004,u
         std   $02,x
         lda   u0008,u
         sta   $04,x
         leax  $05,x
         stx   <u0093
         ldx   <u002E
         cmpx  <u0093
         beq   L2656
         lbsr  L1D78
L264C    ldd   u0009,u
         ldy   <u0022
         cmpd  $09,y
         bne   L2631
L2656    ldu   <u0022
         bra   L266E
L265A    lbsr  L176B
         bcs   L265A
         ldy   <u002C
         ldd   #$015E
         ldx   <u002A
         lbsr  L3F31
         ldd   <u008D
         std   <u008F
L266E    ldd   #$FFFF
         sta   <u00A0
         std   <u008D
L2675    ldb   u000D,u
         lda   #$05
         mul
         ldx   <u002C
         cmpd  #$015E
         bls   L2685
         ldd   #$015E
L2685    leax  d,x
         stx   <u0093
         tst   u0008,u
         beq   L2691
         ldd   u0004,u
         bra   L2693
L2691    ldd   ,u
L2693    ldx   <u007C
         stx   <u0063
         std   <u007C
         ldd   <u0063
         subd  <u007C
         ldy   <u0024
         ldy   ,y
         lbsr  L3F1E
         tst   u0008,u
         beq   L26AF
         sty   u0004,u
         bra   L26B2
L26AF    sty   ,u
L26B2    ldx   <u0022
         ldy   <u0024
         ldd   #$0038
         lbsr  L3F31
         ldu   <u0024
         lbsr  L1B9A
         puls  pc,u
L26C4    pshs  y,x,b,a
         ldx   <u0036
         clr   $05,x
         leay  >L2707,pcr
         pshs  a
         lda   #$05
         sta   <u0068
         puls  a
         clr   <u0067
L26D8    subd  ,y
         bcs   L26E0
         inc   <u0067
         bra   L26D8
L26E0    addd  ,y
         pshs  a
         lda   <u0067
         adda  #$30
         sta   ,x+
         puls  a
         leay  $02,y
         clr   <u0067
         dec   <u0068
         bne   L26D8
         ldx   <u0036
L26F6    ldb   #$04
L26F8    lda   #$30
         cmpa  ,x
         bne   L2705
         lda   #$20
         sta   ,x+
         decb
         bne   L26F8
L2705    puls  pc,y,x,b,a

L2707     fdb  10000,1000,100,10,1

* Check for control codes
L2711    pshs  y,x,b,a
         leax  >L0528,pcr
         leay  >L273A,pcr
         lbsr  L24B8
         bcs   L2728
         jsr   ,x
         bcs   L272C
         orcc  #$01
L2726    puls  pc,y,x,b,a
L2728    andcc #$FE
         bra   L2726
L272C    lbsr  L2C0D
         lda   <u0079
         inca
         sta   <u0077
         sta   <u006F
         orcc  #$01
         bra   L2726

L273A    fcb $29,$BA,$29,$17,$29,$4E,$27,$5D,$27,$7E,$27,$58
         fcb $27,$84,$2A,$5F,$2A,$83,$27,$53,$29,$F1,$2A,$49
         fcb 0

L2753    com   <u00AD
         andcc #$FE
         rts

L2758    com   <u007F
         orcc  #$01
         rts   

L275E    tst   <u007E
         beq   L2777
         clra
         tst   <u001D,u
         bne   L276F
         ldb   [,u]
         cmpb  >L0539,pcr
         bne   L2779
L276F    lda   #$0F
         lbsr  L2B46
         andcc #$FE
         rts
L2777    lda   #$01
L2779    sta   <u007E
         orcc  #$01
         rts
         lbsr  L2B51
         andcc #$FE
         rts
         lda   #$FF
         sta   <u006F
         lbsr  L11BC
         leax  >L0569,pcr
         ldd   ,x
         leax  >0,pcr
         leax  d,x
         lbsr  L0230
         bcs   L27B2
         lbsr  L11BC
L279F    lbsr  L0301
         bcs   L27B8
         cmpa  #$0D
         bne   L27AD
         lbsr  WrA2BUF
         lda   #$0A
L27AD    lbsr  WrA2BUF
         bra   L279F
L27B2    lbsr  L02E7
         lbra  L28C1
L27B8    ldd   #$010D
         lbsr  GOROWCOL
         tst   <u0070
         bne   L27C8
L27C2    ldx   >L056B,pcr
         bra   L27CF
L27C8    ldx   <u0032
         lbsr  L3184
         bra   L27D2
L27CF    lbsr  L3169
L27D2    ldd   #$040E
         lbsr  GOROWCOL
         tst   <u0070
         bne   L27E2
         ldx   >L056B,pcr
         bra   L27E9
L27E2    ldx   <u0034
         lbsr  L3184
         bra   L27EC
L27E9    lbsr  L3169
L27EC    ldd   #$0208
         lbsr  GOROWCOL
         tst   <u005F
         beq   L27FC
         ldx   >L056F,pcr
         bra   L2800
L27FC    ldx   >L0571,pcr
L2800    lbsr  L3169
         ldd   #$0508
         lbsr  GOROWCOL
         tst   <u0060
         beq   L2813
         ldx   >L056F,pcr
         bra   L2817
L2813    ldx   >L0571,pcr
L2817    lbsr  L3169
         clr   <u00AB
         lda   #$07
         sta   <u00AA
         ldd   u000F,u
         addd  #$0001
         lbsr  L28D3
         ldd   <u0011,u
         lbsr  L28D3
         ldb   <u002C,u
         clra
         lbsr  L28D3
         ldb   <u002B,u
         lbsr  L28D3
         ldb   <u0019,u
         lbsr  L28D3
         ldb   <u001A,u
         lbsr  L28D3
         ldb   <u0024,u
         incb
         lbsr  L28D3
         ldb   <u002E,u
         lbsr  L28D3
         ldb   <u001C,u
         lbsr  L28D3
         ldb   <u0020,u
         lbsr  L28D3
         ldb   <u0017,u
         bsr   L28D3
         ldb   <u0018,u
         bsr   L28D3
         ldb   <u002A,u
         bsr   L28D3
         ldb   <u002D,u
         bsr   L28D3
         lda   #$1C
         sta   <u00AB
         lda   #$07
         sta   <u00AA
         clra
         ldb   <u0035,u
         bsr   L28D3
         ldb   <u0036,u
         bsr   L28D3
         ldb   <u0037,u
         bsr   L28D3
         ldb   #$59
         tst   <u0026,u
         bne   L2895
         ldb   #$4E
L2895    bsr   L2904
         ldb   #$59
         tst   <u0030,u
         bne   L28A0
         ldb   #$4E
L28A0    bsr   L2904
         ldb   <u0031,u
         bsr   L2904
         ldb   <u0032,u
         bsr   L2904
         ldb   <u0033,u
         bsr   L2904
         ldb   #$20
         bsr   L2904
         ldd   ,u
         subd  <u007C
         bsr   L28D3
         lbsr  L029A
         lbsr  L0171
L28C1    lbsr  L1744
         cmpa  >L0534,pcr
         beq   L28D0
         cmpa  >L052E,pcr
         bne   L28C1
L28D0    orcc  #$01
         rts
L28D3    pshs  b,a
         lda   <u00AA
         ldb   <u00AB
         lbsr  GOROWCOL
         inc   <u00AA
         ldd   ,s
         lbsr  L26C4
         pshs  x
         ldx   <u0036
         lda   $01,x
         cmpa  #$20
         bne   L28F6
         leax  $02,x
         ldd   <u00AA
         deca
         addb  #$13
         bra   L28FB
L28F6    ldd   <u00AA
         deca
         addb  #$11
L28FB    lbsr  GOROWCOL
         lbsr  L3184
         puls  x,b,a
         rts
L2904    pshs  b
         lda   <u00AA
         ldb   <u00AB
         addb  #$15
         lbsr  GOROWCOL
         inc   <u00AA
         puls  a
         lbsr  OUTREPT
         rts
L2917    tst   <u00A4
         bne   L2925
         ldy   u0006,u
         leay  $01,y
         cmpy  <u0072
         bcs   L292D
L2925    lda   #$12
         lbsr  L2B46
         andcc #$FE
         rts
L292D    lda   [,u]
         cmpa  >L0539,pcr
         beq   L293A
         tst   <u001D,u
         beq   L293C
L293A    inc   <u0077
L293C    ldx   u0006,u
         lda   ,x
         bpl   L294C
         cmpa  #$F0
         beq   L294C
         cmpa  #$F1
         beq   L294C
         leay  $01,y
L294C    bra   L2996
         tst   <u00A4
         bne   L2925
         ldx   u0006,u
         lda   ,x
         cmpa  #$F0
         beq   L2917
         lda   [,u]
         cmpa  >L0539,pcr
         beq   L2967
         tst   <u001D,u
         beq   L2969
L2967    inc   <u0077
L2969    cmpx  ,u
         beq   L297F
         lda   ,x
         bmi   L2979
         cmpa  #$20
         beq   L297D
L2975    leax  -$01,x
         bra   L2969
L2979    cmpa  #$F0
         bne   L2975
L297D    leax  $01,x
L297F    ldy   u0006,u
L2982    lda   ,y+
         cmpa  #$20
         beq   L298E
         cmpa  #$F0
         bne   L2982
         leay  -$01,y
L298E    lda   ,y+
         cmpa  #$20
         beq   L298E
         leay  -$01,y
L2996    sty   u0006,u
L2999    cmpx  ,u
         beq   L29A3
         lda   ,-x
         sta   ,-y
         bra   L2999
L29A3    sty   ,u
         lbsr  L225C
         lbsr  L23D0
         tst   <u0077
         beq   L29B7
L29B0    lda   <u0079
         inca
         sta   <u0077
         sta   <u006F
L29B7    andcc #$FE
         rts
         ldx   <u007C
         lda   -$01,x
         cmpa  #$F0
         beq   L29D2
         ldd   u0009,u
         cmpd  #$0001
         beq   L29D2
L29CA    lda   #$14
         lbsr  L2B46
         andcc #$FE
         rts
L29D2    ldx   u0002,u
         lda   ,-x
         cmpa  #$F0
         bne   L29CA
         ldy   ,u
         stx   ,u
         stx   u0006,u
         lda   ,y
         cmpa  >L0539,pcr
         beq   L29B0
         tst   <u001D,u
         bne   L29B0
         andcc #$FE
         rts
         lda   #$FF
         sta   <u006F
         lbsr  L11BC
         ldb   #$07
         ldx   >L05DF,pcr
         lbsr  L4B9C
L2A01    tsta
         beq   L2A46
         leax  >L05E1,pcr
         deca
         lsla
         leax  a,x
         ldd   ,x
         leax  >0,pcr
         leax  d,x
         lbsr  L0230
         bcs   L2A2F
         lbsr  L11BC
L2A1C    lbsr  L0301
         bcs   L2A3D
         cmpa  #$0D
         bne   L2A2A
         lbsr  WrA2BUF
         lda   #$0A
L2A2A    lbsr  WrA2BUF
         bra   L2A1C
L2A2F    ldd   #$0000
         lbsr  GOROWCOL
         lbsr  L02E7
         lbsr  L4C1D
         bra   L2A01
L2A3D    lbsr  L029A
         lbsr  L0171
         lbsr  L1744
L2A46    orcc  #$01
         rts
         lda   <u00FB
         cmpa  #$01
         beq   L2A55
         lda   #$01
         sta   <u00FB
         bra   L2A59
L2A55    lda   #$00
         sta   <u00FB
L2A59    lda   #$07
         lbsr  WrA2BUF
         rts
         ldx   u0006,u
         lda   ,x
         cmpa  #$F1
         beq   L2A80
         cmpx  ,u
         beq   L2A80
         lda   -$01,x
         cmpa  #$F1
         beq   L2A80
         cmpa  #$20
         beq   L2A80
         lda   #$F1
         lbsr  L2B0E
         lbsr  L225C
         lbsr  L23D0
L2A80    andcc #$FE
         rts
         ldb   <u0041
         addb  <u00A5
         beq   L2AA0
         ldx   <u0030
         clra
L2A8C    cmpb  a,x
         bcs   L2AA1
         beq   L2AA0
         tst   a,x
         beq   L2AA1
         inca
         cmpa  #$16
         bne   L2A8C
         lda   #$1B
         lbsr  L2B46
L2AA0    rts
L2AA1    sta   <u0067
         ldb   #$15
         bra   L2AAE
L2AA7    decb
         lda   b,x
         incb
         sta   b,x
         decb
L2AAE    cmpb  <u0067
         bne   L2AA7
         lda   <u0041
         adda  <u00A5
         sta   b,x
         rts
         ldx   <u0030
         clrb
         lda   <u0041
         adda  <u00A5
L2AC0    cmpa  b,x
         beq   L2ACA
         incb
         cmpb  #$16
         bne   L2AC0
L2AC9    rts
L2ACA    clr   b,x
L2ACC    incb
         cmpb  #$16
         beq   L2AC9
         lda   b,x
         beq   L2AC9
         decb
         sta   b,x
         incb
         bra   L2ACC
L2ADB    ldx   ,u
         clr   <u00A7
L2ADF    cmpx  u0006,u
         bcc   L2AF1
         inc   <u00A7
         lda   ,x+
         bpl   L2ADF
         cmpa  #$F1
         beq   L2ADF
         leax  $01,x
         bra   L2ADF
L2AF1    ldx   <u0030
         lda   <u00A7
         clrb
L2AF6    cmpa  b,x
         bcs   L2B07
         incb
         cmpb  #$16
         bne   L2AF6
         lda   #$1C
         lbsr  L2B46
         orcc  #$01
         rts
L2B07    lda   b,x
         sta   <u00FA
         andcc #$FE
         rts
L2B0E    pshs  y,a
         ldd   ,u
         subd  <u007C
         cmpd  #$00C8
         bhi   L2B30
         cmpd  #$000A
         bcs   L2B27
         lda   #$19
         lbsr  L2B46
         bra   L2B30
L2B27    lda   #$1A
         lbsr  L2B46
         orcc  #$01
         puls  pc,y,a
L2B30    ldd   u0006,u
         subd  ,u
         ldx   ,u
         leay  -$01,x
         sty   ,u
         lbsr  L3F31
         puls  a
         sta   ,y
         andcc #$FE
         puls  pc,y
L2B46    pshs  a
         sta   <u0087
         lda   #$07
         lbsr  WrA2BUF
         puls  pc,a
L2B51    pshs  x,b,a
         clrb
         lda   <u0040
         lbsr  GOROWCOL
         ldb   #$01
         pshs  b
         leax  >L0561,pcr
         ldd   ,x
         leax  >0,pcr
         leax  d,x
         lbsr  L0230
         bcs   L2B8E
L2B6E    lbsr  L0301
         bcs   L2BAE
         cmpa  #$0D
         bne   L2B6E
         puls  b
         incb
         pshs  b
         cmpb  <u0087
         bne   L2B6E
L2B80    lbsr  L0301
         bcs   L2B93
         cmpa  #$0D
         beq   L2B93
         lbsr  WrA2BUF
         bra   L2B80
L2B8E    lbsr  L02E7
         bra   L2B99
L2B93    lbsr  L029A
         lbsr  L0171
L2B99    lbsr  L1744
         cmpa  >L052C,pcr
         beq   L2BA8
         cmpa  >L0534,pcr
         bne   L2B99
L2BA8    puls  b
         orcc  #$01
         puls  pc,x,b,a
L2BAE    ldx   >L0563,pcr
         lbsr  L3169
         bra   L2B93
L2BB7    pshs  u,y,x,b,a
         tst   <u0077
         beq   L2BCA
         clr   <u0077
         ldx   <u0024
         ldy   <u0026
         ldd   #$0038
         lbsr  L3F31
L2BCA    lda   <u006F
         cmpa  <u0047
         bls   L2BD9
         lda   <u0047
         inca
         sta   <u006F
         andcc #$FE
         puls  pc,u,y,x,b,a
L2BD9    ldu   <u0026
L2BDB    lbsr  L1D78
         bcs   L2C06
         tst   u0008,u
         beq   L2BF3
L2BE4    lda   [,u]
         cmpa  >L0539,pcr
         beq   L2BDB
         tst   <u001D,u
         bne   L2BDB
         bra   L2BF7
L2BF3    tst   <u007E
         beq   L2BE4
L2BF7    lda   #$01
         sta   <u0083
         lda   <u006F
         lbsr  L2C7D
L2C00    inc   <u006F
         orcc  #$01
         puls  pc,u,y,x,b,a
L2C06    lda   <u006F
         lbsr  L1246
         bra   L2C00
L2C0D    pshs  u,y,x,b,a
         lda   #$01
         sta   <u0083
         tst   <u0079
         beq   L2C6E
         tst   <u007E
         bne   L2C1F
         ldd   u000B,u
         bra   L2C21
L2C1F    ldd   u0009,u
L2C21    subb  <u0079
         sbca  #$00
         bcc   L2C2F
         addb  <u0079
         stb   <u0079
         beq   L2C6E
         clra
         clrb
L2C2F    tfr   d,x
         lbsr  L2522
         ldu   <u0022
         lbsr  L1B9A
         clr   <u00AB
         bra   L2C57
L2C3D    lbsr  L1D78
         tst   u0008,u
         beq   L2C53
L2C44    lda   [,u]
         cmpa  >L0539,pcr
         beq   L2C3D
         tst   <u001D,u
         bne   L2C3D
         bra   L2C57
L2C53    tst   <u007E
         beq   L2C44
L2C57    ldd   <u007C
         cmpd  u0002,u
         bhi   L2C60
         std   u0002,u
L2C60    lda   <u00AB
         lbsr  L2C7D
         lda   <u00AB
         inca
         sta   <u00AB
         cmpa  <u0079
         bne   L2C3D
L2C6E    puls  pc,u,y,x,b,a
L2C70    sta   <u0067
         clra
L2C73    subb  <u0067
         bcs   L2C7A
         inca
         bra   L2C73
L2C7A    addb  <u0067
         rts
L2C7D    pshs  y,x,b,a
         clr   <u00A6
         lbsr  L314F
         tst   <u005C
         bne   L2C96
         lbsr  L0127
         lbsr  L11AC
         ldx   <u0040
         stx   <u00DB
         clrb
         lbsr  GOROWCOL
L2C96    ldy   ,u
         lda   ,y
         cmpa  >L0539,pcr
         beq   L2CD1
         tst   u0008,u
         beq   L2CBB
         clr   <u00B3
         tst   u000D,u
         lbeq  L2FDD
         tst   <u0021,u
         bne   L2D13
         tst   <u0022,u
         lbne  L2F09
         bra   L2CD1
L2CBB    tst   <u0025,u
         bne   L2D13
         tst   <u0027,u
         lbne  L2F09
         tst   <u0026,u
         lbne  L2DCE
L2CCE    lbsr  L2FBA
L2CD1    lda   ,y
         bpl   L2CEA
         cmpa  #$F0
         beq   L2CFA
         cmpa  #$F1
         beq   L2CE4
         lbsr  L17F0
         leay  $01,y
         bra   L2CED
L2CE4    leax  $01,y
         cmpx  u0002,u
         bne   L2CED
L2CEA    lbsr  L17F0
L2CED    leay  $01,y
         cmpy  u0002,u
         bcs   L2CD1
L2CF4    clra
         lbsr  L17F0
         bra   L2CFD
L2CFA    lbsr  L17F0
L2CFD    tst   <u005C
         bne   L2D11
         cmpu  <u0024
         beq   L2D0B
         ldd   <u00DB
         lbsr  GOROWCOL
L2D0B    lbsr  L11B4
         lbsr  L0128
L2D11    puls  pc,y,x,b,a
L2D13    tst   <u0030,u
         beq   L2D1E
         tst   <u005C
         lbne  L2F23
L2D1E    bsr   L2D2C
         ldb   <u00A2
         subb  <u0099
         bcs   L2CD1
         lsrb
         lbsr  L2FCF
         bra   L2CD1
L2D2C    ldy   ,u
         clr   <u0099
         clr   <u009B
         clr   <u0097
         clr   <u0098
         clrb
L2D38    cmpy  u0002,u
         beq   L2D87
         lda   ,y+
         bmi   L2D38
         cmpa  <u0031,u
         beq   L2D95
         inc   <u0099
         cmpa  #$20
         bne   L2D50
         inc   <u0097
         bra   L2D38
L2D50    incb
L2D51    cmpy  u0002,u
         bcc   L2D87
         lda   ,y+
         bpl   L2D67
         cmpa  #$F1
         bne   L2D51
         cmpy  u0002,u
         bne   L2D51
         inc   <u0099
         bra   L2D87
L2D67    cmpa  #$20
         beq   L2D78
         cmpa  <u0031,u
         beq   L2D95
         ldb   #$01
         inc   <u0099
         clr   <u0098
         bra   L2D51
L2D78    inc   <u0098
         inc   <u0099
         tstb
         bne   L2D82
         clrb
         bra   L2D51
L2D82    clrb
         inc   <u009B
         bra   L2D51
L2D87    ldy   ,u
         tst   <u0098
         beq   L2D94
         tst   <u009B
         beq   L2D94
         dec   <u009B
L2D94    rts
L2D95    lda   ,y+
         bmi   L2D51
         cmpa  <u0031,u
         beq   L2D51
         cmpy  u0002,u
         bcc   L2D87
         lbsr  L1760
         cmpa  >L0545,pcr
         bne   L2D95
         lda   -$02,y
         cmpa  #$20
         beq   L2DBB
         cmpa  #$2C
         beq   L2DBB
         cmpa  <u0031,u
         bne   L2D95
L2DBB    lda   ,y
         cmpa  #$20
         beq   L2DCA
         cmpa  #$2C
         beq   L2DCA
         cmpa  <u0031,u
         bne   L2D95
L2DCA    dec   <u0099
         bra   L2D95
L2DCE    ldx   u0002,u
         lda   ,-x
         cmpa  #$F0
         lbeq  L2CCE
         tst   <u005C
         beq   L2DEA
         ldb   #$02
         ldx   <u004B
         ldx   b,x
         beq   L2DEA
         lda   <u004E
         lbne  L2E85
L2DEA    lbsr  L2FBA
         lbsr  L2D2C
         tst   <u009B
         lbeq  L2CD1
         lda   <u001C,u
         adda  <u0098
         suba  <u0099
         suba  <u0029,u
         suba  <u002A,u
         lbmi  L2CD1
         lbeq  L2CD1
         clr   <u009D
L2E0D    suba  <u009B
         bls   L2E15
         inc   <u009D
         bra   L2E0D
L2E15    adda  <u009B
         sta   <u009F
         beq   L2E1D
         inc   <u009D
L2E1D    lda   <u009D
         deca
         sta   <u009E
         clr   <u00EF
         clr   <u0068
L2E26    cmpy  u0002,u
         lbeq  L2CF4
         lda   ,y+
         bmi   L2E52
         cmpa  #$20
         beq   L2E3B
         orcc  #$01
         ror   <u0068
         bra   L2E69
L2E3B    tst   <u0068
         beq   L2E69
         tst   <u009F
         beq   L2E49
         dec   <u009F
         ldb   <u009D
         bra   L2E4B
L2E49    ldb   <u009E
L2E4B    lbsr  L2FCF
         clr   <u0068
         bra   L2E69
L2E52    cmpa  #$F0
         lbeq  L2CFA
         cmpa  #$F1
         bne   L2E63
         cmpy  u0002,u
         bne   L2E26
         bra   L2E6D
L2E63    lda   #$01
         sta   <u00EF
         bra   L2E26
L2E69    tst   <u00EF
         bne   L2E78
L2E6D    leay  -$01,y
         lda   #$20
         lbsr  L17F0
         leay  $01,y
         bra   L2E26
L2E78    leay  -$02,y
         lda   #$20
         lbsr  L17F0
         leay  $02,y
         clr   <u00EF
         bra   L2E26
L2E85    lbsr  L2D2C
         ldb   <u0097
         addb  <u002A,u
         addb  <u0029,u
         lbsr  L2FCF
         tst   <u0030,u
         beq   L2EAF
         lbsr  L2F76
         ldy   <u0038
         ldb   #$40
         ldb   b,y
         lda   <u0098
         mul
         std   <u0069
         ldd   <u00E6
         subd  <u0069
         std   <u00E6
         bra   L2EB8
L2EAF    ldb   <u0099
         subb  <u0098
         lda   <u003F
         mul
         std   <u00E6
L2EB8    ldy   ,u
L2EBB    lda   ,y
         bmi   L2EC7
L2EBF    cmpa  #$20
         bne   L2ED3
         leay  $01,y
         bra   L2EBB
L2EC7    cmpa  #$F0
         beq   L2ED3
         cmpa  #$F1
         beq   L2ED3
         lda   $01,y
         bra   L2EBF
L2ED3    clra
         ldb   <u0099
         subb  <u0098
         subb  <u0097
         decb
         std   <u0069
         lda   <u002D,u
         ldb   <u004E
         lbsr  L2C70
         ldb   <u001C,u
         subb  <u002A,u
         subb  <u0029,u
         mul
         clr   <u0067
         subd  <u00E6
L2EF3    subd  <u0069
         bcs   L2EFB
         inc   <u0067
         bra   L2EF3
L2EFB    addd  <u0069
         lda   <u0067
         stb   <u00E5
         beq   L2F04
         inca
L2F04    sta   <u00E4
         lbra  L2CD1
L2F09    lbsr  L2D2C
         tst   <u0030,u
         beq   L2F15
         tst   <u005C
         bne   L2F23
L2F15    ldb   <u00A2
         subb  <u0099
         lbcs  L2CCE
         lbsr  L2FCF
         lbra  L2CD1
L2F23    bsr   L2F76
         ldy   ,u
         lda   <u002D,u
         ldb   <u004E
         lbsr  L2C70
         ldb   <u00A2
         mul
         subd  <u00E6
         lbcs  L2CCE
         tst   u0008,u
         beq   L2F44
         tst   <u0021,u
         beq   L2F4B
         bra   L2F49
L2F44    tst   <u0025,u
         beq   L2F4B
L2F49    asra
         rorb
L2F4B    std   <u00E6
L2F4D    subd  #$00FF
         bcs   L2F65
         std   <u00E6
         lda   #$FF
         sta   <u00DF
         lda   #$20
         sta   <u00DE
         clr   <u00E0
         lbsr  L14FB
         ldd   <u00E6
         bra   L2F4D
L2F65    addd  #$00FF
         stb   <u00DF
         lda   #$20
         sta   <u00DE
         clr   <u00E0
         lbsr  L14FB
         lbra  L2CD1
L2F76    clr   <u00E6
         clr   <u00E7
         ldy   <u0038
         ldx   ,u
L2F7F    cmpx  <u0072
         bcc   L2F9B
         cmpx  u0002,u
         bcc   L2F9B
         ldb   ,x+
         bmi   L2F9C
         cmpb  <u0031,u
         beq   L2FAC
L2F90    lslb
         clra
         ldb   d,y
         clra
         addd  <u00E6
         std   <u00E6
         bra   L2F7F
L2F9B    rts
L2F9C    cmpb  #$F0
         beq   L2F9B
         cmpb  #$F1
         bne   L2F7F
         cmpx  u0002,u
         bne   L2F7F
         ldb   #$2D
         bra   L2F90
L2FAC    lda   ,x+
         bmi   L2F9C
         cmpa  <u0031,u
         beq   L2F7F
         cmpx  u0002,u
         bcs   L2FAC
         rts
L2FBA    tst   u0008,u
         beq   L2FC2
         clrb
         stb   <u0068
         rts
L2FC2    ldb   <u0029,u
         addb  <u002A,u
         stb   <u0068
         bsr   L2FCF
         ldb   <u0068
         rts
L2FCF    stb   <u00EA
         beq   L2FDC
L2FD3    lda   #$A0
         lbsr  L17F0
         dec   <u00EA
         bne   L2FD3
L2FDC    rts
L2FDD    ldd   u000F,u
         addd  #$0001
         lbsr  L26C4
         ldb   #$1B
         lda   #$2D
L2FE9    lbsr  OUTREPT
         decb
         bne   L2FE9
         lda   #$20
         lbsr  OUTREPT
         ldx   >L0573,pcr
         lbsr  L3169
         ldx   <u0036
         leax  $02,x
         lbsr  L3184
         lda   #$20
         lbsr  OUTREPT
         lda   #$2D
L3009    lbsr  OUTREPT
         ldb   <u0041
         cmpb  <u0048
         bcs   L3009
         lbsr  OUTREPT
         lbra  L2CFD
L3018    pshs  y
         lbsr  L0127
         lbsr  L314F
         lbsr  L2D2C
         lbsr  L11AC
         clrb
         lda   <u0079
         lbsr  GOROWCOL
         ldx   ,u
         clr   <u00A7
L3030    cmpx  u0006,u
         beq   L3042
         inc   <u00A7
         lda   ,x+
         bpl   L3030
         cmpa  #$F1
         beq   L3030
         leax  $01,x
         bra   L3030
L3042    ldy   ,u
         clr   <u0067
         ldb   <u0048
         decb
         tst   <u001D,u
         bne   L3061
         subb  <u0029,u
         bpl   L305A
         cmpb  #$C8
         bcs   L305A
         inc   <u0067
L305A    subb  <u002A,u
         bcc   L3061
         inc   <u0067
L3061    subb  <u00A7
         bcc   L308A
         clra
L3066    adda  #$19
         addb  #$19
         bcc   L3066
         inca
         tst   <u001D,u
         bne   L3080
         suba  <u0029,u
         bpl   L307B
         cmpa  #$C8
         bhi   L309F
L307B    suba  <u002A,u
         bcs   L309F
L3080    deca
         beq   L309F
         tst   ,y+
         bpl   L3080
         inca
         bra   L3080
L308A    tst   <u001D,u
         bne   L309F
         ldb   <u002A,u
         addb  <u0029,u
         beq   L309F
         lda   #$20
L3099    lbsr  OUTREPT
         decb
         bne   L3099
L309F    cmpy  u0006,u
         bcc   L30BA
         lda   ,y
         bpl   L30B3
         cmpa  #$F1
         beq   L30B6
         lbsr  L1B26
         leay  $02,y
         bra   L309F
L30B3    lbsr  L1B26
L30B6    leay  $01,y
         bra   L309F
L30BA    ldb   <u0041
         stb   <u0068
         ldb   <u00A2
         addb  <u0098
         subb  <u0099
         bls   L30DC
L30C6    lda   <u0041
         cmpa  <u0048
         bcc   L3137
         lda   >L0537,pcr
         pshs  b
         ldb   #$02
         lbsr  L10EA
         puls  b
         decb
         bne   L30C6
L30DC    ldb   <u0048
         cmpb  <u0041
         bls   L3137
         cmpy  u0002,u
         bcc   L310A
         lda   ,y
         bpl   L30FA
         cmpa  #$F1
         beq   L3101
         cmpa  #$F0
         beq   L310A
         lbsr  L1B26
         leay  $02,y
         bra   L30DC
L30FA    lbsr  L1B26
L30FD    leay  $01,y
         bra   L30DC
L3101    leax  $01,y
         cmpx  u0002,u
         bne   L30FD
         lbsr  L1B26
L310A    ldb   <u0048
         lda   #$20
L310E    cmpb  <u0041
         bls   L3117
         lbsr  OUTREPT
         bra   L310E
L3117    ldy   u0002,u
         ldb   -$01,y
         cmpb  #$F0
         bne   L3124
         lda   >L0538,pcr
L3124    lbsr  OUTREPT
L3127    lda   <u0040
         ldb   <u0068
         lbsr  GOROWCOL
         lbsr  L11B4
         lbsr  L0128
         puls  pc,y
         rts
L3137    cmpy  u0002,u
         bcc   L3117
         lda   ,y
         cmpa  #$F1
         bne   L314A
         leax  $01,y
         cmpx  u0002,u
         beq   L314A
         leay  $01,y
L314A    lbsr  L1B26
         bra   L3127
L314F    tst   u0008,u
         beq   L3158
L3153    ldb   <u0020,u
         bra   L3166
L3158    tst   <u001D,u
         bne   L3153
         ldb   <u001C,u
         subb  <u002A,u
         subb  <u0029,u
L3166    stb   <u00A2
         rts
L3169    pshs  b,a
         lbsr  L0127
         tfr   x,d
         leax  >0,pcr
         leax  d,x
         bra   L317B
L3178    lbsr  OUTREPT
L317B    lda   ,x+
         bne   L3178
         lbsr  L0128
         puls  pc,b,a
L3184    pshs  b,a
         lbsr  L0127
         bra   L317B
L318B    lbsr  L0171
         lbra  L012B
L3191    lbsr  L11BC
         clr   <u00EC
         lda   #$FF
         sta   <u006F
L319A    lbsr  L11B4
         clr   <u005C
         pshs  x,a
         lda   <u00F9
         beq   L31B0
         clr   <u00F9
         ldx   >L0587,pcr
         lbsr  L3356
         bra   L31BD
L31B0    lda   <u00F8
         beq   L31BD
         clr   <u00F8
         ldx   >L058F,pcr
         lbsr  L3356
L31BD    puls  x,a
         ldu   <u0024
         tst   <u00EC
         bne   L31D0
         ldx   >L05DB,pcr
         ldb   #$0C
         lbsr  L4B9C
         bra   L31D3
L31D0    lbsr  L4C1D
L31D3    tsta
         lbeq  L3261
         pshs  a
         lbsr  L3EE1
         puls  a
         lsla
         leax  >L31EC,pcr
         ldd   a,x
         leax  >0,pcr
         jmp   d,x

L31EC    fcb $32,$61,$36,$C2,$34,$DB,$35,$3B,$36,$4B,$32,$DC
         fcb $33,$5F,$32,$70,$33,$11,$36,$8B,$4A,$24,$4C,$36
         fcb $00,$00,$00,$00

L3208    ldx   <u001E
         leay  <$37,x
         sty   <u0063
L3210    lbsr  L012B
         cmpa  >L0534,pcr
         beq   L3261
         cmpa  >L0528,pcr
         beq   L323D
         cmpa  >BSC,pcr
         beq   L3245
         cmpa  #$0D
         beq   L3231
         cmpa  #$1F
         bls   L3210
         cmpx  <u0063
         beq   L3210
L3231    sta   ,x+
         cmpa  #$0D
         beq   L323C
         lbsr  OUTREPT
         bra   L3210
L323C    rts
L323D    cmpx  <u001E
         beq   L3210
         bsr   L324D
         bra   L323D
L3245    cmpx  <u001E
         beq   L3210
         bsr   L324D
         bra   L3210
L324D    leax  -$01,x
L324F    ldd   <u0040
         decb
         lbsr  GOROWCOL
         lda   #$20
         lbsr  OUTREPT
         ldd   <u0040
         decb
         lbsr  GOROWCOL
         rts
L3261    ldu   <u0024
         clr   <u005C
         tst   u0008,u
         lbeq  L2439
         lbsr  L1D78
         bra   L3261
         clr   <u00F9
         clr   <u00F8
         tst   <u005F
         bne   L327C
         tst   <u0060
         beq   L3286
L327C    ldx   >L0595,pcr
         lbsr  L3347
         lbra  L319A
L3286    ldx   >L059B,pcr
         lbsr  L334C
         lbsr  L318B
         lbsr  OUTREPT
         lbsr  L1760
         cmpa  >YCHR,pcr
         lbne  L319A
         ldx   >L0599,pcr
         lbsr  L3351
         lbsr  L318B
         lbsr  OUTREPT
         lbsr  L1760
         cmpa  >YCHR,pcr
         lbne  L319A
         ldx   #$0000
         lbsr  L2522
         lbsr  L25FE
         ldx   <u0081
         ldy   <u0024
         ldd   #$0038
         lbsr  L3F31
         ldu   <u0024
         ldx   <u0072
         leax  -$01,x
         stx   u0006,u
         stx   u0004,u
         lbsr  L1D78
         clr   <u0070
         lbra  L319A
         tst   <u0060
         bne   L327C
         ldx   >L0597,pcr
         bsr   L334C
         lbsr  L318B
         lbsr  WrA2BUF
         lbsr  L1760
         cmpa  >YCHR,pcr
         lbne  L319A
         ldx   >L0599,pcr
         bsr   L3351
         lbsr  L318B
         lbsr  WrA2BUF
         lbsr  L1760
         cmpa  >YCHR,pcr
         lbne  L319A
         lbra  L17E7
         lda   #$01
         bne   L3321
         tst   <u005F
         lbne  L327C
         tst   <u0060
         lbne  L327C
L3321    ldx   >L0593,pcr
         bsr   L3347
         lbsr  L3208
         ldx   <u001E
         lda   #$0D
L332E    cmpa  ,x+
         bne   L332E
         clr   -$01,x
         lbsr  L11BC
         ldx   <u001E
         lbsr  L0408
         bcc   L3341
         lbsr  L02E7
L3341    lbsr  L318B
         lbra  L3191
L3347    ldd   #$0000
         bra   L3359
L334C    ldd   #$0100
         bra   L3359
L3351    ldd   #$0200
         bra   L3359
L3356    ldd   #$0300
L3359    lbsr  GOROWCOL
         lbra  L3169
         ldx   >L057F,pcr
         bsr   L3347
         lbsr  L3208
         leax  -$01,x
         cmpx  <u001E
         lbeq  L319A
         lda   #$01
         sta   <u007E
         ldx   <u001E
         lbsr  L345C
         tst   <u0070
         bne   L33B2
         ldy   <u001E
         bsr   L3394
         lda   #$01
         sta   <u0070
         ldd   #$0037
         ldx   <u0032
         ldy   <u0034
         lbsr  L3F31
         lbra  L4F2A
L3394    pshs  y,x,b,a
         ldb   #$37
         ldx   <u0032
L339A    lda   ,y+
         cmpa  #$0D
         beq   L33AD
         cmpa  #$20
         beq   L33AD
         cmpa  #$2C
         beq   L33AD
         sta   ,x+
         decb
         bne   L339A
L33AD    clra
         sta   ,x
         puls  pc,y,x,b,a
L33B2    lbsr  L0283
         bcs   L3431
         ldy   <u007C
         ldx   <u0024
         ldd   $06,x
         std   <u0069
         ldx   ,x
         bra   L33C8
L33C4    lda   ,x+
         sta   ,y+
L33C8    cmpx  <u0069
         bne   L33C4
         ldx   <u0069
         leax  >-$00C8,x
         stx   <u0063
L33D4    lbsr  L02FB
         bcs   L33F8
         cmpa  #$20
         bcc   L33E3
         cmpa  #$0D
         bne   L33D4
         lda   #$F0
L33E3    sta   ,y+
         cmpy  <u0063
         bne   L33D4
         lda   #$07
         lbsr  WrA2BUF
         ldx   >L0587,pcr
         lbsr  L3356
         bra   L33FA
L33F8    bvc   L3447
L33FA    lbsr  L0294
         ldu   <u0024
         ldx   u0006,u
         leax  $01,x
         cmpx  <u0072
         bne   L340F
         lda   -$01,y
         cmpa  #$F0
         bne   L340F
         leax  $01,x
L340F    leax  -$01,x
         bra   L3417
L3413    lda   ,-y
         sta   ,-x
L3417    cmpy  <u007C
         bne   L3413
         ldu   <u0024
         stx   ,u
         stx   u0006,u
         lbsr  L225C
         lbsr  L23D0
         lda   #$FF
         sta   <u006F
         clr   <u0077
         lbra  L319A
L3431    ldd   #$0100
         lbsr  GOROWCOL
         lbsr  L02E7
         lbsr  L0294
         ldx   >L058B,pcr
         lbsr  L3356
         lbra  L319A
L3447    ldd   #$0100
         lbsr  GOROWCOL
         lbsr  L02E7
         lbsr  L0294
         ldx   >L0589,pcr
         lbsr  L3356
         bra   L33FA
L345C    pshs  x,a
L345E    lda   ,x+
         cmpa  #$0D
         beq   L346C
         cmpa  #$20
         beq   L346C
         cmpa  #$2C
         bne   L345E
L346C    stx   <u0075
         clr   -$01,x
         puls  pc,x,a
L3472    ldx   <u0032
         lbsr  L018D
         bvs   L34D1
         bcc   L347F
         clr   <u0070
         bra   L349D
L347F    ldx   <u0034
         lbsr  L018D
         bvs   L34D1
         bcs   L348E
         lda   #$02
         sta   <u0070
         bra   L349D
L348E    lda   #$01
         sta   <u0070
         ldd   #$0037
         ldx   <u0032
         ldy   <u0034
         lbsr  L3F31
L349D    lbsr  L01DE
         bcc   L34A3
         rts
L34A3    pshs  x
         leax  $02,x
         lbsr  L43D0
         puls  x
         bcs   L34D1
         lda   ,x
         lbsr  L1760
         cmpa  >L054D,pcr
         beq   L34C9
         cmpa  >L054E,pcr
         beq   L34CD
         cmpa  >L054F,pcr
         bne   L34D1
         stb   <u0071
         bra   L349D
L34C9    stb   <u0043
         bra   L349D
L34CD    stb   <u004A
         bra   L349D
L34D1    ldx   >L058D,pcr
         lbsr  L3169
         lbra  L0456
         lda   #$01
         sta   <u00D4
         clr   <u00D2
         tst   <u0060
         beq   L354B
         leax  >L02D8,pcr
         stx   <u0065
         lbra  L35F7
L34EE    tst   <u005F
         beq   L3517
         ldx   <u0081
L34F4    lbsr  L02F2
         bcs   L3511
         sta   ,x+
         cmpx  <u006D
         bcs   L34F4
L34FF    stx   <u0063
         ldx   <u0081
         ldu   <u0065
L3505    lda   ,x+
         jsr   ,u
         bcs   L351B
         cmpx  <u0063
         bcs   L3505
         bra   L34EE
L3511    bvc   L351B
         clr   <u005F
         bra   L34FF
L3517    clr   <u0067
         bra   L351F
L351B    lda   #$01
         sta   <u0067
L351F    lbsr  L11BC
         lbsr  L1207
         tst   <u0067
         beq   L352C
         lbsr  L02E7
L352C    lbsr  L028E
         lbsr  L0294
         lbsr  L02A0
         lbsr  L02A6
         lbra  L0456
         clr   <u00D4
         clr   <u00D2
         tst   <u005F
         lbne  L327C
         tst   <u0060
         lbne  L327C
L354B    leax  >L02E1,pcr
         stx   <u0065
         tst   <u0070
         beq   L358C
L3555    ldx   >L0575,pcr
         lbsr  L3347
         ldx   <u0034
         lbsr  L3184
         ldx   >L0577,pcr
         lbsr  L3169
         lbsr  L318B
         lbsr  L1760
         cmpa  >NCHR,pcr
         beq   L3589
         cmpa  >YCHR,pcr
         beq   L357E
         cmpa  #$0D
         bne   L3555
L357E    lda   >YCHR,pcr
         lbsr  OUTREPT
         ldx   <u0034
         bra   L35A5
L3589    lbsr  OUTREPT
L358C    ldx   >L057F,pcr
         lbsr  L334C
         lbsr  L3208
         leax  -$01,x
         cmpx  <u001E
         lbeq  L319A
         ldx   <u001E
         lbsr  L345C
         ldx   <u001E
L35A5    stx   <u0063
         lbsr  L0223
         bcc   L35F7
         bvc   L35E1
         lbsr  L02A6
L35B1    ldx   <u0063
         lbsr  L0310
         bcc   L35A5
         bvc   L35E1
         ldx   >L057D,pcr
         lbsr  L3351
         lbsr  L318B
         lbsr  L1760
         cmpa  >YCHR,pcr
         beq   L35D1
         cmpa  #$0D
         bne   L35EA
L35D1    lda   >YCHR,pcr
         lbsr  WrA2BUF
         ldx   <u0063
         lbsr  L02B8
         bcs   L35E1
         bra   L35B1
L35E1    ldd   #$0100
         lbsr  GOROWCOL
         lbsr  L02E7
L35EA    ldx   >L0579,pcr
         lbsr  L3356
         lbsr  L02A6
         lbra  L319A
L35F7    ldy   <u006B
         tst   <u00D2
         bne   L3657
L35FE    cmpy  <u007C
         beq   L3624
         lda   ,y+
         cmpa  #$F0
         bne   L360B
         lda   #$0D
L360B    ldx   <u0065
         jsr   ,x
         bcc   L35FE
L3611    ldd   #$0100
         lbsr  GOROWCOL
         lbsr  L02E7
         ldx   >L057B,pcr
         lbsr  L3356
         lbra  L319A
L3624    ldy   <u0024
         ldy   ,y
L362A    cmpy  <u0072
         beq   L363F
         lda   ,y+
         cmpa  #$F0
         bne   L3637
         lda   #$0D
L3637    ldx   <u0065
         jsr   ,x
         bcc   L362A
         bra   L3611
L363F    tst   <u00D4
         lbne  L34EE
L3645    lbsr  L02A6
         lbra  L319A
         lbsr  L3EF5
         bcs   L3670
         inc   <u00D2
         clr   <u00D4
         lbra  L358C
L3657    ldu   <u0024
         ldy   u0006,u
L365C    cmpy  <u00CD
         beq   L3645
         lda   ,y+
         cmpa  #$F0
         bne   L3669
         lda   #$0D
L3669    lbsr  L02E1
         bcc   L365C
         bra   L3611
L3670    lda   #$07
         lbsr  WrA2BUF
         ldx   >L0585,pcr
         lbsr  L3347
         lbra  L319A
L367F    ldd   #$0200
         lbsr  GOROWCOL
         lbsr  L02E7
         lbra  L319A
         lda   #$01
         sta   <u00F3
         clr   <u00B0
         leax  >L36B6,pcr
         stx   <u0059
         ldx   >L05B7,pcr
         lbsr  L3347
         lbsr  L3208
         ldx   <u001E
         lbsr  L345C
         lbsr  L0223
         lbcs  L35E1
         lbsr  L3783
         lbsr  L02A6
         lbra  L3772
L36B6    lbsr  L02E1
         bcs   L36BC
         rts
L36BC    lds   <u0020
         lbra  L367F
         clr   <u00F3
         leax  >L0140,pcr
         stx   <u0059
         ldx   >L05A7,pcr
         lbsr  L3347
L36D1    lbsr  L318B
         cmpa  >L0534,pcr
         lbeq  L319A
         cmpa  #$0D
         beq   L370C
         lbsr  L1760
         beq   L370C
         cmpa  >NCHR,pcr
         beq   L370C
         cmpa  >YCHR,pcr
         beq   L36F8
         lda   #$07
         lbsr  WrA2BUF
         bra   L36D1
L36F8    lbsr  OUTREPT
         ldx   >L05AB,pcr
         lbsr  L3169
         lbsr  L3208
         ldx   <u001E
         lbsr  L345C
         bra   L371D
L370C    lda   >NCHR,pcr
         lbsr  OUTREPT
         ldd   >L0F78,pcr
         leax  >0,pcr
         leax  d,x
L371D    lbsr  L014F
         bcc   L3730
         lbvc  L367F
         ldx   >L05A9,pcr
         lbsr  L3351
         lbra  L319A
L3730    lbsr  L1355
         ldx   >L05AD,pcr
         lbsr  L334C
         clr   <u00B0
L373C    lbsr  L318B
         cmpa  >L0534,pcr
         beq   L376F
         lbsr  L1760
         cmpa  >NCHR,pcr
         beq   L3766
         cmpa  #$0D
         beq   L3766
         cmpa  >YCHR,pcr
         beq   L375F
         lda   #$07
         lbsr  WrA2BUF
         bra   L373C
L375F    lbsr  OUTREPT
         inc   <u00B0
         bra   L376D
L3766    lda   >NCHR,pcr
         lbsr  OUTREPT
L376D    bsr   L3783
L376F    lbsr  L0168
L3772    clr   <u005C
         lda   #$01
         sta   <u0079
         sta   <u007E
         ldu   <u0024
         ldx   ,u
         stx   u0006,u
         lbra  L319A
L3783    lda   #$20
         sta   <u00E1
         clr   <u00E3
         clr   <u00E2
         clr   <u003F
         clr   <u003E
         lda   >L0558,pcr
         lbsr  L1385
         lda   #$01
         sta   <u005B
         sta   <u005C
         clr   <u0083
L379E    lda   #$03
         lbsr  L1246
         ldx   >L05B1,pcr
         lbsr  L3351
L37AA    lbsr  L318B
         cmpa  >L0534,pcr
         lbeq  L38A2
         lbsr  L1760
         cmpa  >NCHR,pcr
         beq   L37DC
         cmpa  #$0D
         beq   L37CF
         cmpa  >YCHR,pcr
         beq   L37CF
         lda   #$07
         lbsr  WrA2BUF
         bra   L37AA
L37CF    lda   >YCHR,pcr
         lbsr  OUTREPT
         clr   <u00CA
         ldb   #$FF
         bra   L3807
L37DC    lbsr  OUTREPT
         ldx   >L05B3,pcr
         lbsr  L3169
         lbsr  L3208
         ldx   <u001E
         lbsr  L43D0
         bcs   L379E
         tstb
         beq   L37F4
         decb
L37F4    stb   <u00CA
         ldx   >L05B5,pcr
         lbsr  L3169
         lbsr  L3208
         ldx   <u001E
         lbsr  L43D0
         bcs   L379E
L3807    stb   <u00CB
         cmpb  <u00CA
         bls   L379E
         ldx   #$0000
         lbsr  L2522
         lbsr  L25FE
         ldx   >L05AF,pcr
         lbsr  L3356
         ldx   <u0024
         ldy   <u0026
         ldd   #$0038
         lbsr  L3F31
         ldu   <u0026
L382A    lda   <u0010,u
         cmpa  <u00CB
         beq   L386A
         cmpa  <u00CA
         bcs   L3865
         lbsr  L38B6
         lbcs  L38A2
         tst   <u00F3
         bne   L3865
         lbsr  L017A
         beq   L3865
         lbsr  L012B
         cmpa  #$20
         beq   L3852
         cmpa  >L0534,pcr
         bne   L3865
L3852    lbsr  L318B
         cmpa  >L0534,pcr
         beq   L3865
         cmpa  #$20
         beq   L3865
         cmpa  #$0D
         beq   L38A2
         bra   L3852
L3865    lbsr  L1D78
         bcc   L382A
L386A    lda   <u001B,u
         cmpa  <u002B,u
         bcc   L3892
         deca
         sta   <u002C,u
         clr   u0002,u
         clr   u0004,u
L387A    lbsr  L1D78
         lda   <u002C,u
         beq   L3892
         lda   <u0010,u
         cmpa  <u00CB
         beq   L3892
         lbsr  L38B6
         lbcs  L38A2
         bra   L387A
L3892    ldb   <u002B,u
         subb  <u005B
         incb
L3898    pshs  b
         lbsr  L135B
         puls  b
         decb
         bne   L3898
L38A2    lda   >L0558,pcr
         lbsr  L1385
         lda   >L0559,pcr
         lbsr  L13C6
         ldu   <u0024
         lbsr  L1D78
         rts
L38B6    lda   [,u]
         cmpa  >L0539,pcr
         beq   L38C8
         tst   <u001D,u
         bne   L38C8
         tst   <u002C,u
         bne   L38CB
L38C8    andcc #$FE
         rts
L38CB    lda   <u002D,u
         lbsr  L1385
         lda   <u002E,u
         lbsr  L13C6
         clr   <u00E4
         clr   <u00E5
L38DB    lda   <u002C,u
         cmpa  <u005B
         beq   L390D
         lbsr  L135B
         lda   <u005B
         inca
         sta   <u005B
         cmpa  <u002B,u
         bls   L38DB
         lda   #$01
         sta   <u005B
         tst   <u00B0
         beq   L38DB
L38F7    lbsr  L318B
         cmpa  >L0534,pcr
         beq   L38DB
         cmpa  #$20
         beq   L38DB
         cmpa  #$0D
         beq   L390A
         bra   L38F7
L390A    orcc  #$01
         rts
L390D    ldd   u0002,u
         subd  ,u
         cmpd  #$0001
         bne   L391A
         andcc #$FE
         rts
L391A    ldd   <u0011,u
         bitb  #$01
         beq   L3926
         ldb   <u0018,u
         bra   L3929
L3926    ldb   <u0017,u
L3929    decb
         bmi   L393F
         lda   #$20
         sta   <u00DE
         clr   <u00E0
         lda   <u003F
         sta   <u00DF
         pshs  b
         lbsr  L14E3
         puls  b
         bra   L3929
L393F    lbsr  L2C7D
         andcc #$FE
         rts
         ldb   [<u0006,u]
         bmi   L395B
         clr   <u00CC
         bsr   L397B
         tfr   b,a
         lbsr  L2B0E
         ldx   u0006,u
         leax  -$01,x
         stx   u0006,u
         bra   L396A
L395B    cmpb  #$F0
         beq   L3978
         cmpb  #$F1
         beq   L3978
         stb   <u00CC
         bsr   L397B
         stb   [<u0006,u]
L396A    ldy   u0006,u
         clr   <u00D7
         lbsr  L1B26
         ldd   <u0040
         decb
         lbsr  GOROWCOL
L3978    lbra  L45B6
L397B    pshs  a
         tst   <u00CC
         beq   L3983
         dec   <u00CC
L3983    cmpa  >L051C,pcr
         beq   L39AA
         cmpa  >L051D,pcr
         beq   L39AE
         cmpa  >L051E,pcr
         beq   L39B2
         cmpa  >L051F,pcr
         beq   L39B6
         cmpa  >L0520,pcr
         beq   L39BE
         tst   <u00CC
         beq   L39A7
         inc   <u00CC
L39A7    clrb
         puls  pc,a
L39AA    ldb   #$01
         bra   L39C6
L39AE    ldb   #$04
         bra   L39C6
L39B2    ldb   #$02
         bra   L39C6
L39B6    ldb   <u00CC
         andb  #$0F
         orb   #$40
         bra   L39D0
L39BE    ldb   <u00CC
         andb  #$0F
         orb   #$60
         bra   L39D0
L39C6    lda   <u00CC
         anda  #$70
         bne   L39CE
         orb   #$30
L39CE    orb   <u00CC
L39D0    orb   #$80
         incb
         stb   <u00CC
         puls  pc,a
         lda   [<u0006,u]
         lbpl  L45B6
         cmpa  #$F0
         lbeq  L45B6
         cmpa  #$F1
         lbeq  L45B6
         ldx   u0006,u
         leay  $01,x
         ldd   u0006,u
         sty   u0006,u
         subd  ,u
         lbsr  L3F1E
         sty   ,u
         lbra  L396A
         tst   <u0074
         beq   L3A0A
         lda   #$16
         lbsr  L2B46
         lbra  L248A
L3A0A    lbsr  L3EF5
         lbcs  L248A
         ldd   <u00CD
         subd  u0006,u
         std   <u00CF
         ldd   ,u
         subd  <u007C
         subd  #$0002
         subd  <u00CF
         bcc   L3A2A
         lda   #$17
         lbsr  L2B46
         lbra  L248A
L3A2A    ldd   <u00CF
         ldy   <u007C
         ldx   u0006,u
         lbsr  L3F31
         ldd   <u0072
         subd  <u00CD
         subd  #$0002
         ldx   <u00CD
         leax  $02,x
         ldy   u0006,u
         leay  $02,y
         lbsr  L3F31
         sty   <u0072
         lda   #$01
         sta   <u0074
         ldd   <u00CF
         ldx   <u007C
         ldy   <u0072
         lbsr  L3F31
         ldd   u0006,u
         subd  ,u
         ldx   u0006,u
         leay  $02,x
         sty   u0006,u
         lbsr  L3F1E
         sty   ,u
L3A69    lbsr  L225C
         lbsr  L23D0
         lda   <u0079
         inca
         sta   <u0077
         sta   <u006F
         lbra  L246F
         tst   <u0074
         bne   L3A85
         lda   #$18
         lbsr  L2B46
         lbra  L248A
L3A85    ldd   ,u
         subd  <u007C
         subd  <u00CF
         bcc   L3A95
         lda   #$17
         lbsr  L2B46
         lbra  L248A
L3A95    ldx   <u0072
         ldy   <u007C
         ldd   <u00CF
         lbsr  L3F31
         ldd   <u0072
         subd  u0006,u
         ldx   <u0072
         ldy   <u006D
         sty   <u0072
         lbsr  L3F1E
         clr   <u0074
         ldd   <u00CF
         ldx   <u007C
         ldy   u0006,u
         lbsr  L3F31
         bra   L3A69
         tst   <u0074
         bne   L3AC8
         lda   #$18
         lbsr  L2B46
         lbra  L248A
L3AC8    ldd   ,u
         subd  <u007C
         cmpd  #$00C8
         bcs   L3ADC
         subd  <u00CF
         bcs   L3ADC
         cmpd  #$00C8
         bhi   L3AE4
L3ADC    lda   #$17
         lbsr  L2B46
         lbra  L248A
L3AE4    ldd   ,u
         subd  <u00CF
         ldx   ,u
         std   ,u
         ldy   ,u
         stx   <u0069
         ldd   u0006,u
         subd  <u0069
         lbsr  L3F31
         sty   u0006,u
         ldx   <u0072
         ldy   u0006,u
         ldd   <u00CF
         lbsr  L3F31
         lbra  L3A69
         lbsr  L3EF5
         lbcs  L248A
         lda   <u0079
         lbsr  L1246
         lda   <u0079
         clrb
         lbsr  GOROWCOL
         ldd   <u00CD
         subd  u0006,u
         lbsr  L26C4
         ldx   >L05D7,pcr
         lbsr  L3169
         ldx   <u0036
         lbsr  L3184
         ldx   >L05D9,pcr
         lbsr  L3169
         lbsr  L1744
         lbsr  OUTREPT
         anda  #$5F
         cmpa  >YCHR,pcr
         lbne  L246F
         ldy   <u00CD
         leay  $02,y
         ldx   u0006,u
         ldd   u0006,u
         subd  ,u
         sty   u0006,u
         lbsr  L3F1E
         sty   ,u
         lbra  L3A69
         lda   >L053A,pcr
         lbsr  L2B0E
         lbsr  L23D0
         lbra  L246F
         clr   <u00F2
         clr   <u00D5
         lda   #$01
         sta   <u007E
         lda   #$04
         sta   <u0079
         clr   <u00D9
         lbsr  L2C7D
         lda   <u0079
         inca
         sta   <u0077
         sta   <u006F
L3B80    lbsr  L3EE1
         ldd   #$0000
         lbsr  GOROWCOL
         ldx   >L05CB,pcr
         lbsr  L3169
L3B90    ldx   <u001E
         stx   <u00C2
         lbsr  L3D74
         bcs   L3B80
         ldx   <u001E
         pshs  x
         ldd   <u00C2
         subd  ,s++
         cmpd  #$0001
         beq   L3B90
L3BA7    lbsr  L3E1B
         bcs   L3BDE
         lda   <u0079
         inca
         sta   <u0077
         sta   <u006F
         ldd   #$0200
         lbsr  GOROWCOL
         ldx   >L05CD,pcr
         lbsr  L3169
         lda   #$01
         sta   <u0083
         lda   <u0079
         clr   <u00D9
         lbsr  L2C7D
L3BCB    lbsr  L1744
         cmpa  #$0D
         beq   L3BE3
         cmpa  >L0534,pcr
         beq   L3BE3
         cmpa  #$20
         bne   L3BCB
         bra   L3BA7
L3BDE    lda   #$20
         lbsr  L2B46
L3BE3    lda   #$04
         sta   <u0079
         lbsr  L2C0D
         lda   <u0079
         cmpa  #$04
         beq   L3BF5
         inca
         sta   <u006F
         sta   <u0077
L3BF5    lbra  L2435
         clr   <u00F2
         clr   <u00D5
         lda   #$01
         sta   <u007E
         clr   <u00B0
         lda   #$04
         sta   <u0079
         clr   <u00D9
         lbsr  L2C7D
         lda   <u0079
         inca
         sta   <u0077
         sta   <u006F
L3C12    lbsr  L3EE1
         ldd   #$0000
         lbsr  GOROWCOL
         ldx   >L05D1,pcr
         lbsr  L3169
         ldx   <u001E
         stx   <u00C2
L3C26    lbsr  L3D74
         bcs   L3C12
         ldx   <u001E
         pshs  x
         ldd   <u00C2
         subd  ,s++
         cmpd  #$0001
         beq   L3C26
         ldd   <u00C2
         std   <u00C0
         ldd   #$0100
         lbsr  GOROWCOL
         ldx   >L05D3,pcr
         lbsr  L3169
         lbsr  L3D74
         bcs   L3C12
L3C4F    lbsr  L3E1B
         lbcs  L3D56
         tst   <u00B0
         bne   L3CA7
         lda   #$05
         sta   <u0077
         sta   <u006F
         lda   #$02
         lbsr  L1246
         lda   #$03
         lbsr  L1246
         ldd   #$0200
         lbsr  GOROWCOL
         ldx   >L05D5,pcr
         lbsr  L3169
         lda   #$01
         sta   <u0083
         lda   #$04
         sta   <u0079
         clr   <u00D9
         lbsr  L2C7D
L3C84    lbsr  L1744
         cmpa  >L0534,pcr
         lbeq  L3BE3
         anda  #$5F
         cmpa  >NCHR,pcr
         beq   L3CE9
         cmpa  >L0542,pcr
         beq   L3CA5
         cmpa  >YCHR,pcr
         bne   L3C84
         bra   L3CA7
L3CA5    inc   <u00B0
L3CA7    ldd   <u00C0
         addd  #$0001
         addd  <u00C6
         subd  <u00C4
         subd  <u00C2
         bcs   L3D19
         ldx   u0006,u
         leay  b,x
         ldd   u0006,u
         subd  ,u
         sty   u0006,u
         lbsr  L3F1E
         sty   ,u
L3CC5    ldd   <u00C2
         subd  <u00C0
         subd  #$0001
         ldx   <u00C0
         ldy   u0006,u
         lbsr  L3F31
         sty   <u00D5
         lbsr  L225C
         lbsr  L23D0
         tst   <u00B0
         lbne  L3C4F
         lda   #$05
         sta   <u006F
         sta   <u0077
L3CE9    ldd   #$0200
         lbsr  GOROWCOL
         ldx   >L05CD,pcr
         lbsr  L3169
         lda   #$01
         sta   <u0083
         lda   #$04
         clr   <u00D9
         lbsr  L2C7D
L3D01    lbsr  L1744
         cmpa  #$0D
         lbeq  L3BE3
         cmpa  >L0534,pcr
         lbeq  L3BE3
         cmpa  #$20
         bne   L3D01
         lbra  L3C4F
L3D19    stb   <u0068
         addd  ,u
         subd  <u007C
         bcs   L3D48
         cmpd  #$000A
         bcs   L3D48
         cmpd  #$00C8
         bhi   L3D32
         lda   #$19
         lbsr  L2B46
L3D32    ldx   ,u
         ldb   <u0068
         leay  b,x
         ldd   u0006,u
         subd  ,u
         sty   ,u
         lbsr  L3F31
         sty   u0006,u
         lbra  L3CC5
L3D48    lda   #$1A
         lbsr  L2B46
         lda   <u0079
         inca
         sta   <u0077
         sta   <u006F
         bra   L3D5B
L3D56    lda   #$20
         lbsr  L2B46
L3D5B    lda   #$04
         sta   <u0079
         lbsr  L2C0D
         lda   #$04
         cmpa  <u0079
         bne   L3D6C
         tst   <u00B0
         beq   L3D71
L3D6C    inca
         sta   <u006F
         sta   <u0077
L3D71    lbra  L2435
L3D74    lda   >L0551,pcr
         ldb   #$02
         lbsr  L10EA
         clrb
         ldx   <u00C2
L3D80    lbsr  L1744
         cmpa  >L0534,pcr
         lbeq  L3BE3
         cmpa  >L0528,pcr
         beq   L3DFB
         cmpa  #$0D
         beq   L3DAF
         cmpa  >L0536,pcr
         beq   L3DFE
         cmpa  >BSC,pcr
         beq   L3DD0
         cmpa  >L0538,pcr
         bne   L3DAB
         lda   #$F0
         bra   L3DAF
L3DAB    cmpa  #$20
         bcs   L3D80
L3DAF    sta   b,x
         cmpa  #$0D
         beq   L3DEB
         incb
         cmpb  #$32
         bcs   L3DC3
         lda   #$1F
         lbsr  L2B46
         cmpb  #$32
         bhi   L3DFB
L3DC3    cmpa  #$F0
         bne   L3DCB
         lda   >L0538,pcr
L3DCB    lbsr  OUTREPT
         bra   L3D80
L3DD0    tstb
         beq   L3DFB
         pshs  b
         ldd   <u0040
         decb
         lbsr  GOROWCOL
         lda   #$20
         lbsr  OUTREPT
         ldd   <u0040
         decb
         lbsr  GOROWCOL
         puls  b
         decb
         bra   L3D80
L3DEB    incb
         abx
         stx   <u00C2
         lda   >L0550,pcr
         ldb   #$02
         lbsr  L10EA
         andcc #$FE
         rts
L3DFB    orcc  #$01
         rts
L3DFE    lda   #$0D
         sta   b,x
         incb
         abx
         stx   <u00C2
         lda   >L0550,pcr
         ldb   #$02
         lbsr  L10EA
         ldx   >L05CF,pcr
         lbsr  L3169
         inc   <u00F2
         andcc #$FE
         rts
L3E1B    ldx   u0006,u
         cmpx  <u00D5
         bhi   L3E25
         ldx   <u00D5
         bra   L3E33
L3E25    lda   ,x+
         bpl   L3E33
         cmpa  #$F0
         beq   L3E33
         cmpa  #$F1
         beq   L3E33
         leax  $01,x
L3E33    stx   <u00C4
         cmpx  <u0072
         bcc   L3E6E
L3E39    ldy   <u001E
         ldx   <u00C4
L3E3E    lda   ,x
         tst   <u00F2
         beq   L3E5A
         cmpa  #$41
         bcs   L3E5A
         cmpa  #$5A
         bhi   L3E50
         adda  #$20
         bra   L3E5A
L3E50    cmpa  #$61
         bcs   L3E5A
         cmpa  #$7A
         bhi   L3E5A
         suba  #$20
L3E5A    ldb   ,x+
         bpl   L3E62
         cmpa  #$F0
         bne   L3E6A
L3E62    cmpa  ,y
         beq   L3E71
         cmpb  ,y
         beq   L3E71
L3E6A    cmpx  <u0072
         bcs   L3E3E
L3E6E    orcc  #$01
         rts
L3E71    stx   <u00C4
         leay  $01,y
         bra   L3EA9
L3E77    lda   ,y
         cmpa  #$0D
         beq   L3EAF
         lda   ,x
         tst   <u00F2
         beq   L3E99
         cmpa  #$41
         bcs   L3E99
         cmpa  #$5A
         bhi   L3E8F
         adda  #$20
         bra   L3E99
L3E8F    cmpa  #$61
         bcs   L3E99
         cmpa  #$7A
         bhi   L3E99
         suba  #$20
L3E99    ldb   ,x+
         bpl   L3EA1
         cmpa  #$F0
         bne   L3EA9
L3EA1    cmpb  ,y+
         beq   L3EA9
         cmpa  -$01,y
         bne   L3E39
L3EA9    cmpx  <u0072
         bne   L3E77
         bra   L3E39
L3EAF    cmpx  <u0072
         bcc   L3E6E
         stx   <u00C6
         ldx   <u00C4
         leax  -$01,x
         stx   <u00C4
         lda   -$01,x
         bpl   L3ECB
         cmpa  #$F0
         beq   L3ECB
         cmpa  #$F1
         beq   L3ECB
         leax  -$01,x
         stx   <u00C4
L3ECB    ldx   <u00C4
         cmpx  u0002,u
         bcs   L3ED8
         lbsr  L1D78
         bcs   L3EDD
         bra   L3ECB
L3ED8    andcc #$FE
         stx   u0006,u
         rts
L3EDD    clr   <u0079
         bra   L3E6E
L3EE1    clra
         lbsr  L1246
         lda   #$01
         lbsr  L1246
         lda   #$02
         lbsr  L1246
         lda   #$03
         lbsr  L1246
         rts
L3EF5    ldx   u0006,u
L3EF7    lda   ,x+
         cmpx  <u0072
         beq   L3F16
         cmpa  >L053A,pcr
         bne   L3EF7
         lda   ,x+
         cmpx  <u0072
         beq   L3F16
         cmpa  >L053A,pcr
         bne   L3EF7
         leax  -$02,x
         stx   <u00CD
         andcc #$FE
         rts
L3F16    lda   #$15
         lbsr  L2B46
         orcc  #$01
         rts
L3F1E    inca
         pshs  a
         tstb
         bra   L3F29
L3F24    lda   ,-x
         sta   ,-y
         decb
L3F29    bne   L3F24
         dec   ,s
         bne   L3F24
         puls  pc,a
L3F31    inca
         pshs  a
         tstb
         bra   L3F3C
L3F37    lda   ,x+
         sta   ,y+
         decb
L3F3C    bne   L3F37
         dec   ,s
         bne   L3F37
         puls  pc,a
L3F44    clr   <u0067
         leay  >0,pcr
         ldd   >L055F,pcr
         leay  d,y
L3F50    ldx   ,u
         leax  $01,x
L3F54    lda   ,x+
         cmpa  #$20
         beq   L3F7B
         cmpa  #$2C
         beq   L3F7B
         lbsr  L1760
         cmpa  ,y+
         bne   L3F7B
         tst   ,y
         bne   L3F54
         lda   ,x
         cmpa  #$20
         beq   L3FA6
         cmpa  #$2C
         beq   L3FA6
         cmpa  #$F0
         beq   L3FA6
         leay  $01,y
         bra   L3F7F
L3F7B    tst   ,y+
         bne   L3F7B
L3F7F    inc   <u0067
         tst   ,y
         bne   L3F50
L3F85    cmpu  <u0024
         bne   L3F8F
         lda   #$0C
         lbra  L2B46
L3F8F    rts
L3F90    cmpu  <u0024
         bne   L3F8F
         lda   #$0D
         lbra  L2B46
         rts
L3F9B    cmpu  <u0024
         bne   L3F8F
         lda   #$0E
         lbra  L2B46
         rts
L3FA6    leay  >L3FC4,pcr
         lda   <u0067
         cmpa  #$04
         ble   L3FBB
         tst   <u001D,u
         bne   L3F9B
         tst   u0008,u
         lbne  L3F85
L3FBB    lsla
         ldd   a,y
         leay  >0,pcr
         jmp   d,y

L3FC4    fcb $40,$1A,$40,$B7,$40,$42,$43,$BF,$3F,$8F,$40,$83,$40,$F0
         fcb $40,$3E,$40,$5C,$41,$5E,$41,$70,$42,$19,$42,$4D,$40,$38
         fcb $41,$AC,$41,$90,$41,$DA,$41,$B7,$40,$08,$42,$81,$42,$C1
         fcb $43,$01,$43,$10,$43,$23,$43,$29,$43,$2F,$43,$41,$43,$53
         fcb $43,$64,$43,$A7,$43,$B5,$43,$C6,$00,$00,$00,$00

L4008    lbsr  L43D0
         lbcs  L3F85
         cmpb  <u002C,u
         lbls  L3F90
         stb   <u002C,u
         rts
         lbsr  L43D0
         lbcs  L3F85
         cmpb  #$00
         bne   L4027
         ldb   #$01
L4027    tst   <u001D,u
         bne   L4030
         tst   u0008,u
         beq   L4034
L4030    stb   <u0021,u
         rts
L4034    stb   <u0025,u
         rts
L4038    lda   #$01
L403A    sta   <u0026,u
         rts
         clr   <u0026,u
         rts
         lbsr  L43D0
         cmpb  #$00
         bne   L404B
         ldb   #$01
L404B    tst   <u001D,u
         bne   L4054
         tst   u0008,u
         beq   L4058
L4054    stb   <u0022,u
         rts
L4058    stb   <u0027,u
         rts
         lbsr  L43D0
         lbcs  L3F85
         cmpb  #$78
         lbhi  L3F90
         stb   <u0017,u
         stb   <u0018,u
         lbsr  L43D0
         tstb
         beq   L4082
         lbcs  L3F85
         cmpb  #$78
         lbhi  L3F90
         stb   <u0018,u
L4082    rts
         lbsr  L43D0
         lbcs  L3F85
         cmpd  #$0003
         lbcs  L3F90
         cmpb  #$64
         lbhi  L3F90
         stb   <u002B,u
         tfr   b,a
         suba  <u001E,u
         lbcs  L3F90
         suba  <u001A,u
         lbcs  L3F90
         cmpa  #$02
         lbls  L3F90
         lbsr  L4185
         lbra  L3F8F
         lbsr  L43D0
         lbcs  L3F85
L40BE    tst   <u001D,u
         bne   L40DC
         tst   u0008,u
         bne   L40DC
         lda   <u001C,u
         pshs  a
         stb   <u001C,u
         bsr   L4128
         puls  a
         bcc   L40DB
         sta   <u001C,u
         lbra  L3F90
L40DB    rts
L40DC    lda   <u0020,u
         stb   <u0020,u
         pshs  a
         bsr   L4128
         puls  a
         bcc   L40DB
         sta   <u0020,u
         lbra  L3F90
         lbsr  L43D0
         lbcs  L3F85
         bsr   L40BE
         lbsr  L43D0
         lbcs  L3F85
         lbsr  L41BE
         lda   #$16
         sta   <u0067
         ldy   <u0030
L410A    clr   ,y+
         deca
         bne   L410A
         ldy   <u0030
L4112    lbsr  L43D0
         tstb
         beq   L4124
         lbcs  L3F85
         bsr   L4125
         dec   <u0067
         beq   L4124
         bra   L4112
L4124    rts
L4125    stb   ,y+
         rts
L4128    pshs  a
         lda   <u0020,u
         cmpa  #$96
         bhi   L4150
         lda   <u002A,u
         adda  <u0029,u
         bmi   L4150
         lda   <u001C,u
         cmpa  #$96
         bhi   L4150
         suba  <u002A,u
         bcs   L4150
         suba  <u0029,u
         cmpa  #$0A
         bcs   L4150
         andcc #$FE
         puls  pc,a
L4150    cmpu  <u0024
         bne   L415A
         lda   #$0D
         lbsr  L2B46
L415A    orcc  #$01
         puls  pc,a
         lbsr  L43D0
         lbcs  L3F85
         tstb
         bne   L4169
         incb
L4169    addb  <u002C,u
         stb   <u002C,u
         rts
         lbsr  L43D0
         lbcs  L3F85
         tstb
         beq   L4181
         cmpb  #$03
         lbhi  L3F90
         decb
L4181    stb   <u0024,u
         rts
L4185    lda   <u002B,u
         suba  <u001A,u
         inca
         sta   <u001B,u
         rts
L4190    ldd   u000F,u
         addd  #$0001
         cmpb  <u0071
         bne   L41A5
         cmpu  <u0024
         lbne  L3F8F
         lda   #$24
         lbra  L2B46
L41A5    lda   <u001B,u
         sta   <u002C,u
         rts
         lbsr  L43D0
         lbcs  L3F85
         std   <u0011,u
         rts
         lbsr  L43D0
         lbcs  L3F85
L41BE    tst   u0008,u
         lbne  L3F9B
         tst   <u001D,u
         lbne  L3F9B
         lda   <u002A,u
         stb   <u002A,u
         lbsr  L4128
         bcc   L41D9
         sta   <u002A,u
L41D9    rts
         clr   <u0067
L41DC    leax  $01,x
         lda   ,x
         cmpa  #$20
         beq   L41DC
         cmpa  #$2C
         beq   L41DC
         cmpa  #$2D
         bne   L41F0
         com   <u0067
         leax  $01,x
L41F0    lbsr  L43D0
         lbcs  L3F85
         tst   <u0067
         beq   L41FD
         comb
         incb
L41FD    tst   u0008,u
         lbne  L3F9B
         tst   <u001D,u
         lbne  L3F9B
         lda   <u0029,u
         stb   <u0029,u
         lbsr  L4128
         bcc   L41D9
         sta   <u0029,u
         rts
         tst   <u001D,u
         lbne  L3F9B
         tst   u0008,u
         lbne  L3F9B
         lda   #$01
         sta   <u001D,u
         clr   <u001E,u
         cmpu  <u0024
         beq   L4237
         ldd   u0004,u
         bra   L4249
L4237    ldd   <u007C
         ldx   u0004,u
         pshs  u
         ldu   <u0026
         cmpx  <u0015,u
         bne   L4247
         std   <u0015,u
L4247    puls  u
L4249    std   <u0015,u
         rts
         tst   <u001D,u
         lbne  L3F9B
         tst   u0008,u
         lbne  L3F9B
         lda   #$02
         sta   <u001D,u
         clr   <u001F,u
         cmpu  <u0024
         beq   L426B
         ldd   u0004,u
         bra   L427D
L426B    ldd   <u007C
         ldx   u0004,u
         pshs  u
         ldu   <u0026
         cmpx  <u0013,u
         bne   L427B
         std   <u0013,u
L427B    puls  u
L427D    std   <u0013,u
         rts
         lbsr  L43D0
         bcc   L42A4
         lbsr  L1760
         ldb   <u0053
         cmpa  >L0546,pcr
         beq   L42BD
         ldb   <u0054
         cmpa  >L0547,pcr
         beq   L42BD
         ldb   <u0055
         cmpa  >L0548,pcr
         beq   L42BD
         lbra  L3F85
L42A4    cmpb  <u0053
         beq   L42BD
         cmpb  <u0054
         beq   L42BD
         cmpb  <u0055
         beq   L42BD
         cmpb  #$0C
         beq   L42BD
         cmpb  #$0A
         beq   L42BD
         lda   #$1E
         lbsr  L2B46
L42BD    stb   <u002D,u
         rts
         lbsr  L43D0
         bcc   L42E4
         lbsr  L1760
         ldb   <u0058
         cmpa  >L0548,pcr
         beq   L42FD
         ldb   <u0056
         cmpa  >L0546,pcr
         beq   L42FD
         ldb   <u0057
         cmpa  >L0547,pcr
         beq   L42FD
         lbra  L3F85
L42E4    cmpb  <u0058
         beq   L42FD
         cmpb  <u0056
         beq   L42FD
         cmpb  <u0057
         beq   L42FD
         cmpb  #$06
         beq   L42FD
         cmpb  #$08
         beq   L42FD
         lda   #$23
         lbsr  L2B46
L42FD    stb   <u002E,u
         rts
         tst   <u00DD
         bne   L430A
         lda   #$22
         lbra  L2B46
L430A    lda   #$01
         sta   <u0030,u
         rts
         clr   <u0030,u
         tst   <u005C
         beq   L4322
         tst   <u00E2
         beq   L4322
         clr   <u00DE
         clr   <u00E0
         lbsr  L14E3
L4322    rts
         bsr   L4335
         sta   <u0031,u
         rts
         bsr   L4335
         sta   <u0033,u
         rts
         bsr   L4335
         sta   <u0032,u
         rts
L4335    lda   ,x+
         cmpa  #$20
         beq   L4335
         cmpa  #$F0
         bne   L4340
         clra
L4340    rts
         lbsr  L43D0
         lbcs  L3F85
L4348    addb  <u002C,u
         cmpb  <u001B,u
         lbcc  L4190
         rts
         ldb   <u0035,u
         lbsr  L41FD
         ldb   <u0037,u
         bsr   L4348
         ldb   <u0036,u
         lbra  L4169
         clr   <u0067
L4366    leax  $01,x
         lda   ,x
         cmpa  #$20
         beq   L4366
         cmpa  #$2C
         beq   L4366
         cmpa  #$2D
         bne   L437A
         com   <u0067
         leax  $01,x
L437A    bsr   L43D0
         lbcs  L3F85
         tst   <u0067
         beq   L4386
         comb
         incb
L4386    tst   u0008,u
         lbne  L3F9B
         tst   <u001D,u
         lbne  L3F9B
         lda   <u0029,u
         stb   <u0029,u
         lbsr  L4128
         sta   <u0029,u
         lbcs  L3F90
         stb   <u0035,u
         rts
         bsr   L43D0
         lbcs  L3F85
         tstb
         bne   L43B1
         incb
L43B1    stb   <u0036,u
         rts
         bsr   L43D0
         lbcs  L3F85
         stb   <u0037,u
L43BE    rts
         tst   <u005C
         beq   L43BE
         lbra  L134F
         bsr   L43D0
         lbcs  L3F85
         stb   <u002F,u
         rts
L43D0    clra
         clrb
         std   <u0069
L43D4    lda   ,x+
         cmpa  #$20
         beq   L43D4
         cmpa  #$2C
         beq   L43D4
         bra   L43E4
L43E0    lda   ,x+
         beq   L441D
L43E4    cmpa  #$F0
         beq   L441D
         cmpa  #$0D
         beq   L441D
         cmpa  #$20
         beq   L441D
         cmpa  #$2C
         beq   L441D
         cmpa  #$2D
         beq   L441D
         cmpa  <u0031,u
         beq   L441D
         cmpa  #$30
         bcs   L4422
         cmpa  #$39
         bhi   L4422
         anda  #$0F
         pshs  a
         ldd   <u0069
         lslb
         rola
         lslb
         rola
         lslb
         rola
         addd  <u0069
         addd  <u0069
         addb  ,s+
         adca  #$00
         std   <u0069
         bra   L43E0
L441D    andcc #$FE
         ldd   <u0069
         rts
L4422    orcc  #$01
         rts
         ldx   u0006,u
         cmpx  ,u
         bls   L445B
L442B    lda   ,-x
         bmi   L442B
         cmpx  ,u
         bcs   L445B
         cmpa  #$20
         beq   L4445
L4437    lda   ,-x
         bmi   L4437
         cmpx  ,u
         bcs   L4467
         cmpa  #$20
         bne   L4437
         bra   L4467
L4445    lda   ,-x
         cmpx  ,u
         bcs   L445B
         cmpa  #$20
         beq   L4445
L444F    lda   ,-x
         cmpx  ,u
         bls   L4469
         cmpa  #$20
         beq   L4467
         bra   L444F
L445B    lda   <u00A5
         adda  <u0048
         sta   <u0080
         lbsr  L44C0
         lbra  L248A
L4467    leax  $01,x
L4469    stx   u0006,u
         clr   <u0083
         clr   <u00D9
         lda   <u0079
         lbsr  L2C7D
         lda   <u0041
         adda  <u00A5
         sta   <u0080
         lbra  L248A
         ldx   u0006,u
L447F    lda   ,x+
         bpl   L448D
         cmpa  #$F0
         beq   L448D
         cmpa  #$F1
         beq   L448D
         lda   ,x+
L448D    cmpx  u0002,u
         bcc   L44B1
         cmpa  #$20
         bne   L447F
L4495    lda   ,x+
         cmpa  #$20
         beq   L4495
         leax  -$01,x
         stx   u0006,u
         clr   <u00D9
         clr   <u0083
         lda   <u0079
         lbsr  L2C7D
         lda   <u0041
         adda  <u00A5
         sta   <u0080
         lbra  L248A
L44B1    lda   <u00A5
         sta   <u0080
         lbsr  L4550
         lbra  L248A
         bsr   L44C0
         lbra  L248A
L44C0    tst   <u007E
         bne   L44C8
         ldx   u000B,u
         bra   L44CA
L44C8    ldx   u0009,u
L44CA    leax  -$01,x
         cmpx  #$FFFF
         beq   L44E3
         pshs  x
         lbsr  L2522
         ldu   <u0024
         puls  x
         ldy   <u0022
         tst   $08,y
         bne   L44CA
         bra   L44E9
L44E3    lda   #$07
         lbsr  L2B46
         rts
L44E9    ldy   <u0022
         ldb   <u0040
         clra
         clr   <u0083
         tst   <u007E
         bne   L44FB
         addd  $0B,y
         subd  u000B,u
         bra   L44FF
L44FB    addd  $09,y
         subd  u0009,u
L44FF    bcc   L452A
         cmpb  #$FF
         bne   L4513
         inc   <u006F
         lbsr  L11E0
         beq   L451D
         lda   #$01
         sta   <u00A3
         clrb
         bra   L4526
L4513    inc   <u006F
         lbsr  L11E0
         beq   L451D
         incb
         bne   L4513
L451D    lda   #$01
         sta   <u006F
         sta   <u0077
         clr   <u00A3
         clrb
L4526    lda   #$01
         sta   <u0083
L452A    tfr   b,a
         clrb
         lbsr  GOROWCOL
         lbsr  L25FE
         ldu   <u0024
         lbsr  L1B9A
         lda   #$01
         sta   <u00D9
         lda   <u0040
         sta   <u0079
         lbsr  L2C7D
         tst   <u0077
         beq   L454A
         lbsr  L2BB7
L454A    rts
         bsr   L4550
         lbra  L248A
L4550    lbsr  L1D78
         bcc   L455B
         lbsr  L2B46
         lbra  L248A
L455B    tst   <u007E
         bne   L456C
         lda   [,u]
         cmpa  >L0539,pcr
         beq   L4550
         tst   <u001D,u
         bne   L4550
L456C    lda   <u0040
         clr   <u0083
         inca
         cmpa  <u0047
         bls   L4580
         lbsr  L11D2
         lda   #$01
         sta   <u0083
         sta   <u00A3
         lda   <u0047
L4580    clrb
         lbsr  GOROWCOL
         cmpa  <u006F
         bcs   L458A
         sta   <u0083
L458A    tst   u0008,u
         beq   L459F
         tst   <u0083
         beq   L4550
         clr   <u00D9
         ldb   #$01
         stb   <u0083
         lda   <u0040
         lbsr  L2C7D
         bra   L4550
L459F    ldb   #$01
         stb   <u00D9
         lda   <u0040
         lbsr  L2C7D
         lda   <u0040
         sta   <u0079
         tst   <u0083
         beq   L45B5
         inca
         sta   <u006F
         sta   <u0077
L45B5    rts
L45B6    bsr   L45BB
         lbra  L248A
L45BB    ldx   u0006,u
L45BD    lda   ,x
         bpl   L45CB
         cmpa  #$F0
         beq   L45CB
         cmpa  #$F1
         beq   L45CB
         leax  $01,x
L45CB    leax  $01,x
         cmpx  u0002,u
         bcs   L45D9
         lda   <u00A5
         sta   <u0080
         lbra  L4550
         rts
L45D9    lda   ,x
         cmpa  #$F1
         bne   L45E6
         leay  $01,x
         cmpy  u0002,u
         bne   L45BD
L45E6    stx   u0006,u
         clr   <u00D9
         clr   <u0083
         lda   <u0079
         lbsr  L2C7D
         lda   <u0041
         adda  <u00A5
         sta   <u0080
         rts
         bsr   L45FD
         lbra  L248A
L45FD    ldx   u0006,u
L45FF    cmpx  ,u
         bne   L460D
         lda   <u00A5
         adda  <u0048
         sta   <u0080
         lbsr  L44C0
         rts
L460D    tst   ,-x
         bmi   L45FF
         cmpx  ,u
         beq   L461F
         lda   -$01,x
         bpl   L461F
         cmpa  #$F1
         beq   L461F
         leax  -$01,x
L461F    stx   u0006,u
         clr   <u0083
         clr   <u00D9
         lda   <u0079
         lbsr  L2C7D
         lda   <u0041
         adda  <u00A5
         sta   <u0080
         rts
         lda   <u00A5
         sta   <u0080
         lda   #$01
         sta   <u00D9
         clr   <u0083
         lda   <u0079
         lbsr  L2C7D
         lbsr  L1744
         lbsr  L1760
         cmpa  >L0513,pcr
         lbne  L2499
         lda   <u00A5
         adda  <u0048
         sta   <u0080
         lda   <u0079
         lbsr  L2C7D
         lbra  L248A
         tst   <u0040
         bne   L4663
         lbsr  L4550
L4663    lbsr  L11D2
         tst   <u00A3
         bne   L4676
         lda   <u006F
         deca
         cmpa  <u0040
         bls   L4676
         sta   <u006F
         lbra  L248A
L4676    lda   <u0040
         inca
         sta   <u006F
         sta   <u0077
         clr   <u00A3
         lbra  L248A
         tst   <u007E
         beq   L468A
         ldd   u0009,u
         bra   L468C
L468A    ldd   u000B,u
L468C    subb  <u0040
         sbca  #$00
         subd  #$0001
         bcc   L469D
         lda   #$07
         lbsr  L2B46
         lbra  L248A
L469D    pshs  b,a
         lda   <u0040
         cmpa  <u0047
         bne   L46A8
         lbsr  L44C0
L46A8    lda   <u006F
         inca
         cmpa  <u0047
         bcc   L46B1
         sta   <u006F
L46B1    lbsr  L11E0
         beq   L46CF
         lda   #$01
         sta   <u00A3
         puls  x
         lbsr  L2522
         ldu   <u0022
         lbsr  L1B9A
         lda   #$01
         sta   <u0083
         clra
         lbsr  L2C7D
         lbra  L248A
L46CF    lda   <u0079
         inca
         sta   <u0079
         inca
         sta   <u006F
         sta   <u0077
         clr   <u00A3
         lbsr  L2C0D
         lbra  L246F
         tst   <u007E
         beq   L46E9
         ldd   u0009,u
         bra   L46EB
L46E9    ldd   u000B,u
L46EB    cmpd  #$0001
         bne   L46F9
         lda   #$07
         lbsr  L2B46
         lbra  L248A
L46F9    subb  <u0040
         sbca  #$00
         subb  <u0047
         sbca  #$00
         bcc   L4705
         clra
         clrb
L4705    tfr   d,x
         clr   <u00AC
         lbsr  L2522
L470C    tst   u0008,u
         bne   L4723
         tst   <u007E
         bne   L473F
         lda   [,u]
         cmpa  >L0539,pcr
         beq   L473A
         tst   <u001D,u
         beq   L473F
         bra   L473A
L4723    lda   <u00AC
         cmpa  <u0047
         bcs   L4731
         lbsr  L11D2
         lda   <u0047
         deca
         sta   <u00AC
L4731    ldb   #$01
         stb   <u0083
         lbsr  L2C7D
         inc   <u00AC
L473A    lbsr  L1D78
         bra   L470C
L473F    lbsr  L25FE
         ldu   <u0024
         lda   <u00AC
         sta   <u0079
         inca
         sta   <u006F
         sta   <u0077
         clr   <u00A3
         lbra  L246F
         lda   <u0040
         sta   <u00A8
         bra   L4765
L4758    lda   <u00A8
         cmpa  <u0047
         beq   L477E
         inc   <u00A8
L4760    lbsr  L1D78
         bcs   L477E
L4765    tst   u0008,u
         beq   L4778
L4769    lda   [,u]
         cmpa  >L0539,pcr
         beq   L4760
         tst   <u001D,u
         bne   L4760
         bra   L4758
L4778    tst   <u007E
         beq   L4769
         bra   L4758
L477E    clr   <u0079
L4780    tst   u0008,u
         bne   L4797
         tst   <u007E
         bne   L47B6
         tst   <u001D,u
         bne   L47AF
         lda   [,u]
         cmpa  >L0539,pcr
         bne   L47B6
         bra   L47AF
L4797    ldb   #$01
         sta   <u0083
         clr   <u00D9
         lda   <u0079
         lbsr  L2C7D
         lda   <u0079
         cmpa  <u0047
         bne   L47AD
         lbsr  L11D2
         dec   <u0079
L47AD    inc   <u0079
L47AF    lbsr  L1D78
         bcs   L47B6
         bra   L4780
L47B6    tst   <u007E
         bne   L47CE
         tst   <u001D,u
         bne   L47C7
         lda   [,u]
         cmpa  >L0539,pcr
         bne   L47CE
L47C7    lda   #$01
         sta   <u007E
         lbsr  L2C0D
L47CE    lda   <u0079
         inca
         sta   <u006F
         sta   <u0077
         lbra  L246F
         lbsr  L2ADB
         bcs   L47EE
         clr   u0006,u
         clr   <u0083
         sta   <u0080
         lda   #$01
         sta   <u00D9
         clr   <u0083
         lda   <u0079
         lbsr  L2C7D
L47EE    lbra  L248A
         lda   <u0079
         lbsr  L1246
         lda   <u0079
         clrb
         lbsr  GOROWCOL
         ldx   >L0567,pcr
         lbsr  L3169
         ldx   <u001E
L4805    lbsr  L1744
         anda  #$7F
         cmpa  >L0534,pcr
         lbeq  L246F
         cmpa  #$0D
         beq   L483E
         lbsr  OUTREPT
         cmpa  #$30
         bcs   L4825
         cmpa  #$39
         bhi   L4825
         sta   ,x+
         bra   L4805
L4825    lbsr  L1760
         cmpa  >L0514,pcr
         lbeq  L4838
         lda   #$21
         lbsr  L2B46
         lbra  L246F
L4838    clr   <u00A5
         ldd   <u0061
         bra   L4850
L483E    sta   ,x
         ldx   <u001E
         lbsr  L43D0
         bcs   L4825
         cmpd  #$0000
         beq   L4850
         subd  #$0001
L4850    std   <u00C8
         ldd   #$0000
         lbsr  GOROWCOL
         ldd   <u00C8
         cmpd  u000F,u
         bls   L48B1
L485F    lbsr  L1D78
         bcc   L486E
         ldb   #$08
         stb   <u0079
         lbsr  L2B46
         lbra  L2439
L486E    ldd   u000F,u
         cmpd  <u00C8
         bne   L485F
L4875    lda   #$01
         sta   <u0083
         lda   <u0040
         lbsr  L2C7D
         lda   <u0040
         cmpa  <u0047
         bcs   L4887
         lbsr  L11D2
L4887    ldd   <u0040
         inca
         lbsr  GOROWCOL
L488D    lbsr  L1D78
         tst   u0008,u
         bne   L4875
         tst   <u007E
         bne   L48A5
         tst   <u001D,u
         bne   L488D
         lda   [,u]
         cmpa  >L0539,pcr
         beq   L488D
L48A5    lda   <u0040
         sta   <u0079
         inca
         sta   <u006F
         sta   <u0077
         lbra  L2435
L48B1    ldd   <u00C8
         subd  <u0061
         bcc   L48BA
         ldd   #$0000
L48BA    lda   #$38
         mul
         ldx   <u0081
         leax  d,x
         ldy   <u0022
         ldd   #$0038
         lbsr  L3F31
         lbsr  L25FE
         bra   L4875
         lda   <u00A5
         cmpa  #$96
         bcc   L48DC
         adda  #$19
         sta   <u00A5
         lbra  L245F
L48DC    lda   #$02
         lbsr  L2B46
         lbra  L248A
         lda   <u00A5
         beq   L48DC
         suba  #$19
         bcs   L48DC
         sta   <u00A5
         lbra  L245F
L48F1    clr   <u00CC
L48F3    clr   <u0068
         ldy   u0006,u
         pshs  y
         leay  $01,y
         cmpy  <u0072
         puls  y
         lbcc  L1FD7
         ldb   ,y
         bpl   L4913
         cmpb  #$F0
         beq   L4913
         cmpb  #$F1
         beq   L4913
         stb   <u0068
L4913    lbsr  L1744
         cmpa  >L0521,pcr
         bne   L4920
         clr   <u00CC
         bra   L4913
L4920    cmpa  #$20
         lbcs  L498C
         cmpa  #$7F
         lbeq  L498C
         tst   <u00CC
         bne   L4957
         tst   <u0068
         beq   L4953
         pshs  a
         leay  $01,y
         ldx   u0006,u
         sty   u0006,u
L493D    cmpx  ,u
         beq   L4947
         lda   ,-x
         sta   ,-y
         bra   L493D
L4947    sty   ,u
         puls  a
         ldy   u0006,u
         sta   ,y
         bra   L4970
L4953    sta   ,y
         bra   L4970
L4957    tst   <u0068
         beq   L4963
         ldb   <u00CC
         stb   ,y
         sta   $01,y
         bra   L4970
L4963    pshs  a
         lda   <u00CC
         lbsr  L2B0E
         puls  a
         sta   ,y
         bra   L4970
L4970    lbsr  L1B26
         lbsr  L225C
         lbsr  L23D0
         lda   #$01
         sta   <u0083
         clr   <u00D9
         ldu   <u0024
         lda   <u0079
         lbsr  L2C7D
         lbsr  L45BB
         lbra  L48F3
L498C    cmpa  >BSC,pcr
         lbeq  L49F6
         cmpa  #$0D
         beq   L49C7
         cmpa  >L0534,pcr
         lbeq  L245F
         cmpa  >L0535,pcr
         lbeq  L49D7
         lbsr  L397B
         tstb
         lbne  L48F3
         lbsr  L2711
         lbcc  L48F3
         lda   #$01
         sta   <u0083
         clr   <u00D9
         ldu   <u0024
         lda   <u0079
         lbsr  L2C7D
         lbra  L48F3
L49C7    lda   #$F0
         lbsr  L2B0E
         ldy   u0006,u
         leay  -$01,y
         sty   u0006,u
         lbra  L4970
L49D7    lbsr  L2ADB
         bcs   L49EE
         clr   <u0083
         sta   <u0080
         lda   #$01
         sta   <u00D9
         clr   <u0083
         lda   <u0079
         lbsr  L2C7D
         lbra  L48F1
L49EE    lda   #$1D
         lbsr  L2B46
         lbra  L48F3
L49F6    lbsr  L45FD
         lbra  L48F3
         lbsr  L1744
         cmpa  #$20
         lbcs  L24AF
         cmpa  #$7F
         lbcc  L24AF
         lbsr  L2B0E
         lbsr  L225C
         lbsr  L23D0
         tst   <u0077
         lbne  L246F
         lda   <u0079
         inca
         sta   <u0077
         sta   <u006F
         lbra  L246F
         ldx   #$0001
         ldu   <u0024
         cmpx  u0009,u
         bcc   L4A39
         lbsr  L2522
         lbsr  L25FE
         lda   #$01
         sta   <u0079
         sta   <u007E
L4A39    ldx   >L05A1,pcr
         lbsr  L3347
         ldx   >L059D,pcr
         lbsr  L3169
         ldx   >L05A3,pcr
         lbsr  L3169
L4A4E    lbsr  L318B
         lbsr  L1760
         cmpa  #$0D
         beq   L4A7F
         cmpa  >YCHR,pcr
         beq   L4A7F
         cmpa  >NCHR,pcr
         beq   L4A6B
         lda   #$07
         lbsr  WrA2BUF
         bra   L4A4E
L4A6B    lbsr  OUTREPT
         ldx   >L05A5,pcr
         lbsr  L334C
         lbsr  L3208
         ldx   <u001E
         lbsr  L345C
         bra   L4A8E
L4A7F    lda   #$59
         lbsr  OUTREPT
L4A84    ldd   >L059D,pcr
         leax  >0,pcr
         leax  d,x
L4A8E    lbsr  L0230
         bcs   L4AAD
L4A93    ldx   <u001E
L4A95    lbsr  L0301
         bcs   L4AA4
         anda  #$7F
         sta   ,x+
         cmpa  #$0D
         bne   L4A95
         bra   L4ABF
L4AA4    pshs  cc
         lbsr  L029A
         puls  cc
         bvs   L4AB8
L4AAD    ldd   #$0000
         lbsr  GOROWCOL
         lbsr  L02E7
         bra   L4AE2
L4AB8    lda   #$01
         sta   <u00DD
         lbra  L319A
L4ABF    ldx   <u001E
         lda   ,x
         cmpa  #$0D
         beq   L4A93
         bsr   L4AF1
         bcs   L4AE2
         ldy   <u0038
         lsla
         tfr   a,b
         clra
         leay  d,y
         bsr   L4AF1
         bcs   L4AE2
         sta   ,y
         bsr   L4AF1
         bcs   L4AE2
         sta   $01,y
         bra   L4A93
L4AE2    clr   <u00DD
         ldx   >L059F,pcr
         lbsr  L3351
         lbsr  L029A
         lbra  L319A
L4AF1    clr   <u0067
L4AF3    lda   ,x
         cmpa  #$20
         beq   L4AFD
         cmpa  #$2C
         bne   L4B01
L4AFD    leax  $01,x
         bra   L4AF3
L4B01    leax  $01,x
         cmpa  #$2D
         bne   L4B0B
         inc   <u0067
         lda   ,x+
L4B0B    cmpa  #$24
         beq   L4B24
         cmpa  #$27
         beq   L4B20
         leax  -$01,x
         lbsr  L43D0
         bcs   L4B79
         tfr   b,a
         leax  -$01,x
         bra   L4B4D
L4B20    lda   ,x+
         bra   L4B4D
L4B24    lda   ,x+
         bsr   L4B7C
         bcs   L4B79
         sta   <u0068
         lda   ,x+
         cmpa  #$20
         beq   L4B4B
         cmpa  <u0031,u
         beq   L4B4B
         cmpa  #$2C
         beq   L4B4B
         bsr   L4B7C
         bcs   L4B79
         lsl   <u0068
         lsl   <u0068
         lsl   <u0068
         lsl   <u0068
         adda  <u0068
         bra   L4B4D
L4B4B    lda   <u0068
L4B4D    tst   <u0067
         beq   L4B53
         suba  #$40
L4B53    anda  #$7F
         sta   <u0068
L4B57    lda   ,x
         cmpa  #$20
         beq   L4B6E
         cmpa  #$2C
         beq   L4B6E
         cmpa  <u0031,u
         beq   L4B72
         cmpa  #$0D
         beq   L4B6E
         cmpa  #$F0
         bne   L4B74
L4B6E    leax  $01,x
         bra   L4B57
L4B72    leax  $01,x
L4B74    lda   <u0068
         andcc #$FE
         rts
L4B79    orcc  #$01
         rts
L4B7C    cmpa  #$30
         bcs   L4B99
         cmpa  #$39
         bhi   L4B89
         suba  #$30
         andcc #$FE
         rts
L4B89    lbsr  L1760
         cmpa  #$41
         bcs   L4B89
         cmpa  #$46
         bhi   L4B99
         suba  #$37
         andcc #$FE
         rts
L4B99    orcc  #$01
         rts
L4B9C    stb   <u00EC
         tfr   x,d
         leax  >0,pcr
         leax  d,x
         lda   #$04
L4BA8    ldb   #$02
         lbsr  GOROWCOL
         lbsr  L3184
         lda   <u0040
         inca
         ldb   <u0040
         subb  #$03
         cmpb  <u00EC
         bne   L4BA8
         ldd   #$1303
         lbsr  GOROWCOL
         ldx   >L05DD,pcr
         lbsr  L3169
L4BC8    clr   <u00ED
L4BCA    lda   #$20
         lbsr  OUTREPT
         lda   <u00ED
         adda  #$04
         clrb
         lbsr  GOROWCOL
         lda   #$3E
         lbsr  OUTREPT
         ldd   <u0040
         decb
         lbsr  GOROWCOL
L4BE2    lbsr  L012B
         lbsr  L1760
         cmpa  #$0D
         beq   L4C18
         cmpa  >L0534,pcr
         beq   L4C1B
         cmpa  >CURUC,pcr
         beq   L4C09
         cmpa  >L0503,pcr
         bne   L4BE2
         lda   <u00ED
         inca
         cmpa  <u00EC
         bcc   L4BC8
         inc   <u00ED
         bra   L4BCA
L4C09    tst   <u00ED
         bne   L4C14
         lda   <u00EC
         deca
         sta   <u00ED
         bra   L4BCA
L4C14    dec   <u00ED
         bra   L4BCA
L4C18    lda   <u00ED
         rts
L4C1B    clra
         rts
L4C1D    clrb
         lda   #$04
L4C20    clrb
         lbsr  GOROWCOL
         lda   #$20
         lbsr  OUTREPT
         lda   <u0040
         inca
         ldb   <u0040
         subb  #$04
         cmpb  <u00EC
         bne   L4C20
         bra   L4BC8
L4C36    clr   <u005D
         clr   <u005E
         ldd   u000F,u
         cmpd  <u0061
         bne   L4C4B
         ldx   >L05BB,pcr
         lbsr  L3347
         lbra  L4CE8
L4C4B    clra
         lbsr  L1246
         ldx   >L05BD,pcr
         lbsr  L3347
         lbsr  L318B
         lbsr  L1760
         cmpa  >L0534,pcr
         lbeq  L319A
         cmpa  >NCHR,pcr
         lbeq  L4D2A
         cmpa  #$0D
         beq   L4C7D
         cmpa  >YCHR,pcr
         beq   L4C7D
L4C76    lda   #$07
         lbsr  WrA2BUF
         bra   L4C36
L4C7D    lda   >YCHR,pcr
         lbsr  WrA2BUF
         inc   <u005D
         tst   <u0060
         bne   L4CE8
         tst   <u0070
         beq   L4CBF
         ldx   >L05BF,pcr
         lbsr  L334C
         ldx   <u0034
         lbsr  L3184
         ldx   >L05C1,pcr
         lbsr  L3169
         lbsr  L318B
         lbsr  L1760
         cmpa  >L0534,pcr
         lbeq  L319A
         cmpa  >YCHR,pcr
         beq   L4CE8
         cmpa  #$0D
         beq   L4CE8
         cmpa  >NCHR,pcr
         bne   L4C76
L4CBF    lda   #$01
         lbsr  L1246
         ldx   >L057F,pcr
         lbsr  L334C
         lbsr  L3208
         leax  -$01,x
         cmpx  <u001E
         lbeq  L319A
         ldx   <u001E
         lbsr  L345C
         ldy   <u0034
         ldd   #$0036
         lbsr  L3F31
         lda   #$02
         sta   <u0070
L4CE8    tst   <u005F
         bne   L4CF5
         ldx   >L05C9,pcr
         lbsr  L3351
         bra   L4D2D
L4CF5    ldx   >L05C3,pcr
         lbsr  L3351
         lbsr  L318B
         lbsr  L1760
         cmpa  >L0534,pcr
         lbeq  L319A
         cmpa  >YCHR,pcr
         beq   L4D1F
         cmpa  #$0D
         beq   L4D1F
         cmpa  >NCHR,pcr
         bne   L4CF5
         lbsr  OUTREPT
         bra   L4D2D
L4D1F    lda   >YCHR,pcr
         lbsr  OUTREPT
         inc   <u005E
         bra   L4D2D
L4D2A    lbsr  OUTREPT
L4D2D    tst   <u005D
         lbeq  L4E48
         tst   <u0060
         bne   L4D88
L4D37    ldx   <u0034
         lbsr  L01F6
         bcc   L4D86
         lbvc  L4F10
         ldx   <u0034
L4D44    lbsr  L0310
         bcc   L4D37
         lbvc  L4F10
L4D4D    ldx   >L057D,pcr
         lbsr  L3356
         lbsr  L318B
         lbsr  L1760
         cmpa  >L0534,pcr
         lbeq  L319A
         cmpa  >NCHR,pcr
         lbeq  L319A
         cmpa  >YCHR,pcr
         beq   L4D74
         cmpa  #$0D
         bne   L4D4D
L4D74    lda   >YCHR,pcr
         lbsr  WrA2BUF
         ldx   <u0034
         lbsr  L02B8
         lbcs  L4F10
         bra   L4D44
L4D86    inc   <u0060
L4D88    ldu   <u0024
         ldd   u000F,u
         subd  <u0061
         lda   #$38
         mul
         ldy   <u0081
         leay  d,y
         sty   <u0065
         ldx   $04,y
         stx   <u0063
         ldu   <u0065
         ldx   <u0013,u
         beq   L4DB9
         cmpx  <u003C
         beq   L4DB9
         ldy   <u003C
         sty   <u0013,u
         ldd   #$01F2
         lbsr  L3F31
         lda   #$F0
         sta   ,y
L4DB9    ldx   <u0015,u
         beq   L4DD3
         cmpx  <u003A
         beq   L4DD3
         ldy   <u003A
         sty   <u0015,u
         ldd   #$01F2
         lbsr  L3F31
         lda   #$F0
         sta   ,y
L4DD3    ldx   <u006B
L4DD5    cmpx  <u0063
         bcc   L4DF7
         lda   ,x+
         cmpa  #$F0
         bne   L4DE1
         lda   #$0D
L4DE1    lbsr  L02D8
         bcc   L4DD5
         ldd   #$0200
         lbsr  GOROWCOL
         lbsr  L02E7
         lbsr  L02A0
         clr   <u0060
         lbra  L319A
L4DF7    ldy   <u0022
         ldx   <u0065
         ldd   #$0038
         lbsr  L3F31
         lbsr  L25FE
         ldy   <u006B
         sty   <u007C
         ldu   <u0024
         ldx   #$0000
         stx   ,u
         stx   u0009,u
         stx   u000B,u
         ldy   <u0081
         ldx   <u0024
         ldd   #$0038
         lbsr  L3F31
         ldy   <u0081
         ldd   $0F,y
         std   <u0061
         ldd   <u006B
         std   $04,y
         ldd   u000F,u
         std   <u008F
         ldd   #$FFFF
         std   <u008D
         ldx   <u002C
         stx   <u0093
         clr   <u00A0
         clr   <u0095
         ldu   <u0024
L4E3F    tst   u0008,u
         beq   L4E48
         lbsr  L1D78
         bra   L4E3F
L4E48    tst   <u005E
         lbeq  L319A
L4E4E    ldu   <u0024
         tst   u0008,u
         beq   L4E58
         ldd   u0004,u
         bra   L4E5A
L4E58    ldd   ,u
L4E5A    std   <u0069
         ldx   <u007C
         leax  >$01F4,x
         cmpx  <u0069
         bcs   L4E75
         leax  >L05C5,pcr
         lbsr  L3356
         lda   #$07
         lbsr  WrA2BUF
         lbra  L319A
L4E75    ldd   <u0072
         subd  #$0001
         subd  <u0069
         ldx   <u0069
         ldy   <u007C
         lbsr  L3F31
         ldx   <u0072
         leax  <-$64,x
         stx   <u0069
         leax  <-$32,x
         stx   <u0065
         leax  >-$03E8,x
         stx   <u0063
         tfr   y,x
         tst   <u005E
         bne   L4EA9
L4E9C    lbsr  L02F2
         bcs   L4ECE
         bita  #$60
         bne   L4EAB
         cmpa  #$0D
         bne   L4E9C
L4EA9    lda   #$F0
L4EAB    sta   ,x+
         cmpx  <u0063
         bcs   L4E9C
         cmpa  #$F0
         bne   L4EB9
         inc   <u00F9
         bra   L4EDF
L4EB9    cmpx  <u0065
         bcs   L4E9C
         cmpa  #$20
         bne   L4EC5
         inc   <u00F9
         bra   L4EDF
L4EC5    cmpx  <u0069
         bcs   L4E9C
         tsta
         bmi   L4E9C
         bra   L4EDF
L4ECE    bvs   L4EDA
         ldx   >L0589,pcr
         lbsr  L3351
         lbsr  L02E7
L4EDA    lbsr  L028E
         clr   <u005F
L4EDF    tfr   x,d
         subd  <u007C
         ldy   <u0072
         pshs  a
         lda   -$01,x
         cmpa  #$F0
         puls  a
         beq   L4EF2
         leay  -$01,y
L4EF2    lbsr  L3F1E
         ldu   <u0024
         tst   u0008,u
         bne   L4F00
         sty   ,u
         bra   L4F03
L4F00    sty   u0004,u
L4F03    lbsr  L1B9A
         lbsr  L225C
L4F09    tst   <u00EE
         beq   L4F49
         lbra  L319A
L4F10    lda   #$02
         lbsr  L1246
         lda   #$03
         lbsr  L1246
         ldx   >L05C7,pcr
         lbsr  L3169
         lbsr  L02E7
         bra   L4F09
L4F26    tst   <u0070
         beq   L4F49
L4F2A    clr   <u00F9
         clr   <u00F8
         ldx   <u0032
         lbsr  L025C
         bcc   L4F44
         bvc   L4F3B
         inc   <u00F8
         bra   L4F49
L4F3B    lbsr  L02E7
         lbsr  L1207
         lbra  L0456
L4F44    inc   <u005F
         lbra  L4E4E
L4F49    inc   <u00EE
         tst   >L0011,pcr
         lbeq  L3191
         lbsr  L11BC
         clr   <u00EC
         lda   #$FF
         sta   <u006F
         lbra  L4A84
         emod
eom      equ   *
